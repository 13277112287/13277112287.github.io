<!DOCTYPE html>
<html lang="zh-cn">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <title>MyBatis.md - Even - A super concise theme for Hugo</title>
  <meta name="renderer" content="webkit" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>

<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">


<meta name="author" content="卢森林" /><meta name="description" content="面试题一览 第一章-MyBatis概述 帮助文档：https://mybatis.org/mybatis-3/zh/getting-starte" /><meta name="keywords" content="Hugo, theme, even" />






<meta name="generator" content="Hugo 0.74.3 with theme even" />


<link rel="canonical" href="https://13277112287.github.io/post/mybatis/" />
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/manifest.json">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">



<link href="/sass/main.min.8c3cbcb0324c2bb4875ceccba4007cbad4b4ac8377f33af9953c3e7684534a50.css" rel="stylesheet">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.css" integrity="sha256-7TyXnr2YU040zfSP+rEcz29ggW4j56/ujTPwjMzyqFY=" crossorigin="anonymous">


<meta property="og:title" content="MyBatis.md" />
<meta property="og:description" content="面试题一览 第一章-MyBatis概述 帮助文档：https://mybatis.org/mybatis-3/zh/getting-starte" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://13277112287.github.io/post/mybatis/" />
<meta property="article:published_time" content="2020-04-29T00:00:00+00:00" />
<meta property="article:modified_time" content="2020-08-12T00:00:00+00:00" />
<meta itemprop="name" content="MyBatis.md">
<meta itemprop="description" content="面试题一览 第一章-MyBatis概述 帮助文档：https://mybatis.org/mybatis-3/zh/getting-starte">
<meta itemprop="datePublished" content="2020-04-29T00:00:00+00:00" />
<meta itemprop="dateModified" content="2020-08-12T00:00:00+00:00" />
<meta itemprop="wordCount" content="10601">



<meta itemprop="keywords" content="" />
<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="MyBatis.md"/>
<meta name="twitter:description" content="面试题一览 第一章-MyBatis概述 帮助文档：https://mybatis.org/mybatis-3/zh/getting-starte"/>

<!--[if lte IE 9]>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js"></script>
<![endif]-->

<!--[if lt IE 9]>
  <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
<![endif]-->

</head>
<body>
  <div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/" class="logo">forest森林</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>
<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    <a href="/">
        <li class="mobile-menu-item">主页</li>
      </a><a href="/post/">
        <li class="mobile-menu-item">时间轴</li>
      </a><a href="/categories/">
        <li class="mobile-menu-item">分类</li>
      </a><a href="/about/">
        <li class="mobile-menu-item">关于</li>
      </a>
  </ul>
</nav>
  <div class="container" id="mobile-panel">
    <header id="header" class="header">
        <div class="logo-wrapper">
  <a href="/" class="logo">forest森林</a>
</div>

<nav class="site-navbar">
  <ul id="menu" class="menu">
    <li class="menu-item">
        <a class="menu-item-link" href="/">主页</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/post/">时间轴</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/categories/">分类</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/about/">关于</a>
      </li>
  </ul>
</nav>
    </header>

    <main id="main" class="main">
      <div class="content-wrapper">
        <div id="content" class="content">
          <article class="post">
    
    <header class="post-header">
      <h1 class="post-title">MyBatis.md</h1>

      <div class="post-meta">
        <span class="post-time"> 2020-04-29 </span>
        <div class="post-category">
            <a href="/categories/%E6%A1%86%E6%9E%B6/"> 框架 </a>
            </div>
          <span class="more-meta"> 约 10601 字 </span>
          <span class="more-meta"> 预计阅读 22 分钟 </span>
        
      </div>
    </header>

    <div class="post-toc" id="post-toc">
  <h2 class="post-toc-title">文章目录</h2>
  <div class="post-toc-content">
    <nav id="TableOfContents">
  <ul>
    <li><a href="#面试题一览">面试题一览</a></li>
    <li><a href="#第一章-mybatis概述">第一章-MyBatis概述</a>
      <ul>
        <li><a href="#1什么是mybatis流程">1什么是MyBatis/流程</a></li>
        <li><a href="#2快速入门">2快速入门</a>
          <ul>
            <li><a href="#21mybatis-configxml">2.1mybatis-config.xml</a></li>
            <li><a href="#22sessionfactory">2.2SessionFactory</a></li>
            <li><a href="#23mapperxml">2.3Mapper.xml</a></li>
            <li><a href="#24测试">2.4测试</a></li>
            <li><a href="#25常见错误">2.5常见错误</a></li>
          </ul>
        </li>
        <li><a href="#3crud">3CRUD</a>
          <ul>
            <li><a href="#31查询">3.1查询</a></li>
            <li><a href="#32分页">3.2分页</a></li>
            <li><a href="#33增删改">3.3增删改</a></li>
            <li><a href="#34注解crud">3.4注解CRUD</a></li>
            <li><a href="#35表名和类属性名不一致">3.5表名和类属性名不一致</a></li>
          </ul>
        </li>
        <li><a href="#4mybatisxml配置解析">4mybatis.xml配置解析</a>
          <ul>
            <li><a href="#41propertiessettingstypealiases">4.1properties/settings/typeAliases</a></li>
            <li><a href="#42environments-环境">4.2environments 环境</a></li>
            <li><a href="#43mapperxml">4.3mapper.xml</a></li>
          </ul>
        </li>
        <li><a href="#5生命周期">5生命周期</a></li>
        <li><a href="#6mybatis日志">6MyBatis日志</a></li>
      </ul>
    </li>
    <li><a href="#第二章-sql语句">第二章-SQL语句</a>
      <ul>
        <li><a href="#1多对一">1多对一</a></li>
        <li><a href="#2一对多">2一对多</a></li>
        <li><a href="#3动态sql">3动态SQL</a>
          <ul>
            <li><a href="#31-whereifset">3.1 where/if/set</a></li>
            <li><a href="#32choosewhen">3.2choose/when</a></li>
            <li><a href="#33foreachsqltrim">3.3foreach/sql/trim</a></li>
          </ul>
        </li>
      </ul>
    </li>
    <li><a href="#第三章-缓存">第三章-缓存</a>
      <ul>
        <li><a href="#1缓存介绍">1缓存介绍</a></li>
        <li><a href="#2mybatis缓存">2MyBatis缓存</a></li>
        <li><a href="#3一级缓存">3一级缓存</a></li>
        <li><a href="#4二级缓存">4二级缓存</a>
          <ul>
            <li><a href="#注意-------">注意&mdash;&mdash;-</a></li>
          </ul>
        </li>
      </ul>
    </li>
  </ul>
</nav>
  </div>
</div>
    <div class="post-content">
      <h1 id="面试题一览">面试题一览</h1>
<h1 id="第一章-mybatis概述">第一章-MyBatis概述</h1>
<p>帮助文档：https://mybatis.org/mybatis-3/zh/getting-started.html
视频网址：https://www.bilibili.com/video/av69742084?p=5</p>
<p>原理分析：https://blog.csdn.net/weixin_43184769/article/details/91126687</p>
<h2 id="1什么是mybatis流程">1什么是MyBatis/流程</h2>
<p>MyBatis 是一个半自动化的<strong>ORM框架 (Object Relationship Mapping) &ndash;&gt;对象关系映射</strong></p>
<p>MyBatis的优点</p>
<ul>
<li>
<p>简单易学：本身就很小且简单。没有任何第三方依赖，最简单安装只要两个jar文件+配置几个sql映射文件就可以了，易于学习，易于使用，通过文档和源代码，可以比较完全的掌握它的设计思路和实现。</p>
</li>
<li>
<p>灵活：mybatis不会对应用程序或者数据库的现有设计强加任何影响。 sql写在xml里，便于统一管理和优化。通过sql语句可以满足操作数据库的所有需求。</p>
</li>
<li>
<p>解除sql与程序代码的耦合：通过提供DAO层，将业务逻辑和数据访问逻辑分离，使系统的设计更清晰，更易维护，更易单元测试。sql和代码的分离，提高了可维护性。</p>
</li>
<li>
<p>提供xml标签，支持编写动态sql。</p>
</li>
</ul>
<p>执行流程：</p>
<h2 id="2快速入门">2快速入门</h2>
<p>注意：IDEA是不会编译src的java目录的xml文件，所以在Mybatis的配置文件中找不到xml文件！（也有可能是Maven构建项目的问题，网上教程很多项目是普通的Java web项目，所以可以放到src下面也能读取到）</p>
<p>导入jia包</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-xml" data-lang="xml"><span class="c">&lt;!--  mysql数据库--&gt;</span>
        <span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>mysql<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>mysql-connector-java<span class="nt">&lt;/artifactId&gt;</span>
            <span class="nt">&lt;version&gt;</span>5.1.46<span class="nt">&lt;/version&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>

<span class="c">&lt;!--  mybatis--&gt;</span>
        <span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>org.mybatis<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>mybatis<span class="nt">&lt;/artifactId&gt;</span>
            <span class="nt">&lt;version&gt;</span>3.5.2<span class="nt">&lt;/version&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>

<span class="c">&lt;!--  idea默认不会解析 src的xml文件，所以要在maven放行--&gt;</span>
<span class="nt">&lt;build&gt;</span>
  <span class="nt">&lt;resources&gt;</span>
    <span class="nt">&lt;resource&gt;</span>
      <span class="nt">&lt;directory&gt;</span>src/main/java<span class="nt">&lt;/directory&gt;</span>
      <span class="nt">&lt;includes&gt;</span>
        <span class="nt">&lt;include&gt;</span>**/*.xml<span class="nt">&lt;/include&gt;</span>
      <span class="nt">&lt;/includes&gt;</span>
    <span class="nt">&lt;/resource&gt;</span>
  <span class="nt">&lt;/resources&gt;</span>
 <span class="nt">&lt;/build&gt;</span>

</code></pre></td></tr></table>
</div>
</div><h3 id="21mybatis-configxml">2.1mybatis-config.xml</h3>
<p>配置文件的书写：</p>
<p>使用properties配置文件解耦
1编写配置文件database.properties</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">jdbc.driver=com.mysql.jdbc.Driver
#Mysql8.0需要加入时区设置  &amp;serverTimezone=Asia/shanghai
jdbc.url=jdbc:mysql://localhost:3306/store_ssm_vue?useSSL=false&amp;useUnicode=true&amp;characterEncoding=utf8
jdbc.username=root
jdbc.password=123456
</code></pre></td></tr></table>
</div>
</div><p>2在mybatis-config.xml文件中导入</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-xml" data-lang="xml"><span class="cp">&lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34; ?&gt;</span>
<span class="cp">&lt;!DOCTYPE configuration
</span><span class="cp">        PUBLIC &#34;-//mybatis.org//DTD Config 3.0//EN&#34;
</span><span class="cp">        &#34;http://mybatis.org/dtd/mybatis-3-config.dtd&#34;&gt;</span>
<span class="nt">&lt;configuration&gt;</span> 
  <span class="c">&lt;!-- 1.关联数据库文件
</span><span class="c"> &lt;context:property-placeholder location=&#34;classpath:database.properties&#34;/&gt;
</span><span class="c">未整合前使用下面这个，
</span><span class="c">--&gt;</span>
     <span class="nt">&lt;properties</span> <span class="na">resource=</span><span class="s">&#34;database.properties&#34;</span> <span class="nt">/&gt;</span>
  
  <span class="nt">&lt;environments</span> <span class="na">default=</span><span class="s">&#34;development&#34;</span><span class="nt">&gt;</span><span class="c">&lt;!--环境,可以有多个environment,连接多个数据库--&gt;</span>
    <span class="nt">&lt;environment</span> <span class="na">id=</span><span class="s">&#34;development&#34;</span><span class="nt">&gt;</span>
      <span class="nt">&lt;transactionManager</span> <span class="na">type=</span><span class="s">&#34;JDBC&#34;</span><span class="nt">/&gt;</span><span class="c">&lt;!--事务类型,有两个jdbc/managed 托管什么也不做,交由spring管理--&gt;</span>
      <span class="nt">&lt;dataSource</span> <span class="na">type=</span><span class="s">&#34;POOLED&#34;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&#34;driver&#34;</span> <span class="na">value=</span><span class="s">&#34;${jdbc.driver}&#34;</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&#34;url&#34;</span> <span class="na">value=</span><span class="s">&#34;${jdbc.url}&#34;</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&#34;username&#34;</span> <span class="na">value=</span><span class="s">&#34;${jdbc.username}&#34;</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&#34;password&#34;</span> <span class="na">value=</span><span class="s">&#34;${jdbc.password}&#34;</span><span class="nt">/&gt;</span>
      <span class="nt">&lt;/dataSource&gt;</span>
    <span class="nt">&lt;/environment&gt;</span>
  <span class="nt">&lt;/environments&gt;</span>

<span class="nt">&lt;/configuration&gt;</span>
</code></pre></td></tr></table>
</div>
</div><h3 id="22sessionfactory">2.2SessionFactory</h3>
<p>每个基于 MyBatis 的应用都是以一个 SqlSessionFactory 的实例为核心的。SqlSessionFactory 的实例可以通过 SqlSessionFactoryBuilder 获得。
SqlSessionFactoryBuilder 则可以从 XML 配置文件或一个预先配置的 Configuration 实例来构建出 SqlSessionFactory 实例</p>
<p>创建获得session的utils类MyBatisUtils。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="kn">package</span> <span class="nn">com.lx.utils</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.sun.javaws.jnl.ResourcesDesc</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.ibatis.io.Resources</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.ibatis.session.SqlSession</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.ibatis.session.SqlSessionFactory</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.ibatis.session.SqlSessionFactoryBuilder</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.io.IOException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.io.InputStream</span><span class="o">;</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">MyBatisUtils</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="kd">static</span>   <span class="n">SqlSessionFactory</span> <span class="n">sqlSessionFactory</span><span class="o">;</span>
    <span class="c1">//静态代码块 ,加载class时就会加载代码块中代码
</span><span class="c1"></span>    <span class="kd">static</span> <span class="o">{</span>
    <span class="c1">//每个基于 MyBatis 的应用都是以一个 SqlSessionFactory 的实例为核心的。 
</span><span class="c1"></span>    <span class="c1">//SqlSessionFactory 的实例 可以通过 SqlSessionFactoryBuilder 获得。
</span><span class="c1">// 而SqlSessionFactoryBuilder则可以从 XML 配置文件或一个预先定制的 Configuration 的实例构建出 SqlSessionFactory 的实例
</span><span class="c1"></span>        <span class="n">String</span> <span class="n">resource</span> <span class="o">=</span> <span class="s">&#34;mybatis-config.xml&#34;</span><span class="o">;</span>
        <span class="k">try</span> <span class="o">{</span>
            <span class="n">InputStream</span> <span class="n">inputStream</span>  <span class="o">=</span> <span class="n">Resources</span><span class="o">.</span><span class="na">getResourceAsStream</span><span class="o">(</span><span class="n">resource</span><span class="o">);</span>
            <span class="n">sqlSessionFactory</span> <span class="o">=</span> <span class="k">new</span> <span class="n">SqlSessionFactoryBuilder</span><span class="o">().</span><span class="na">build</span><span class="o">(</span><span class="n">inputStream</span><span class="o">);</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">IOException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
        <span class="o">}</span>
    <span class="o">}</span>
    <span class="c1">//既然有了 SqlSessionFactory，顾名思义，我们就可以从中获得 SqlSession 的实例了。
</span><span class="c1"></span>    <span class="c1">// SqlSession 完全包含了面向数据库执行 SQL 命令所需的所有方法。你可以通过 SqlSession 实例来直接执行已映射的 SQL 语句
</span><span class="c1"></span>    <span class="kd">public</span> <span class="kd">static</span> <span class="n">SqlSession</span> <span class="nf">getSqlSession</span><span class="o">(){</span>
        <span class="k">return</span> <span class="n">sqlSessionFactory</span><span class="o">.</span><span class="na">openSession</span><span class="o">(</span><span class="kc">true</span><span class="o">);</span><span class="c1">//这是开启自动提交
</span><span class="c1"></span>    <span class="o">}</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><h3 id="23mapperxml">2.3Mapper.xml</h3>
<p>需要一个接口，然后用namespace去绑定这个接口。</p>
<p>id指的是接口中的方法名
resultType指的是返回类型（一般写全限定类名，只写集合中的泛型）。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-xml" data-lang="xml"><span class="cp">&lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34; ?&gt;</span>
<span class="cp">&lt;!DOCTYPE mapper
</span><span class="cp">        PUBLIC &#34;-//mybatis.org//DTD Mapper 3.0//EN&#34;
</span><span class="cp">        &#34;http://mybatis.org/dtd/mybatis-3-mapper.dtd&#34;&gt;</span>

<span class="c">&lt;!--namespace=绑定一个dao接口  dao/mapper interface--&gt;</span>
<span class="nt">&lt;mapper</span> <span class="na">namespace=</span><span class="s">&#34;com.lsl.mapper.CommodityMapper&#34;</span><span class="nt">&gt;</span>
<span class="c">&lt;!--增删改查 --&gt;</span>

    <span class="nt">&lt;insert</span> <span class="na">id=</span><span class="s">&#34;saveCommodity&#34;</span> <span class="na">parameterType=</span><span class="s">&#34;com.lsl.entity.Commodity&#34;</span><span class="nt">&gt;</span>
        insert into values(null,#{cid},#{cname},#{price});
    <span class="nt">&lt;/insert&gt;</span>

    <span class="nt">&lt;delete</span> <span class="na">id=</span><span class="s">&#34;deleteCommodity&#34;</span> <span class="na">parameterType=</span><span class="s">&#34;java.lang.Integer&#34;</span><span class="nt">&gt;</span>
        delete from commodity where id=#{id}
    <span class="nt">&lt;/delete&gt;</span>

    <span class="nt">&lt;update</span> <span class="na">id=</span><span class="s">&#34;updateCommodity&#34;</span> <span class="na">parameterType=</span><span class="s">&#34;com.lsl.entity.Commodity&#34;</span><span class="nt">&gt;</span>
        update commodity set cid=#{cid},cname=#{cname},price=#{price} where id=#{id}
    <span class="nt">&lt;/update&gt;</span>

    <span class="nt">&lt;select</span> <span class="na">id=</span><span class="s">&#34;findCommoditys&#34;</span> <span class="na">resultType=</span><span class="s">&#34;com.lsl.entity.Commodity&#34;</span><span class="nt">&gt;</span>
    select * from commodity
    <span class="nt">&lt;/select&gt;</span>

<span class="nt">&lt;/mapper&gt;</span>

</code></pre></td></tr></table>
</div>
</div><p>获得自增长ID</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-xml" data-lang="xml"><span class="nt">&lt;insert</span> <span class="na">id=</span><span class="s">&#34;insertUser&#34;</span> <span class="na">useGeneratedKeys=</span><span class="s">&#34;true&#34;</span> <span class="na">keyProperty=</span><span class="s">&#34;id&#34;</span> <span class="na">parameterType=</span><span class="s">&#34;UserEntity&#34;</span><span class="nt">&gt;</span>
INSERT INTO USER VALUES(null,#{userName},#{password},#{realName})
<span class="nt">&lt;/insert&gt;</span>
</code></pre></td></tr></table>
</div>
</div><p>其中keyProperty的值就是数据库中自增长字段名。</p>
<p>执行插入后，通过get.id就可以获得自增长的id了</p>
<h3 id="24测试">2.4测试</h3>
<p>mapper标签有三个属性，resource，url，class
resource是 使用相对于类路径的资源引用</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-xml" data-lang="xml">在mybatis-config.xml加入，把接口实现的Mapper写到配置文件中
<span class="nt">&lt;mappers&gt;</span>
    <span class="nt">&lt;mapper</span> <span class="na">resource=</span><span class="s">&#34;com/lx/dao/AccountMapper.xml&#34;</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/mappers&gt;</span>
</code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="kn">import</span> <span class="nn">org.apache.ibatis.io.Resources</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.ibatis.session.SqlSession</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.ibatis.session.SqlSessionFactory</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.ibatis.session.SqlSessionFactoryBuilder</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.io.IOException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.io.Reader</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">MyBatisUtil</span> <span class="o">{</span>

    <span class="kd">private</span> <span class="kd">static</span> <span class="n">SqlSessionFactory</span> <span class="n">sqlSessionFactory</span><span class="o">;</span>

    <span class="c1">//静态代码块，加载class时候就会加载
</span><span class="c1"></span>    <span class="kd">static</span><span class="o">{</span>
        <span class="k">try</span> <span class="o">{</span>
            <span class="n">Reader</span> <span class="n">reader</span><span class="o">=</span> <span class="n">Resources</span><span class="o">.</span><span class="na">getResourceAsReader</span><span class="o">(</span><span class="s">&#34;mybatis-config.xml&#34;</span><span class="o">);</span>
            <span class="n">sqlSessionFactory</span><span class="o">=</span><span class="k">new</span> <span class="n">SqlSessionFactoryBuilder</span><span class="o">().</span><span class="na">build</span><span class="o">(</span><span class="n">reader</span><span class="o">);</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">IOException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
        <span class="o">}</span>
    <span class="o">}</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="n">SqlSession</span> <span class="nf">getSqlSession</span><span class="o">(){</span>
        <span class="k">return</span> <span class="n">sqlSessionFactory</span><span class="o">.</span><span class="na">openSession</span><span class="o">(</span><span class="kc">true</span><span class="o">);</span><span class="c1">//这是开启自动提交
</span><span class="c1"></span>    <span class="o">}</span>
<span class="o">}</span>

<span class="c1">//测试 需要MyBatisUtils
</span><span class="c1"></span><span class="nd">@Test</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">selectAllAccount</span><span class="o">()</span> <span class="o">{</span>
    <span class="n">SqlSession</span> <span class="n">sqlSession</span><span class="o">=</span> <span class="n">MyBatisUtils</span><span class="o">.</span><span class="na">getSqlSession</span><span class="o">();</span>
    <span class="c1">//执行SQl
</span><span class="c1"></span>    <span class="n">AccountDao</span> <span class="n">accountDao</span><span class="o">=</span><span class="n">sqlSession</span><span class="o">.</span><span class="na">getMapper</span><span class="o">(</span><span class="n">AccountDao</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
    <span class="n">List</span><span class="o">&lt;</span><span class="n">Account</span><span class="o">&gt;</span> <span class="n">list</span><span class="o">=</span><span class="n">accountDao</span><span class="o">.</span><span class="na">selectAllAccount</span><span class="o">();</span>
    <span class="k">for</span><span class="o">(</span><span class="n">Account</span> <span class="n">account</span><span class="o">:</span><span class="n">list</span><span class="o">){</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">account</span><span class="o">);</span>
    <span class="o">}</span>
    <span class="n">sqlSession</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><h3 id="25常见错误">2.5常见错误</h3>
<p>Error parsing SQL Mapper Configuration. Cause: java.io.IOException: Could not find resource com/lx/dao/AccountMapper.xml</p>
<p>无法找到mapper.xml，要么是Mappper的名称路径错误，或者是IDEA的问题。
IDEA的maven项目中，默认源代码目录下（<code>src/main/java</code>目录）的xml等资源文件并不会在编译的时候一块打包进classes文件夹，而是直接舍弃掉。如果使用的是Eclipse，Eclipse的src目录下的xml等资源文件在编译的时候会自动打包进输出到classes文件夹。</p>
<p>方式一：pom.xml文件中，对资源进行释放</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-xml" data-lang="xml">    <span class="nt">&lt;resources&gt;</span>
        <span class="nt">&lt;resource&gt;</span>
            <span class="nt">&lt;directory&gt;</span>src/main/resources<span class="nt">&lt;/directory&gt;</span>
            <span class="nt">&lt;includes&gt;</span>
                <span class="nt">&lt;include&gt;</span>**/*.properties<span class="nt">&lt;/include&gt;</span>
                <span class="nt">&lt;include&gt;</span>**/*.xml<span class="nt">&lt;/include&gt;</span>
            <span class="nt">&lt;/includes&gt;</span>
            <span class="nt">&lt;filtering&gt;</span>true<span class="nt">&lt;/filtering&gt;</span>
        <span class="nt">&lt;/resource&gt;</span>
        <span class="nt">&lt;resource&gt;</span>
            <span class="nt">&lt;directory&gt;</span>src/main/java<span class="nt">&lt;/directory&gt;</span>
            <span class="nt">&lt;includes&gt;</span>
                <span class="nt">&lt;include&gt;</span>**/*.properties<span class="nt">&lt;/include&gt;</span>
                <span class="nt">&lt;include&gt;</span>**/*.xml<span class="nt">&lt;/include&gt;</span>
            <span class="nt">&lt;/includes&gt;</span>
            <span class="nt">&lt;filtering&gt;</span>true<span class="nt">&lt;/filtering&gt;</span>
        <span class="nt">&lt;/resource&gt;</span>

    <span class="nt">&lt;/resources&gt;</span>
<span class="nt">&lt;/build&gt;</span>
</code></pre></td></tr></table>
</div>
</div><p>方式二:增加classpath:</p>
<p>例如在springboot项目中，在application.properties中增加：
<code>mybatis.mapper-locations=classpath:mapper/*.xml</code></p>
<h2 id="3crud">3CRUD</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="o">&lt;</span><span class="n">mapper</span> <span class="n">namespace</span><span class="o">=</span><span class="s">&#34;com.lsl.mapper.CommodityMapper&#34;</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="n">insert</span> <span class="n">id</span><span class="o">=</span><span class="s">&#34;saveCommodity&#34;</span> <span class="n">parameterType</span><span class="o">=</span><span class="s">&#34;com.lsl.entity.Commodity&#34;</span><span class="o">&gt;</span>
        <span class="n">insert</span> <span class="n">into</span> <span class="nf">values</span><span class="o">(</span><span class="kc">null</span><span class="o">,</span><span class="err">#</span><span class="o">{</span><span class="n">cid</span><span class="o">},</span><span class="err">#</span><span class="o">{</span><span class="n">cname</span><span class="o">},</span><span class="err">#</span><span class="o">{</span><span class="n">price</span><span class="o">});</span>
    <span class="o">&lt;/</span><span class="n">insert</span><span class="o">&gt;</span>

    <span class="o">&lt;</span><span class="n">delete</span> <span class="n">id</span><span class="o">=</span><span class="s">&#34;deleteCommodity&#34;</span> <span class="n">parameterType</span><span class="o">=</span><span class="s">&#34;java.lang.Integer&#34;</span><span class="o">&gt;</span>
        <span class="n">delete</span> <span class="n">from</span> <span class="n">commodity</span> <span class="n">where</span> <span class="n">id</span><span class="o">=</span><span class="err">#</span><span class="o">{</span><span class="n">id</span><span class="o">}</span>
    <span class="o">&lt;/</span><span class="n">delete</span><span class="o">&gt;</span>

    <span class="o">&lt;</span><span class="n">update</span> <span class="n">id</span><span class="o">=</span><span class="s">&#34;updateCommodity&#34;</span> <span class="n">parameterType</span><span class="o">=</span><span class="s">&#34;com.lsl.entity.Commodity&#34;</span><span class="o">&gt;</span>
        <span class="n">update</span> <span class="n">commodity</span> <span class="n">set</span> <span class="n">cid</span><span class="o">=</span><span class="err">#</span><span class="o">{</span><span class="n">cid</span><span class="o">},</span><span class="n">cname</span><span class="o">=</span><span class="err">#</span><span class="o">{</span><span class="n">cname</span><span class="o">},</span><span class="n">price</span><span class="o">=</span><span class="err">#</span><span class="o">{</span><span class="n">price</span><span class="o">}</span> <span class="n">where</span> <span class="n">id</span><span class="o">=</span><span class="err">#</span><span class="o">{</span><span class="n">id</span><span class="o">}</span>
    <span class="o">&lt;/</span><span class="n">update</span><span class="o">&gt;</span>

    <span class="o">&lt;</span><span class="n">select</span> <span class="n">id</span><span class="o">=</span><span class="s">&#34;findCommoditys&#34;</span> <span class="n">resultType</span><span class="o">=</span><span class="s">&#34;com.lsl.entity.Commodity&#34;</span><span class="o">&gt;</span>
    <span class="n">select</span> <span class="o">*</span> <span class="n">from</span> <span class="n">commodity</span>
    <span class="o">&lt;/</span><span class="n">select</span><span class="o">&gt;</span>
<span class="o">&lt;/</span><span class="n">mapper</span><span class="o">&gt;</span>
</code></pre></td></tr></table>
</div>
</div><p><strong>namespace</strong></p>
<blockquote>
<p>mapper中的namespace，用来写接口的全限定命名。映射文件中的<strong>namespace是用于绑定Dao接口的</strong>，<strong>即面向接口编程</strong>。</p>
<p>之前用session.selectList(&ldquo;com.lx.dao.类名.方法名&rdquo;)这样可以为每个sql语句起一个唯一标识的作用，避免在以后使用时可能导致的混乱。
现在使用session查询时，是用session.getMapper(xxdao.class)通过接口来获得实现类，就需要让接口和实现类进行绑定，就是通过namespace进行的，这样更加的方便，减少了全限定名称的出错。</p>
</blockquote>
<p>**id:**对应namespace中接口的方法名。
**resultType：**sql语句执行的返回类型，当是集合时，只用指定泛型就好。
**parameterType：**参数的类型，(似乎可以不用写。)</p>
<h3 id="31查询">3.1查询</h3>
<p>==注意，%应该使用双引号”“==</p>
<p><strong>模糊查询：</strong>%百分号可以在传值时传入%王%，也可以在mapper中写。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-xml" data-lang="xml"><span class="nt">&lt;select</span> <span class="na">id=</span><span class="s">&#34;selectAccountByLikeAccount&#34;</span> <span class="na">resultType=</span><span class="s">&#34;com.lx.vo.Account&#34;</span><span class="nt">&gt;</span>
    select * from account where account like &#34;%&#34;#{account}&#34;%&#34;
<span class="nt">&lt;/select&gt;</span>
</code></pre></td></tr></table>
</div>
</div><p><strong>查询条件:1个</strong>.如：id
dao方法接口：Account selectAccountById(Integer id);
mapper.xml：#{可以写任意值}，不用写参数类型。#意思是：当作字符串，避免sql注入</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-xml" data-lang="xml"><span class="nt">&lt;select</span> <span class="na">id=</span><span class="s">&#34;selectAccountById&#34;</span> <span class="na">resultType=</span><span class="s">&#34;com.lx.vo.Account&#34;</span> <span class="nt">&gt;</span>
  select * from account where aid =#{aid}
  <span class="nt">&lt;/select&gt;</span>
</code></pre></td></tr></table>
</div>
</div><p>时间类型的查询，可以直接使用String</p>
<p><strong>查询条件多个</strong></p>
<p><strong>方法一：@Param(&ldquo;account&rdquo;)直接设置参数</strong></p>
<p>dao方法接口:List<Account> selectAccountByIdAndAccount(
@Param(&ldquo;account&rdquo;) String account,@Param(&ldquo;aid&rdquo;)Integer aid);
其中：@Param(&ldquo;account&rdquo;) String account 表明括号的参数,对应mapper中的参数为account</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-xml" data-lang="xml"><span class="nt">&lt;select</span> <span class="na">id=</span><span class="s">&#34;selectAccountByIdAndAccount&#34;</span> <span class="na">resultType=</span><span class="s">&#34;com.lx.vo.Account&#34;</span> <span class="nt">&gt;</span>
select * from account where account =#{account} and aid=#{aid}
<span class="nt">&lt;/select&gt;</span>
</code></pre></td></tr></table>
</div>
</div><ul>
<li>parameterType=&quot;全限定类名&rdquo;，这样也可以，就不用一个一个设置参数了。</li>
</ul>
<p><strong>方式二：用Map&lt;String,Object&gt;设置参数</strong></p>
<p>dao方法接口:List<Account> selectByAccountAndStatus(Map&lt;String,Object&gt; map);</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-xml" data-lang="xml"><span class="nt">&lt;select</span> <span class="na">id=</span><span class="s">&#34;selectAccountByAccountAndStatus&#34;</span> <span class="na">parameterType=</span><span class="s">&#34;map&#34;</span> <span class="na">resultType=</span><span class="s">&#34;com.lx.vo.Account&#34;</span><span class="nt">&gt;</span>
  select * from account where account =#{account} and status=#{status}
<span class="nt">&lt;/select&gt;</span>
</code></pre></td></tr></table>
</div>
</div><p>调用时候：需要map.put(&ldquo;参数名称&rdquo;,参数值);如:put(&ldquo;aid&rdquo;,1019)
当查询方法写的多个参数时,但map为null或者参数不足时,查询结果为Null</p>
<h3 id="32分页">3.2分页</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="n">List</span><span class="o">&lt;</span><span class="n">Account</span><span class="o">&gt;</span> <span class="nf">selectAllAccountByPage</span><span class="o">(</span><span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span><span class="n">Object</span><span class="o">&gt;</span> <span class="n">map</span><span class="o">);</span><span class="c1">//分页查询所有
</span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-xml" data-lang="xml"><span class="nt">&lt;select</span> <span class="na">id=</span><span class="s">&#34;selectAllAccountByPage&#34;</span> <span class="na">parameterType=</span><span class="s">&#34;map&#34;</span> <span class="na">resultType=</span><span class="s">&#34;com.lx.vo.Account&#34;</span><span class="nt">&gt;</span>
select * from account limit #{startIndex},#{pageSize}
<span class="nt">&lt;/select&gt;</span>
</code></pre></td></tr></table>
</div>
</div><p>不同数据库，查询语句各不相同。limit 开始下标(从0开始)，查询几条。</p>
<h3 id="33增删改">3.3增删改</h3>
<p><strong>添加</strong></p>
<p>dao方法接口：Integer insertAccount(Account account);//插入一个account</p>
<p>注意：增删改时要session.commit()。否则不会执行，但id会自动增长一个。
可以在用seesionFactory.getSession(true)时候设置自动提交。</p>
<p>增删改时，用的标签不同。<code>&lt;delete&gt;&lt;update&gt;</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-xml" data-lang="xml"><span class="nt">&lt;insert</span> <span class="na">id=</span><span class="s">&#34;insertAccount&#34;</span> <span class="na">parameterType=</span><span class="s">&#34;com.lx.vo.Account&#34;</span><span class="nt">&gt;</span>
    insert into account(aid,account,password,status) values(null,#{account},#{password},#{status})
<span class="nt">&lt;/insert&gt;</span>
</code></pre></td></tr></table>
</div>
</div><blockquote>
<p>注意：若想使用主键自增<code>&lt;insert id=&quot;insert&quot; parameterType=&quot;student&quot; keyProperty=&quot;studentId&quot; useGeneratedKeys=&quot;true&quot;&gt;</code></p>
</blockquote>
<h3 id="34注解crud">3.4注解CRUD</h3>
<p>简单的sql可以用注解，更加快速。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"> <span class="nd">@Select</span><span class="o">(</span><span class="s">&#34;select * from account&#34;</span><span class="o">)</span>
<span class="n">List</span><span class="o">&lt;</span><span class="n">Account</span><span class="o">&gt;</span> <span class="nf">getAllAccountAnnotation</span><span class="o">();</span><span class="c1">//查询
</span><span class="c1"></span>
<span class="nd">@Insert</span><span class="o">(</span><span class="s">&#34;insert into values(null,#{account},#{password},#{status})&#34;</span><span class="o">)</span>
<span class="kt">int</span> <span class="nf">addAccountAnnottation</span><span class="o">(</span><span class="n">Account</span> <span class="n">account</span><span class="o">);</span><span class="c1">//添加  使用#号防止sql注入,相当于prepareStatement
</span><span class="c1"></span>
<span class="nd">@Update</span><span class="o">(</span><span class="s">&#34;update account set account=#{account},password=#{password},status=#{status} where aid=#{aid}&#34;</span><span class="o">)</span>
<span class="kt">int</span> <span class="nf">updateAccountAnnotation</span><span class="o">(</span><span class="n">Account</span> <span class="n">account</span><span class="o">);</span><span class="c1">//修改
</span><span class="c1"></span>
<span class="nd">@Delete</span><span class="o">(</span><span class="s">&#34;delete from account where aid=#{aid}&#34;</span><span class="o">)</span>
<span class="kt">int</span> <span class="nf">deleteAccountAnnotation</span><span class="o">(</span><span class="n">Integer</span> <span class="n">aid</span><span class="o">);</span><span class="c1">//删除
</span></code></pre></td></tr></table>
</div>
</div><h3 id="35表名和类属性名不一致">3.5表名和类属性名不一致</h3>
<p>原因：在查询数据时候，查询的是password，而返回类型为Account，在实体类中找不到password，无法进行赋			值。</p>
<p>用ResultMap解决， resultMap=&quot;自定义的resultMap的id&rdquo;。
<code>&lt;resultMap id=&quot;staffMap&quot; type=&quot;Staff&quot;&gt;</code> type指resultMap映射的类型，property，是属性名，Column表的字段名。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-xml" data-lang="xml"><span class="nt">&lt;select</span> <span class="na">id=</span><span class="s">&#34;getStaffById&#34;</span> <span class="na">resultMap=</span><span class="s">&#34;staffMap&#34;</span><span class="nt">&gt;</span>
select * from staff where id=#{id}
<span class="nt">&lt;/select&gt;</span>
<span class="nt">&lt;resultMap</span> <span class="na">id=</span><span class="s">&#34;staffMap&#34;</span> <span class="na">type=</span><span class="s">&#34;Staff&#34;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;result</span> <span class="na">property=</span><span class="s">&#34;id&#34;</span> <span class="na">column=</span><span class="s">&#34;id&#34;</span><span class="nt">&gt;&lt;/result&gt;</span> <span class="c">&lt;!--property指的是VO类中的属性,column是数据库表的字段--&gt;</span>
    <span class="nt">&lt;result</span> <span class="na">property=</span><span class="s">&#34;name&#34;</span> <span class="na">column=</span><span class="s">&#34;name&#34;</span><span class="nt">&gt;&lt;/result&gt;</span>
    <span class="nt">&lt;result</span> <span class="na">property=</span><span class="s">&#34;age&#34;</span> <span class="na">column=</span><span class="s">&#34;age&#34;</span><span class="nt">&gt;&lt;/result&gt;</span>
    <span class="nt">&lt;result</span> <span class="na">property=</span><span class="s">&#34;birth&#34;</span> <span class="na">column=</span><span class="s">&#34;birth&#34;</span><span class="nt">&gt;&lt;/result&gt;</span>
    <span class="nt">&lt;result</span> <span class="na">property=</span><span class="s">&#34;department&#34;</span> <span class="na">column=</span><span class="s">&#34;department&#34;</span><span class="nt">&gt;&lt;/result&gt;</span>
<span class="nt">&lt;/resultMap&gt;</span>
</code></pre></td></tr></table>
</div>
</div><p>简单解决：起别名 。在Mapper中sql语句起别名解决。 a.password pwd</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Account</span> <span class="o">{</span>
   <span class="kd">private</span> <span class="n">Integer</span> <span class="n">aid</span><span class="o">;</span>
   <span class="kd">private</span> <span class="n">String</span> <span class="n">account</span><span class="o">;</span>
   <span class="kd">private</span> <span class="n">String</span> <span class="n">pwd</span><span class="o">;</span><span class="c1">//在数据库中的字段为password，此时查询为null
</span><span class="c1"></span>   <span class="kd">private</span> <span class="n">String</span> <span class="n">status</span><span class="o">;</span> 
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-xml" data-lang="xml"><span class="nt">&lt;mapper</span> <span class="na">namespace=</span><span class="s">&#34;com.lx.dao.AccountDao&#34;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;select</span> <span class="na">id=</span><span class="s">&#34;selectAllAccount&#34;</span> <span class="na">resultType=</span><span class="s">&#34;Account&#34;</span><span class="nt">&gt;</span>
    select a.aid,a.account,a.password pwd,a.status from account a
    <span class="nt">&lt;/select&gt;</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="4mybatisxml配置解析">4mybatis.xml配置解析</h2>
<p><strong>configuration(配置)</strong>：myBatis配置文件中的标签，需要掌握一下三个部分。</p>
<ol>
<li>
<p>properties 可以配置在Java 属性配置文件中
settings 修改 MyBatis 在运行时的行为方式
typeAliases 为 Java 类型命名一个短的名字</p>
</li>
<li>
<p>environments 环境</p>
</li>
</ol>
<ul>
<li>environment 环境变量
<ul>
<li>transactionManager 事务管理器</li>
<li>dataSource 数据源</li>
</ul>
</li>
</ul>
<ol start="4">
<li>mappers l 映射器</li>
</ol>
<h3 id="41propertiessettingstypealiases">4.1properties/settings/typeAliases</h3>
<p>1 <strong>properties</strong> 可以配置在Java 属性配置文件中，引入db.properties文件进行配置，也可以在内部标签进行配置，若有同名属性优先使用外部配置。
<strong>settings</strong> 修改 MyBatis 在运行时的行为方式，有很多设置，详情可以看官方文档。
<strong>typeAliases</strong> 为 Java 类型命名一个短的名字  ,package扫描这个包下的bean类，并为其起别名(默认类名首字母						小写)，可以用@Alias注释手动设置别名，或者用typeAlias属性设置。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-xml" data-lang="xml"><span class="c">&lt;!--引入外部配置文件--&gt;</span>
    <span class="nt">&lt;properties</span> <span class="na">resource=</span><span class="s">&#34;database.properties&#34;</span> <span class="nt">/&gt;</span>

<span class="nt">&lt;settings&gt;</span>
 <span class="nt">&lt;setting</span> <span class="na">name=</span><span class="s">&#34;logImpl&#34;</span> <span class="na">value=</span><span class="s">&#34;STDOUT_LOGGING打印语句/LOG4J&#34;</span><span class="nt">/&gt;</span>指定日志
 <span class="nt">&lt;setting</span> <span class="na">name=</span><span class="s">&#34;mapUnderscoreToCamelCase&#34;</span> <span class="na">value=</span><span class="s">&#34;true/false&#34;</span><span class="nt">/&gt;</span>是否开启驼峰命名转换（数据库t_id转为tId,实体类tId转为t_id）
 <span class="nt">&lt;setting</span> <span class="na">name=</span><span class="s">&#34;cacheEnabled&#34;</span> <span class="na">value=</span><span class="s">&#34;true&#34;</span><span class="nt">/&gt;</span>开启缓存（全局性地开启或关闭所有映射器配置文件中已配置的任何缓存），默认开启
 <span class="nt">&lt;setting</span> <span class="na">name=</span><span class="s">&#34;log-impl&#34;</span> <span class="na">value=</span><span class="s">&#34;org.apache.ibatis.logging.stdout.StdOutImpl&#34;</span><span class="nt">/&gt;</span>打印日志
<span class="nt">&lt;/settings&gt;</span>

<span class="nt">&lt;typeAliases&gt;</span>
    <span class="nt">&lt;typeAlias</span> <span class="na">alias=</span><span class="s">&#34;de&#34;</span> <span class="na">type=</span><span class="s">&#34;com.lx.vo.Department&#34;</span><span class="nt">&gt;&lt;/typeAlias&gt;</span>
    <span class="nt">&lt;package</span>  <span class="na">name=</span><span class="s">&#34;com.lx.vo&#34;</span><span class="nt">/&gt;</span> <span class="c">&lt;!--扫描包,默认为该包下的bean类起别名,类名小写--&gt;</span>
<span class="nt">&lt;/typeAliases&gt;</span>
</code></pre></td></tr></table>
</div>
</div><h3 id="42environments-环境">4.2environments 环境</h3>
<p>2 <strong>environments 环境</strong> 可以配置多个，但default，每次只能指定一个。
<strong>environment 环境变量</strong> 有id，可以被environments的default指定。
<strong>transactionManager 事务管理器</strong>有两种类型，JDBC/MANAGED。（JDBC - 这个类型直接全部使用 JDBC 的提交和回滚功能。它依靠使用连接的数据源来管理事务的作用域。MANAGED - 这个类型什么不做 ， 它从不提交 、 回滚和关闭连接 。 而是让窗口来管理事务的全部生命周期 。（比如说 Spring 或者 JAVAEE 服务器）。
默认情况下它会关闭连接。然而一些容器并不希望连接被关闭，因此需要将 closeConnection 属性设置为 false 来阻止默认的关闭行为）
<strong>dataSource 数据源</strong> 有三种内建的数据源类型（也就是 type=&rdquo;[UNPOOLED|POOLED|JNDI]&quot;）,(UNPOOLED - 在每次请求的时打开和关闭一个连接。虽然慢，但适合不需性能和立即响应的简单应用 。
POOLED - 利用“池”的概念将 JDBC 连接对象组织起来，避免了创建新的连接实例时所必需的初始化和认证时间。     这种处理方式很流行，能使并发 Web 应用快速响应请求。
JNDI -  是为了准备和 Spring 或应用服务一起使用，可以在外部也可以在内部配置这个数据源，然后在 JNDI 上下文中引用它)</p>
<ul>
<li>常见数据库连接池有dbcp，c3p0，druid，HikeriCP</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-xml" data-lang="xml"><span class="nt">&lt;environments</span> <span class="na">default=</span><span class="s">&#34;development&#34;</span><span class="nt">&gt;</span><span class="c">&lt;!--环境,可以有多个environment,连接多个数据库--&gt;</span>
    <span class="nt">&lt;environment</span> <span class="na">id=</span><span class="s">&#34;development&#34;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;transactionManager</span> <span class="na">type=</span><span class="s">&#34;JDBC&#34;</span><span class="nt">/&gt;</span><span class="c">&lt;!--事务类型,有两个jdbc/managed 托管什么也不做,交由spring管理--&gt;</span>
        <span class="nt">&lt;dataSource</span> <span class="na">type=</span><span class="s">&#34;POOLED&#34;</span><span class="nt">&gt;</span>
            <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&#34;driver&#34;</span> <span class="na">value=</span><span class="s">&#34;com.mysql.jdbc.Driver&#34;</span><span class="nt">/&gt;</span>
            <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&#34;url&#34;</span> <span class="na">value=</span><span class="s">&#34;jdbc:mysql://localhost:3306/mysql1?useUnicode=true&amp;amp;characterEncoding=UTF-8&amp;amp;useSSL=false&#34;</span><span class="nt">/&gt;</span>
            <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&#34;username&#34;</span> <span class="na">value=</span><span class="s">&#34;root&#34;</span><span class="nt">/&gt;</span>
            <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&#34;password&#34;</span> <span class="na">value=</span><span class="s">&#34;123456&#34;</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;/dataSource&gt;</span>
    <span class="nt">&lt;/environment&gt;</span>
<span class="nt">&lt;/environments&gt;</span>
</code></pre></td></tr></table>
</div>
</div><h3 id="43mapperxml">4.3mapper.xml</h3>
<p>我们现在就要来定义 SQL 映射语句了。 但首先，我们需要告诉 MyBatis 到哪里去找到这些语句。 在自动查找资源方面，Java 并没有提供一个很好的解决方案，所以最好的办法是直接告诉 MyBatis 到哪里去找映射文件。</p>
<ul>
<li>注意：dao接口和mapper.xml文件最好同名(class,package方式规定)，而且必须在同一个包下。</li>
<li>一般采用方式一。<code>&lt;!--注解用class xml用resource--&gt;</code></li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-xml" data-lang="xml"><span class="c">&lt;!-- 使用相对于类路径的资源引用 要释放资源 --&gt;</span>
<span class="nt">&lt;mappers&gt;</span>
  <span class="nt">&lt;mapper</span> <span class="na">resource=</span><span class="s">&#34;org/mybatis/builder/AuthorMapper.xml&#34;</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/mappers&gt;</span>

<span class="c">&lt;!-- 使用映射器接口实现类的完全限定类名
</span><span class="c">	使用class可能会出现一些问题，它需要dao接口和mapper同名。而且需要在同一包下
</span><span class="c"> --&gt;</span>
<span class="nt">&lt;mappers&gt;</span>
  <span class="nt">&lt;mapper</span> <span class="na">class=</span><span class="s">&#34;org.mybatis.builder.AuthorMapper&#34;</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/mappers&gt;</span>

<span class="c">&lt;!-- 将包内的映射器接口实现全部注册为映射器
</span><span class="c">使用包扫描和class注意点是一致的。 
</span><span class="c">--&gt;</span>
<span class="nt">&lt;mappers&gt;</span>
  <span class="nt">&lt;package</span> <span class="na">name=</span><span class="s">&#34;org.mybatis.builder&#34;</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/mappers&gt;</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="5生命周期">5生命周期</h2>
<p><strong>SqlSessionFactoryBuilder</strong></p>
<p>这个类可以被实例化、使用和丢弃，一旦创建了 SqlSessionFactory，就不再需要它了。 因此 SqlSessionFactoryBuilder 实例的最佳作用域是方法作用域（也就是局部方法变量）。不要一直保留着它，以保证所有的 XML 解析资源可以被释放给更重要的事情。</p>
<p><strong>SqlSessionFactory</strong></p>
<p>SqlSessionFactory 一旦被创建就应该在应用的运行期间一直存在，没有任何理由丢弃它或重新创建另一个实例。 使用 SqlSessionFactory 的最佳实践是在应用运行期间不要重复创建多次， 有很多方法可以做到，最简单的就是使用单例模式或者静态单例模式。</p>
<p><strong>SqlSession</strong></p>
<p>每个线程都应该有它自己的 SqlSession 实例。SqlSession 的实例不是线程安全的，因此是不能被共享的，所以它的最佳的作用域是请求或方法作用域。 绝对不能将 SqlSession 实例的引用放在一个类的静态域，甚至一个类的实例变量也不行。 也绝不能将 SqlSession 实例的引用放在任何类型的托管作用域中，比如 Servlet 框架中的 HttpSession。 如果你现在正在使用一种 Web 框架，考虑将 SqlSession 放在一个和 HTTP 请求相似的作用域中。 换句话说，每次收到 HTTP 请求，就可以打开一个 SqlSession，返回一个响应后，就关闭它。 这个关闭操作很重要，为了确保每次都能执行关闭操作，你应该把这个关闭操作放到 finally 块中。 下面的示例就是一个确保 SqlSession 关闭的标准模式：</p>
<h2 id="6mybatis日志">6MyBatis日志</h2>
<p>logImpl 指定 MyBatis 所用日志的具体实现，未指定时将自动查找。
取值比较常用的有两个： LOG4J 、STDOUT_LOGGING（标准日志输出）</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-xml" data-lang="xml"><span class="nt">&lt;settings&gt;</span>
   <span class="c">&lt;!-- &lt;setting name=&#34;logImpl&#34; value=&#34;STDOUT_LOGGING&#34;/&gt;&amp;lt;!&amp;ndash;加上就可以使用&amp;ndash;&amp;gt;--&gt;</span>
    <span class="nt">&lt;setting</span> <span class="na">name=</span><span class="s">&#34;logImpl&#34;</span> <span class="na">value=</span><span class="s">&#34;LOG4J&#34;</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/settings&gt;</span>
</code></pre></td></tr></table>
</div>
</div><h1 id="第二章-sql语句">第二章-SQL语句</h1>
<p>面对复杂的属性需要单独处理。
对象使用(多对一)：&lt;association&gt;<code>əˌsoʊsiˈeɪʃn</code> 协会，联想，组合
集合使用(一对多)：&lt;collection&gt;</p>
<h2 id="1多对一">1多对一</h2>
<p>查询所有员工的部门。</p>
<p>实体类</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="nd">@Data</span>
<span class="nd">@AllArgsConstructor</span>
<span class="nd">@NoArgsConstructor</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Staff</span> <span class="o">{</span>
<span class="c1">//多对一  职员需要一个部门 staff need a department
</span><span class="c1"></span><span class="kd">private</span> <span class="n">Integer</span> <span class="n">id</span><span class="o">;</span>
<span class="kd">private</span> <span class="n">String</span> <span class="n">name</span><span class="o">;</span>
<span class="kd">private</span> <span class="n">Integer</span> <span class="n">age</span><span class="o">;</span>
<span class="kd">private</span> <span class="n">Date</span> <span class="n">birth</span><span class="o">;</span>
<span class="kd">private</span> <span class="n">Integer</span> <span class="n">department</span><span class="o">;</span><span class="c1">//save a department table primary id
</span><span class="c1"></span>
<span class="kd">private</span> <span class="n">Department</span> <span class="n">departmentVo</span><span class="o">;</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><p>方式一：结果嵌套查询(两个查询，推荐使用方式二，容易理解)</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-xml" data-lang="xml"><span class="nt">&lt;association</span> <span class="na">property=</span><span class="s">&#34;departmentVo写实体类的属性名&#34;</span> 
       <span class="na">column=</span><span class="s">&#34;department当前查询中表中和第三表连接的Id(也是要传给select的查询条件)
</span><span class="s">               当条件有多个时， column=&#34;</span><span class="err">{</span><span class="na">key传给select的括号中的命名=</span><span class="s">value当前表的字段,key=value}&#34;</span> <span class="err">&#34;</span> 
       <span class="na">javaType=</span><span class="s">&#34;Department实体类的类名&#34;</span>
       <span class="na">select=</span><span class="s">&#34;getDepartment1所对应的查询的id&#34;</span><span class="nt">/&gt;</span>
</code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-xml" data-lang="xml"><span class="nt">&lt;mapper</span> <span class="na">namespace=</span><span class="s">&#34;com.lx.dao.StaffDao&#34;</span><span class="nt">&gt;</span>
<span class="nt">&lt;select</span> <span class="na">id=</span><span class="s">&#34;selectAllStaffBySelect&#34;</span> <span class="na">resultMap=</span><span class="s">&#34;staffBySelectMap&#34;</span><span class="nt">&gt;</span>
    select * from staff
<span class="nt">&lt;/select&gt;</span>
    <span class="nt">&lt;resultMap</span> <span class="na">id=</span><span class="s">&#34;staffBySelectMap&#34;</span> <span class="na">type=</span><span class="s">&#34;Staff&#34;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;result</span> <span class="na">property=</span><span class="s">&#34;id&#34;</span> <span class="na">column=</span><span class="s">&#34;id&#34;</span><span class="nt">&gt;&lt;/result&gt;</span> <span class="c">&lt;!--property指的是VO类中的属性,column是数据库表的字段--&gt;</span>
        <span class="nt">&lt;result</span> <span class="na">property=</span><span class="s">&#34;name&#34;</span> <span class="na">column=</span><span class="s">&#34;name&#34;</span><span class="nt">&gt;&lt;/result&gt;</span>
        <span class="nt">&lt;result</span> <span class="na">property=</span><span class="s">&#34;age&#34;</span> <span class="na">column=</span><span class="s">&#34;age&#34;</span><span class="nt">&gt;&lt;/result&gt;</span>
        <span class="nt">&lt;result</span> <span class="na">property=</span><span class="s">&#34;birth&#34;</span> <span class="na">column=</span><span class="s">&#34;birth&#34;</span><span class="nt">&gt;&lt;/result&gt;</span>
        <span class="nt">&lt;result</span> <span class="na">property=</span><span class="s">&#34;department&#34;</span> <span class="na">column=</span><span class="s">&#34;department&#34;</span><span class="nt">&gt;&lt;/result&gt;</span>
        <span class="c">&lt;!--property是VO类属性名称,department是表中连接的id,javaType是VO属性的类型--&gt;</span>
        <span class="nt">&lt;association</span> <span class="na">property=</span><span class="s">&#34;departmentVo&#34;</span> <span class="na">column=</span><span class="s">&#34;department&#34;</span> 
                     <span class="na">javaType=</span><span class="s">&#34;Department&#34;</span> <span class="na">select=</span><span class="s">&#34;getDepartment1&#34;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;/resultMap&gt;</span>
  
    <span class="nt">&lt;select</span> <span class="na">id=</span><span class="s">&#34;getDepartment1&#34;</span> <span class="na">resultType=</span><span class="s">&#34;Department&#34;</span><span class="nt">&gt;</span>
/*这里传递过来的id，只有一个属性的时候，下面可以写任何值
    association中column多参数配置：
   column=&#34;{key=value,key=value}&#34;
  其实就是键值对的形式，key是传给下个sql的取值名称，value是片段一中sql查询的字段名。*/
        select did,dname,parentDept1 from department where did =#{id}
    <span class="nt">&lt;/select&gt;</span>
</code></pre></td></tr></table>
</div>
</div><p>方式二：联表查询</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-xml" data-lang="xml"><span class="nt">&lt;select</span> <span class="na">id=</span><span class="s">&#34;getStaffById1&#34;</span> <span class="na">resultMap=</span><span class="s">&#34;oneStaffMap&#34;</span><span class="nt">&gt;</span>
  <span class="c">&lt;!--多对一查询单个staff,方式二:联表查询--&gt;</span>
select s.id,s.name,s.age,s.birth,s.department,d.did,d.dname,d.parentDept1 from staff s left join department d
 on s.department=d.did where s.id=#{id}
<span class="nt">&lt;/select&gt;</span>
<span class="nt">&lt;resultMap</span> <span class="na">id=</span><span class="s">&#34;oneStaffMap&#34;</span> <span class="na">type=</span><span class="s">&#34;staff&#34;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;result</span> <span class="na">property=</span><span class="s">&#34;id&#34;</span> <span class="na">column=</span><span class="s">&#34;id&#34;</span><span class="nt">&gt;&lt;/result&gt;</span> <span class="c">&lt;!--property指的是VO类中的属性,column是数据库表的字段--&gt;</span>
    <span class="nt">&lt;result</span> <span class="na">property=</span><span class="s">&#34;name&#34;</span> <span class="na">column=</span><span class="s">&#34;name&#34;</span><span class="nt">&gt;&lt;/result&gt;</span>
    <span class="nt">&lt;result</span> <span class="na">property=</span><span class="s">&#34;age&#34;</span> <span class="na">column=</span><span class="s">&#34;age&#34;</span><span class="nt">&gt;&lt;/result&gt;</span>
    <span class="nt">&lt;result</span> <span class="na">property=</span><span class="s">&#34;birth&#34;</span> <span class="na">column=</span><span class="s">&#34;birth&#34;</span><span class="nt">&gt;&lt;/result&gt;</span>
    <span class="nt">&lt;result</span> <span class="na">property=</span><span class="s">&#34;department&#34;</span> <span class="na">column=</span><span class="s">&#34;department&#34;</span><span class="nt">&gt;&lt;/result&gt;</span>
    <span class="nt">&lt;association</span> <span class="na">property=</span><span class="s">&#34;departmentVo&#34;</span> <span class="na">javaType=</span><span class="s">&#34;department&#34;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;result</span> <span class="na">property=</span><span class="s">&#34;did&#34;</span> <span class="na">column=</span><span class="s">&#34;did&#34;</span><span class="nt">&gt;&lt;/result&gt;</span>
        <span class="nt">&lt;result</span> <span class="na">property=</span><span class="s">&#34;dname&#34;</span> <span class="na">column=</span><span class="s">&#34;dname&#34;</span><span class="nt">&gt;&lt;/result&gt;</span>
        <span class="nt">&lt;result</span> <span class="na">property=</span><span class="s">&#34;parentDept1&#34;</span> <span class="na">column=</span><span class="s">&#34;parentDept1&#34;</span><span class="nt">&gt;&lt;/result&gt;</span>
    <span class="nt">&lt;/association&gt;</span>
<span class="nt">&lt;/resultMap&gt;</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="2一对多">2一对多</h2>
<p>实体类</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="nd">@Data</span>
<span class="nd">@AllArgsConstructor</span>
<span class="nd">@NoArgsConstructor</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Department</span> <span class="o">{</span>

<span class="kd">private</span> <span class="n">Integer</span> <span class="n">did</span><span class="o">;</span>
<span class="kd">private</span> <span class="n">String</span> <span class="n">dname</span><span class="o">;</span>
<span class="kd">private</span> <span class="n">Integer</span> <span class="n">parentDept1</span><span class="o">;</span>
<span class="c1">//若是MybatisPlus @TableField(exist=false)
</span><span class="c1"></span><span class="kd">private</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">Staff</span><span class="o">&gt;</span> <span class="n">staffs</span><span class="o">;</span>

<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><p>方式一:查询嵌套处理 (两个查询，推荐使用方式二，容易理解)</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-xml" data-lang="xml"><span class="nt">&lt;mapper</span> <span class="na">namespace=</span><span class="s">&#34;com.lx.dao.DepartmentDao&#34;</span><span class="nt">&gt;</span>
    <span class="c">&lt;!--一对多 部门多个职员 方式一:查询嵌套处理 --&gt;</span>
    <span class="nt">&lt;select</span> <span class="na">id=</span><span class="s">&#34;selectAllDepartment&#34;</span> <span class="na">resultMap=</span><span class="s">&#34;departmentStaffsMap&#34;</span><span class="nt">&gt;</span>
    select * from department
    <span class="nt">&lt;/select&gt;</span>
    
    <span class="nt">&lt;resultMap</span> <span class="na">id=</span><span class="s">&#34;departmentStaffsMap&#34;</span> <span class="na">type=</span><span class="s">&#34;department&#34;</span><span class="nt">&gt;</span>
        <span class="c">&lt;!--column是一对多的外键 , 写的是一的主键的列名
</span><span class="c">						和多对一一样,column=&#34;k=v,k=v&#34;--&gt;</span>
        <span class="nt">&lt;collection</span> <span class="na">property=</span><span class="s">&#34;staffs&#34;</span> <span class="na">javaType=</span><span class="s">&#34;ArrayList&#34;</span> <span class="na">ofType=</span><span class="s">&#34;Staff&#34;</span>
        <span class="na">column=</span><span class="s">&#34;did&#34;</span> <span class="na">select=</span><span class="s">&#34;getStaffs&#34;</span><span class="nt">&gt;&lt;/collection&gt;</span>
    <span class="nt">&lt;/resultMap&gt;</span>
    
    <span class="nt">&lt;select</span> <span class="na">id=</span><span class="s">&#34;getStaffs&#34;</span> <span class="na">resultType=</span><span class="s">&#34;Staff&#34;</span><span class="nt">&gt;</span>
        select * from staff where department=#{did}
    <span class="nt">&lt;/select&gt;</span>
</code></pre></td></tr></table>
</div>
</div><p>方式二：查询结果映射处理
==property指的是实体类的did==
==column指的是查询语句的列名==</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-xml" data-lang="xml"><span class="nt">&lt;select</span> <span class="na">id=</span><span class="s">&#34;selectOneDepartment&#34;</span> <span class="na">resultMap=</span><span class="s">&#34;departmentMap&#34;</span><span class="nt">&gt;</span>
select d.did,d.dname,d.parentDept1,
s.id as sid,s.name as sname,s.age as sage,s.birth as sbirth,s.department as sdepartment
from department d left join staff s on d.did=s.department where d.did=#{id}
<span class="nt">&lt;/select&gt;</span>
<span class="nt">&lt;resultMap</span> <span class="na">id=</span><span class="s">&#34;departmentMap&#34;</span> <span class="na">type=</span><span class="s">&#34;Department&#34;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;result</span> <span class="na">property=</span><span class="s">&#34;did&#34;</span> <span class="na">column=</span><span class="s">&#34;did&#34;</span><span class="nt">&gt;&lt;/result&gt;</span>
    <span class="nt">&lt;result</span> <span class="na">property=</span><span class="s">&#34;dname&#34;</span> <span class="na">column=</span><span class="s">&#34;dname&#34;</span><span class="nt">&gt;&lt;/result&gt;</span>
    <span class="nt">&lt;result</span> <span class="na">property=</span><span class="s">&#34;parentDept1&#34;</span> <span class="na">column=</span><span class="s">&#34;parentDept1&#34;</span><span class="nt">&gt;&lt;/result&gt;</span>
    <span class="nt">&lt;collection</span> <span class="na">property=</span><span class="s">&#34;staffs&#34;</span> <span class="na">ofType=</span><span class="s">&#34;staff&#34;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;result</span> <span class="na">property=</span><span class="s">&#34;id&#34;</span> <span class="na">column=</span><span class="s">&#34;sid&#34;</span><span class="nt">&gt;&lt;/result&gt;</span>
        <span class="nt">&lt;result</span> <span class="na">property=</span><span class="s">&#34;name&#34;</span> <span class="na">column=</span><span class="s">&#34;sname&#34;</span><span class="nt">&gt;&lt;/result&gt;</span>
        <span class="nt">&lt;result</span> <span class="na">property=</span><span class="s">&#34;age&#34;</span> <span class="na">column=</span><span class="s">&#34;sage&#34;</span><span class="nt">&gt;&lt;/result&gt;</span>
        <span class="nt">&lt;result</span> <span class="na">property=</span><span class="s">&#34;birth&#34;</span> <span class="na">column=</span><span class="s">&#34;sbirth&#34;</span><span class="nt">&gt;&lt;/result&gt;</span>
        <span class="nt">&lt;result</span> <span class="na">property=</span><span class="s">&#34;department&#34;</span> <span class="na">column=</span><span class="s">&#34;sdepartment&#34;</span><span class="nt">&gt;&lt;/result&gt;</span>
    <span class="nt">&lt;/collection&gt;</span>
<span class="nt">&lt;/resultMap&gt;</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="3动态sql">3动态SQL</h2>
<h3 id="31-whereifset">3.1 where/if/set</h3>
<p><em>where</em> 元素只会在子元素返回任何内容的情况下才插入 “WHERE” 子句。
若子句的开头为 “AND” 或 “OR”，<em>where</em> 元素也会将它们去除。</p>
<p>用双等号</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-xml" data-lang="xml"><span class="nt">&lt;select</span> <span class="na">id=</span><span class="s">&#34;selectAllStaffByCondition1&#34;</span> <span class="na">parameterType=</span><span class="s">&#34;map&#34;</span> <span class="na">resultType=</span><span class="s">&#34;staff&#34;</span><span class="nt">&gt;</span>
    select * from staff
    <span class="nt">&lt;where&gt;</span>
        <span class="nt">&lt;if</span> <span class="na">test=</span><span class="s">&#34;name != null&#34;</span><span class="nt">&gt;</span>
            name=#{name}
        <span class="nt">&lt;/if&gt;</span>
        <span class="nt">&lt;if</span> <span class="na">test=</span><span class="s">&#34;age != null&#34;</span><span class="nt">&gt;</span>
            and age=#{age}
        <span class="nt">&lt;/if&gt;</span>
    <span class="nt">&lt;/where&gt;</span>
<span class="nt">&lt;/select&gt;</span>
</code></pre></td></tr></table>
</div>
</div><p><em>set</em> 元素会动态地在行首插入 SET 关键字，并会删掉额外的逗号（这些逗号是在使用条件语句给列赋值时引入的）</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-xml" data-lang="xml"><span class="c">&lt;!--动态sql update--&gt;</span>
<span class="nt">&lt;update</span> <span class="na">id=</span><span class="s">&#34;updateOneStaffByCondition&#34;</span> <span class="na">parameterType=</span><span class="s">&#34;map&#34;</span> <span class="nt">&gt;</span>
    update  staff
    <span class="nt">&lt;set</span> <span class="nt">&gt;</span>
            <span class="nt">&lt;if</span> <span class="na">test=</span><span class="s">&#34;name != null&#34;</span><span class="nt">&gt;</span> name=#{name},<span class="nt">&lt;/if&gt;</span>
            <span class="nt">&lt;if</span> <span class="na">test=</span><span class="s">&#34;age != null&#34;</span><span class="nt">&gt;</span>  age=#{age}, <span class="nt">&lt;/if&gt;</span>
    <span class="nt">&lt;/set&gt;</span>where id=#{id}
<span class="nt">&lt;/update&gt;</span>
</code></pre></td></tr></table>
</div>
</div><h3 id="32choosewhen">3.2choose/when</h3>
<p>想从多个条件中<strong>选择一个使用</strong>。针对这种情况，MyBatis 提供了 choose 元素，它有点像 Java 中的 switch 语句。
otherwise都不成立</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-xml" data-lang="xml"><span class="nt">&lt;select</span> <span class="na">id=</span><span class="s">&#34;selectAllStaffByCondition2&#34;</span> <span class="na">parameterType=</span><span class="s">&#34;map&#34;</span> <span class="na">resultType=</span><span class="s">&#34;staff&#34;</span><span class="nt">&gt;</span>
    select * from staff
    <span class="nt">&lt;where</span> <span class="nt">&gt;</span>
        <span class="nt">&lt;choose&gt;</span>
            <span class="nt">&lt;when</span> <span class="na">test=</span><span class="s">&#34;name != null&#34;</span><span class="nt">&gt;</span> name=#{name} <span class="nt">&lt;/when&gt;</span>
            <span class="nt">&lt;when</span> <span class="na">test=</span><span class="s">&#34;age != null&#34;</span><span class="nt">&gt;</span> and age=#{age} <span class="nt">&lt;/when&gt;</span>
            <span class="nt">&lt;otherwise</span> <span class="nt">&gt;</span>and name=1<span class="nt">&lt;/otherwise&gt;</span>
        <span class="nt">&lt;/choose&gt;</span>
    <span class="nt">&lt;/where&gt;</span>
<span class="nt">&lt;/select&gt;</span>
</code></pre></td></tr></table>
</div>
</div><h3 id="33foreachsqltrim">3.3foreach/sql/trim</h3>
<p><strong>foreach</strong>动态 SQL 的另一个常见使用场景是对集合进行遍历（尤其是在构建 IN 条件语句的时候）
<strong>若参数是对象集合</strong><code>ArrayList&lt;Employee&gt;</code>则在item使用参数时，需要item.oid</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-xml" data-lang="xml">collection:指定输入对象中的集合类型 array list map

item:每次遍历生成的对象
open:开始遍历时的拼接字符串
close:结束时拼接的字符串
separator:遍历对象之间需要拼接的字符串
<span class="nt">&lt;select</span> <span class="na">id=</span><span class="s">&#34;selectPostIn&#34;</span> <span class="na">resultType=</span><span class="s">&#34;domain.blog.Post&#34;</span><span class="nt">&gt;</span>
  SELECT *
  FROM POST P
  WHERE ID in
  <span class="nt">&lt;foreach</span> <span class="na">item=</span><span class="s">&#34;dept&#34;</span> <span class="na">index=</span><span class="s">&#34;index&#34;</span> <span class="na">collection=</span><span class="s">&#34;list&#34;</span>
      <span class="na">open=</span><span class="s">&#34;(&#34;</span> <span class="na">separator=</span><span class="s">&#34;,&#34;</span> <span class="na">close=</span><span class="s">&#34;)&#34;</span><span class="nt">&gt;</span>
        #{dept.empname}
  <span class="nt">&lt;/foreach&gt;</span>
<span class="nt">&lt;/select&gt;</span>
</code></pre></td></tr></table>
</div>
</div><p><strong>sql</strong></p>
<p>用&lt;sql&gt;和&lt;include&gt;标签可以重复利用sql片段。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">&lt;sql id=&#34;if_name_age&#34;&gt;
  &lt;if test=&#34;name != null&#34;&gt;
    name=#{name}
  &lt;/if&gt;
  &lt;if test=&#34;age != null&#34;&gt;
    and age=#{age}
  &lt;/if&gt;
&lt;/sql&gt;
    &lt;!--动态sql where /set--&gt;
&lt;select id=&#34;selectAllStaffByCondition1&#34; parameterType=&#34;map&#34; resultType=&#34;staff&#34;&gt;
    select * from staff
    &lt;trim prefix=&#34;where&#34; prefixOverrides=&#34;AND |or&#34;&gt;
        &lt;include refid=&#34;if_name_age&#34;&gt;&lt;/include&gt;
    &lt;/trim&gt;
&lt;/select&gt;
</code></pre></td></tr></table>
</div>
</div><p><strong>trim实际是set和where的基础</strong>。
prefix指得是前置，当trim字句中有符合条件选项时，就加上前置set。
suffixOverrides指的是后置overrides重写，去除逗号。
prefixOverrides是前置overrides重写，去除AND 或者OR</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-xml" data-lang="xml"><span class="nt">&lt;trim</span> <span class="na">prefix=</span><span class="s">&#34;SET&#34;</span> <span class="na">suffixOverrides=</span><span class="s">&#34;,&#34;</span><span class="nt">&gt;</span>
  ...
<span class="nt">&lt;/trim&gt;</span>
<span class="nt">&lt;trim</span> <span class="na">prefix=</span><span class="s">&#34;WHERE&#34;</span> <span class="na">prefixOverrides=</span><span class="s">&#34;AND |OR &#34;</span><span class="nt">&gt;</span>
  ...
<span class="nt">&lt;/trim&gt;</span>
</code></pre></td></tr></table>
</div>
</div><h1 id="第三章-缓存">第三章-缓存</h1>
<h2 id="1缓存介绍">1缓存介绍</h2>
<p>1.什么是缓存[ Cache ]?
存在内存中的临时数据。
将用户经常查询的数据放在缓存(内存)中,用户去查询数据就不用从磁盘上(关系型数据库数据文件)查
询，从缓存中查询，从而提高查询效率，解决了高并发系统的性能问题。</p>
<p>2.为什么使用缓存?
减少和数据库的交互次数，减少系统开销，提高系统效率。</p>
<p>3.什么样的数据能使用缓存?
经常查询并且不经常改变的数据。</p>
<h2 id="2mybatis缓存">2MyBatis缓存</h2>
<p>●MyBatis包含一 个非常强大的查询缓存特性， 它可以非常方便地定制和配置缓存。缓存可以极大的提升查询效
率。
●MyBatis系统中默认定义了两级缓存: 一级缓存和二级缓存
。默认情况下，只有一级缓存开启。 (SqISession级别的缓存， 也称为本地缓存)
。二级缓存需要手动开启和配置，他是基于namespace级别的缓存(一个接口,一个Mapper)。
。为了提高扩展性，MyBatis定义了缓存接口Cache。我们可以通过实现Cache接口来自定义二级缓存</p>
<h2 id="3一级缓存">3一级缓存</h2>
<p>●-级缓存也叫本地缓存: SqlSession 默认是开启状态
。与数据库同一次会话期间查询到的数据会放在本地缓存中。
。以后如果需要获取相同的数据，直接从缓存中拿，没必须再去查询数据库;</p>
<p>缓存失效的情况:
1.查询不同的东西
2.增删改操作，可能会改变原来的数据，所以必定会刷新缓存!
3.查询不同的Mapper.xml
4.手动清理缓存!sqlSession.clearCache();</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"> <span class="n">StaffDao</span> <span class="n">staffDao</span><span class="o">=</span><span class="n">sqlSession</span><span class="o">.</span><span class="na">getMapper</span><span class="o">(</span><span class="n">StaffDao</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
 <span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span><span class="n">Object</span><span class="o">&gt;</span> <span class="n">map</span><span class="o">=</span><span class="k">new</span> <span class="n">HashMap</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span><span class="n">Object</span><span class="o">&gt;();</span>
         <span class="n">map</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">&#34;name&#34;</span><span class="o">,</span><span class="s">&#34;a1&#34;</span><span class="o">);</span>
         <span class="n">map</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">&#34;age&#34;</span><span class="o">,</span><span class="n">3</span><span class="o">);</span>
<span class="n">List</span><span class="o">&lt;</span><span class="n">Staff</span><span class="o">&gt;</span> <span class="n">list</span><span class="o">=</span> <span class="n">staffDao</span><span class="o">.</span><span class="na">selectAllStaffByCondition</span><span class="o">(</span><span class="n">map</span><span class="o">);</span>
 <span class="n">list</span><span class="o">.</span><span class="na">forEach</span><span class="o">(</span><span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">::</span><span class="n">println</span><span class="o">);</span>
 <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;==========================&#34;</span><span class="o">);</span>
 <span class="n">List</span><span class="o">&lt;</span><span class="n">Staff</span><span class="o">&gt;</span> <span class="n">list1</span><span class="o">=</span> <span class="n">staffDao</span><span class="o">.</span><span class="na">selectAllStaffByCondition</span><span class="o">(</span><span class="n">map</span><span class="o">);</span>
 <span class="n">list1</span><span class="o">.</span><span class="na">forEach</span><span class="o">(</span><span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">::</span><span class="n">println</span><span class="o">);</span>

<span class="o">==================</span><span class="n">下面是日志</span><span class="o">========================</span>
<span class="o">[</span><span class="n">com</span><span class="o">.</span><span class="na">lx</span><span class="o">.</span><span class="na">dao</span><span class="o">.</span><span class="na">StaffDao</span><span class="o">.</span><span class="na">selectAllStaffByCondition</span><span class="o">]-==&gt;</span>  <span class="n">Preparing</span><span class="o">:</span> <span class="n">select</span> <span class="o">*</span> <span class="n">from</span> <span class="n">staff</span> <span class="n">WHERE</span> <span class="n">name</span><span class="o">=?</span> <span class="n">or</span> <span class="n">age</span><span class="o">=?</span> 
<span class="o">[</span><span class="n">com</span><span class="o">.</span><span class="na">lx</span><span class="o">.</span><span class="na">dao</span><span class="o">.</span><span class="na">StaffDao</span><span class="o">.</span><span class="na">selectAllStaffByCondition</span><span class="o">]-==&gt;</span> <span class="n">Parameters</span><span class="o">:</span> <span class="n">a1</span><span class="o">(</span><span class="n">String</span><span class="o">),</span> <span class="n">3</span><span class="o">(</span><span class="n">Integer</span><span class="o">)</span>
<span class="o">[</span><span class="n">com</span><span class="o">.</span><span class="na">lx</span><span class="o">.</span><span class="na">dao</span><span class="o">.</span><span class="na">StaffDao</span><span class="o">.</span><span class="na">selectAllStaffByCondition</span><span class="o">]-&lt;==</span>      <span class="n">Total</span><span class="o">:</span> <span class="n">2</span>
<span class="nf">Staff</span><span class="o">(</span><span class="n">id</span><span class="o">=</span><span class="n">1021</span><span class="o">,</span> <span class="n">name</span><span class="o">=</span><span class="n">a11</span><span class="o">,</span> <span class="n">age</span><span class="o">=</span><span class="n">3</span><span class="o">,</span> <span class="n">birth</span><span class="o">=</span><span class="n">Fri</span> <span class="n">May</span> <span class="n">02</span> <span class="n">12</span><span class="o">:</span><span class="n">22</span><span class="o">:</span><span class="n">15</span> <span class="n">CST</span> <span class="n">1997</span><span class="o">,</span> <span class="n">department</span><span class="o">=</span><span class="kc">null</span><span class="o">,</span> <span class="n">departmentVo</span><span class="o">=</span><span class="kc">null</span><span class="o">)</span>
<span class="n">Staff</span><span class="o">(</span><span class="n">id</span><span class="o">=</span><span class="n">1022</span><span class="o">,</span> <span class="n">name</span><span class="o">=</span><span class="n">a1</span><span class="o">,</span> <span class="n">age</span><span class="o">=</span><span class="n">3</span><span class="o">,</span> <span class="n">birth</span><span class="o">=</span><span class="n">Thu</span> <span class="n">May</span> <span class="n">02</span> <span class="n">12</span><span class="o">:</span><span class="n">22</span><span class="o">:</span><span class="n">15</span> <span class="n">CDT</span> <span class="n">1991</span><span class="o">,</span> <span class="n">department</span><span class="o">=</span><span class="n">2</span><span class="o">,</span> <span class="n">departmentVo</span><span class="o">=</span><span class="kc">null</span><span class="o">)</span>
<span class="o">==========================</span>
<span class="n">Staff</span><span class="o">(</span><span class="n">id</span><span class="o">=</span><span class="n">1021</span><span class="o">,</span> <span class="n">name</span><span class="o">=</span><span class="n">a11</span><span class="o">,</span> <span class="n">age</span><span class="o">=</span><span class="n">3</span><span class="o">,</span> <span class="n">birth</span><span class="o">=</span><span class="n">Fri</span> <span class="n">May</span> <span class="n">02</span> <span class="n">12</span><span class="o">:</span><span class="n">22</span><span class="o">:</span><span class="n">15</span> <span class="n">CST</span> <span class="n">1997</span><span class="o">,</span> <span class="n">department</span><span class="o">=</span><span class="kc">null</span><span class="o">,</span> <span class="n">departmentVo</span><span class="o">=</span><span class="kc">null</span><span class="o">)</span>
<span class="n">Staff</span><span class="o">(</span><span class="n">id</span><span class="o">=</span><span class="n">1022</span><span class="o">,</span> <span class="n">name</span><span class="o">=</span><span class="n">a1</span><span class="o">,</span> <span class="n">age</span><span class="o">=</span><span class="n">3</span><span class="o">,</span> <span class="n">birth</span><span class="o">=</span><span class="n">Thu</span> <span class="n">May</span> <span class="n">02</span> <span class="n">12</span><span class="o">:</span><span class="n">22</span><span class="o">:</span><span class="n">15</span> <span class="n">CDT</span> <span class="n">1991</span><span class="o">,</span> <span class="n">department</span><span class="o">=</span><span class="n">2</span><span class="o">,</span> <span class="n">departmentVo</span><span class="o">=</span><span class="kc">null</span><span class="o">)</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="4二级缓存">4二级缓存</h2>
<p>●二级缓存也叫全局缓存，-级缓存作用域太低了,所以诞生了二级缓存
●基于namespace级别的缓存，一个名称空间，对应一一个二级缓存;
●工作机制：一个会话查询一条数据，这个数据就会被放在当前会话的一级缓存中。
当前会话关闭，对应的一级缓存就没了，但一级缓存的数据会被保存到二级缓存中。
新的会话查询信息，就可以从二级缓存中获取内容。
不同的mapper查出的数据会放在自己对应的缓存(map)中。</p>
<p>注意：二级缓存需要实现Serializable接口。</p>
<p>一级缓存只存在一个sqlSession中，默认开启，如果要开启二级缓存就在映射文件mapper.xml文件中配置一个标签就好了。&lt;cache/&gt;</p>
<p>基本上就是这样。这个简单语句的效果如下:
●映射语句文件中的所有select语句的结果将会被缓存。
●映射语句文件中的所有insert. update 和delete语句会刷新缓存。
●缓存会使用最近最少使用算法(LRU, Least Recently Used)算法来清除不需要的缓存。
●缓存不会定时进行刷新(也就是说，没有刷新间隔)。
●缓存会保存列表或对象(无论查询方法返回哪种)的1024个引用。
●缓存会被视为读/写缓存，这意味着获取到的对象并不是共享的，可以安全地被调用者修改,而不干扰其他调用者或线程所做的潜在修改。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-xml" data-lang="xml"><span class="nt">&lt;cache</span>
<span class="na">eviction=</span><span class="s">&#34;FIFO&#34;</span>
<span class="na">flushInterval=</span> <span class="s">&#34;60000&#34;</span>
<span class="na">size=</span><span class="s">&#34;512&#34;</span>
<span class="na">readonly=</span> <span class="s">&#34;true&#34;</span><span class="nt">/&gt;</span>

</code></pre></td></tr></table>
</div>
</div><p><strong>eviction</strong>可用的清除策略有:
LRU -最近最少使用:移除最长时间不被使用的对象。
FIFO -先进先出:按对象进入缓存的顺序来移除它们。
SOFT -软引用:基于垃圾回收器状态和软引用规则移除对象。
WEAK -弱引用:更积极地基于垃圾收集器状态和弱引用规则移除对象。
默认的清除策略是LRU。</p>
<p><strong>flushInterval</strong> (刷新间隔)属性可以被设置为任意的正整数,设置的值应该是- -个以亳秒为单位的合理时间量。默认情况是不设置, 也就是没有刷新间隔，缓存仅仅
会在调用语句时刷新。
<strong>size</strong> (引用数目)属性可以被设置为任意正整数，要注意欲缓存对象的大小和运行环境中可用的内存资源。默认值是1024。
<strong>readOnly</strong> (只读)属性可以被设置为true或false。只读的缓存会给所有调用者返回缓存对象的相同实例。因此这些对象不能被修改。 这就提供了可观的性能提
升。而可读写的缓存会(通过序列化)返回缓存对象的拷贝。速度上会慢一些， 但是更安全，因此默认值是false。</p>
<h3 id="注意-------">注意&mdash;&mdash;-</h3>
<blockquote>
<p>可以在Mapper的具体方法下设置对二级缓存的访问意愿：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-xml" data-lang="xml"><span class="nt">&lt;select</span> <span class="na">id=</span><span class="s">&#34;save&#34;</span>
        <span class="na">parameterType=</span><span class="s">&#34;XX&#34;</span>
        <span class="na">flushCache=</span><span class="s">&#34;true&#34;</span> 
        <span class="na">useCache=</span><span class="s">&#34;false&#34;</span><span class="nt">&gt;</span> <span class="nt">&lt;/select&gt;</span>
</code></pre></td></tr></table>
</div>
</div><p>如果没有去配置flushCache、useCache，那么默认是启用缓存的</p>
<ul>
<li>flushCache默认为false，表示任何时候语句被调用，都不会去清空本地缓存和二级缓存。</li>
<li>useCache默认为true，表示会将本条语句的结果进行二级缓存。</li>
<li>在insert、update、delete语句时： flushCache默认为true，表示任何时候语句被调用，都会导致本地缓存和二级缓存被清空。 useCache属性在该情况下没有。update 的时候如果 flushCache=&quot;false&rdquo;，则当你更新后，查询的数据数据还是老的数据。</li>
</ul>
</blockquote>

    </div>

    <div class="post-copyright">
  <p class="copyright-item">
    <span class="item-title">文章作者</span>
    <span class="item-content">卢森林</span>
  </p>
  <p class="copyright-item">
    <span class="item-title">上次更新</span>
    <span class="item-content">
        2020-08-12
        
    </span>
  </p>
  
  
</div>
<footer class="post-footer">
      
      <nav class="post-nav">
        <a class="prev" href="/post/linux%E6%9C%8D%E5%8A%A1%E5%99%A8/">
            <i class="iconfont icon-left"></i>
            <span class="prev-text nav-default">Linux服务器.md</span>
            <span class="prev-text nav-mobile">上一篇</span>
          </a>
        <a class="next" href="/post/mysql/">
            <span class="next-text nav-default">MySQL.md</span>
            <span class="next-text nav-mobile">下一篇</span>
            <i class="iconfont icon-right"></i>
          </a>
      </nav>
    </footer>
  </article>
        </div>
        

  

  

      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="social-links">
      <a href="mailto:1115759748@qq.com" class="iconfont icon-email" title="email"></a>
      <a href="https://gitee.com/lusenlin1997" class="iconfont icon-stack-overflow" title="stack-overflow"></a>
      <a href="http://https://github.com/13277112287" class="iconfont icon-github" title="github"></a>
      <a href="http://localhost:1313" class="iconfont icon-bilibili" title="bilibili"></a>
  <a href="https://13277112287.github.io/index.xml" type="application/rss+xml" class="iconfont icon-rss" title="rss"></a>
</div>

<div class="copyright">
  <span class="power-by">
    由 <a class="hexo-link" href="https://gohugo.io">Hugo</a> 强力驱动
  </span>
  <span class="division">|</span>
  <span class="theme-info">
    主题 - 
    <a class="theme-link" href="https://github.com/olOwOlo/hugo-theme-even">Even</a>
  </span>

  

  <span class="copyright-year">
    &copy; 
    2020
    <span class="heart">
      <i class="iconfont icon-heart"></i>
    </span>
    <span class="author">卢森林</span>
  </span>
</div>
    </footer>

    <div class="back-to-top" id="back-to-top">
      <i class="iconfont icon-up"></i>
    </div>
  </div>
  
  <script src="https://cdn.jsdelivr.net/npm/jquery@3.2.1/dist/jquery.min.js" integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/slideout@1.0.1/dist/slideout.min.js" integrity="sha256-t+zJ/g8/KXIJMjSVQdnibt4dlaDxc9zXr/9oNPeWqdg=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.js" integrity="sha256-XVLffZaxoWfGUEbdzuLi7pwaUJv1cecsQJQqGLe7axY=" crossorigin="anonymous"></script>



<script type="text/javascript" src="/js/main.min.d7b7ada643c9c1a983026e177f141f7363b4640d619caf01d8831a6718cd44ea.js"></script>








</body>
</html>
