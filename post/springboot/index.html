<!DOCTYPE html>
<html lang="zh-cn">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <title>SpringBoot.md - Even - A super concise theme for Hugo</title>
  <meta name="renderer" content="webkit" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>

<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">


<meta name="author" content="卢森林" /><meta name="description" content="面试题一览 第一章-SpringBoot概述 Spring回顾 是什么 为了解决企业级应用开发的复杂性而创建,简化开发 如何简化的 1、基于POJO的轻" /><meta name="keywords" content="Hugo, theme, even" />






<meta name="generator" content="Hugo 0.74.3 with theme even" />


<link rel="canonical" href="https://13277112287.github.io/post/springboot/" />
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/manifest.json">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">



<link href="/sass/main.min.8c3cbcb0324c2bb4875ceccba4007cbad4b4ac8377f33af9953c3e7684534a50.css" rel="stylesheet">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.css" integrity="sha256-7TyXnr2YU040zfSP+rEcz29ggW4j56/ujTPwjMzyqFY=" crossorigin="anonymous">


<meta property="og:title" content="SpringBoot.md" />
<meta property="og:description" content="面试题一览 第一章-SpringBoot概述 Spring回顾 是什么 为了解决企业级应用开发的复杂性而创建,简化开发 如何简化的 1、基于POJO的轻" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://13277112287.github.io/post/springboot/" />
<meta property="article:published_time" content="2020-04-29T00:00:00+00:00" />
<meta property="article:modified_time" content="2020-08-13T00:00:00+00:00" />
<meta itemprop="name" content="SpringBoot.md">
<meta itemprop="description" content="面试题一览 第一章-SpringBoot概述 Spring回顾 是什么 为了解决企业级应用开发的复杂性而创建,简化开发 如何简化的 1、基于POJO的轻">
<meta itemprop="datePublished" content="2020-04-29T00:00:00+00:00" />
<meta itemprop="dateModified" content="2020-08-13T00:00:00+00:00" />
<meta itemprop="wordCount" content="20634">



<meta itemprop="keywords" content="" />
<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="SpringBoot.md"/>
<meta name="twitter:description" content="面试题一览 第一章-SpringBoot概述 Spring回顾 是什么 为了解决企业级应用开发的复杂性而创建,简化开发 如何简化的 1、基于POJO的轻"/>

<!--[if lte IE 9]>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js"></script>
<![endif]-->

<!--[if lt IE 9]>
  <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
<![endif]-->

</head>
<body>
  <div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/" class="logo">forest森林</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>
<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    <a href="/">
        <li class="mobile-menu-item">主页</li>
      </a><a href="/post/">
        <li class="mobile-menu-item">时间轴</li>
      </a><a href="/categories/">
        <li class="mobile-menu-item">分类</li>
      </a><a href="/about/">
        <li class="mobile-menu-item">关于</li>
      </a>
  </ul>
</nav>
  <div class="container" id="mobile-panel">
    <header id="header" class="header">
        <div class="logo-wrapper">
  <a href="/" class="logo">forest森林</a>
</div>

<nav class="site-navbar">
  <ul id="menu" class="menu">
    <li class="menu-item">
        <a class="menu-item-link" href="/">主页</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/post/">时间轴</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/categories/">分类</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/about/">关于</a>
      </li>
  </ul>
</nav>
    </header>

    <main id="main" class="main">
      <div class="content-wrapper">
        <div id="content" class="content">
          <article class="post">
    
    <header class="post-header">
      <h1 class="post-title">SpringBoot.md</h1>

      <div class="post-meta">
        <span class="post-time"> 2020-04-29 </span>
        <div class="post-category">
            <a href="/categories/%E6%A1%86%E6%9E%B6/"> 框架 </a>
            </div>
          <span class="more-meta"> 约 20634 字 </span>
          <span class="more-meta"> 预计阅读 42 分钟 </span>
        
      </div>
    </header>

    <div class="post-toc" id="post-toc">
  <h2 class="post-toc-title">文章目录</h2>
  <div class="post-toc-content">
    <nav id="TableOfContents">
  <ul>
    <li><a href="#面试题一览">面试题一览</a></li>
    <li><a href="#第一章-springboot概述">第一章-SpringBoot概述</a>
      <ul>
        <li><a href="#1什么是springboot">1什么是SpringBoot</a></li>
        <li><a href="#2项目创建">2项目创建</a>
          <ul>
            <li><a href="#1快速使用">1快速使用</a></li>
            <li><a href="#2热部署">2热部署</a></li>
            <li><a href="#3原理初探">3原理初探</a></li>
          </ul>
        </li>
        <li><a href="#3配置文件">3配置文件</a>
          <ul>
            <li><a href="#yaml">YAML</a></li>
            <li><a href="#yaml进行属性注入">YAML进行属性注入</a></li>
            <li><a href="#properties属性注入">properties属性注入</a></li>
            <li><a href="#yaml总结jsr303校验">YAML总结/JSR303校验</a></li>
            <li><a href="#多环境切换">多环境切换</a></li>
          </ul>
        </li>
        <li><a href="#4自动配置原理">4自动配置原理</a>
          <ul>
            <li><a href="#mvc原理">MVC原理</a></li>
          </ul>
        </li>
        <li><a href="#5日志">5日志</a></li>
      </ul>
    </li>
    <li><a href="#第二章-web开发">第二章-web开发</a>
      <ul>
        <li><a href="#1静态资源">1静态资源</a></li>
        <li><a href="#2首页定制图标">2首页定制/图标</a></li>
        <li><a href="#3模版引擎">3模版引擎</a>
          <ul>
            <li><a href="#快速开始">快速开始</a></li>
            <li><a href="#thymeleaf">thymeleaf</a></li>
          </ul>
        </li>
        <li><a href="#4格式化器扩展springmvc">4格式化器/扩展SpringMVC</a></li>
        <li><a href="#5crudwebjars">5CRUD/webjars</a>
          <ul>
            <li><a href="#1国际化">1国际化</a></li>
            <li><a href="#2拦截验证">2拦截/验证</a></li>
            <li><a href="#3rest风格公告页面抽取">3Rest风格/公告页面抽取</a></li>
            <li><a href="#4crud页面错误处理">4CRUD/页面错误处理</a></li>
          </ul>
        </li>
        <li><a href="#6跨域">6跨域</a></li>
      </ul>
    </li>
    <li><a href="#第三章-springdata">第三章-SpringData</a>
      <ul>
        <li><a href="#1什么是springdata">1什么是SpringData</a>
          <ul>
            <li><a href="#整合jdbc">整合JDBC</a></li>
            <li><a href="#jdbctemplate">JDBCTemplate</a></li>
          </ul>
        </li>
        <li><a href="#2整合druid数据源">2整合Druid数据源</a></li>
        <li><a href="#3整合mybatis">3整合mybatis</a></li>
        <li><a href="#4整合jpa">4整合jpa</a></li>
        <li><a href="#5整合redis">5整合redis</a></li>
        <li><a href="#6整合日志aop">6整合日志/AOP</a></li>
        <li><a href="#7整合mybatis-plus">7整合mybatis-plus</a></li>
        <li><a href="#8事务异常">8事务/异常</a></li>
        <li><a href="#9上传下载">9上传下载</a></li>
      </ul>
    </li>
    <li><a href="#第四章-springsecurity">第四章-SpringSecurity</a>
      <ul>
        <li><a href="#1安全框架">1安全框架</a></li>
        <li><a href="#2基本登录权限">2基本登录权限</a></li>
        <li><a href="#3定制登录页">3定制登录页</a></li>
      </ul>
    </li>
  </ul>
</nav>
  </div>
</div>
    <div class="post-content">
      <h1 id="面试题一览">面试题一览</h1>
<h1 id="第一章-springboot概述">第一章-SpringBoot概述</h1>
<p>Spring回顾
是什么
为了解决企业级应用开发的复杂性而创建,简化开发
如何简化的
1、基于POJO的轻量级和最小侵入性编程；
2、通过IOC，依赖注入（DI）和面向接口实现松耦合；
3、基于切面（AOP）和惯例进行声明式编程；
4、通过切面和模版减少样式代码；</p>
<p>学习文档博客:https://cloudlandboy.github.io/myNote/#/backend/springboot/templateengine?id=%e8%af%ad%e6%b3%95%e8%a7%84%e5%88%99</p>
<h2 id="1什么是springboot">1什么是SpringBoot</h2>
<p>是什么:本质上简化spring
配置如何编写yaml
自动装配原理
继承web开发:业务的核心
集成数据库:druid
分布式开发:Dubbo(RPC调用)+zookeeper
swagger:接口文档，方便前后端开发
任务调度
SpringSecurity Shiro 安全框架AOP思想</p>
<h2 id="2项目创建">2项目创建</h2>
<blockquote>
<p><strong>官网创建</strong>：https://spring.io/projects/spring-boot#overview</p>
<p>进入SpringBoot官网projects/spring-boot
选择GA稳定版&ndash;&gt;OverView(n. [图情] 综述；概观)&ndash;&gt;Quick start</p>
<p>选择project工程类型，language语言
generate-Ctral+ 使形成
下载后解压</p>
<p>IDEA导入该工程
view&ndash;&gt;Tool Window&ndash;&gt;project若没有工程视图就展示
java文件夹下点击运行</p>
</blockquote>
<p>**IDEA快速创建：**常用</p>
<p>new Project/new Module
Spring Initializr&ndash;&gt;next&ndash;&gt;选择和命名&ndash;&gt;选择依赖&ndash;&gt;一般选web SpringWeb
此种方法会发现class或者@Test无法运行
解决1
会出现问题
file&ndash;&gt;Project Structure&ndash;&gt;Modules&ndash;&gt;
点击+号 Import Module&ndash;&gt;重新导入
解决2
会出现问题
SRC右击&ndash;&gt;Mark Directory as</p>
<p>依赖
在有parent项目后，使用springboot相关的web项目就可以不用设置版本号。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-xml" data-lang="xml"><span class="nt">&lt;parent&gt;</span>
        <span class="nt">&lt;groupId&gt;</span>org.springframework.boot<span class="nt">&lt;/groupId&gt;</span>
        <span class="nt">&lt;artifactId&gt;</span>spring-boot-starter-parent<span class="nt">&lt;/artifactId&gt;</span>
        <span class="nt">&lt;version&gt;</span>2.2.6.RELEASE<span class="nt">&lt;/version&gt;</span>
        <span class="nt">&lt;relativePath/&gt;</span> <span class="c">&lt;!-- lookup parent from repository --&gt;</span>
<span class="nt">&lt;/parent&gt;</span>
</code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-xml" data-lang="xml">   <span class="nt">&lt;properties&gt;</span>
      <span class="nt">&lt;java.version&gt;</span>1.8<span class="nt">&lt;/java.version&gt;</span>
   <span class="nt">&lt;/properties&gt;</span>
   <span class="nt">&lt;dependencies&gt;</span>
      <span class="c">&lt;!--springBoot依赖 tomcat,dispatcherServlet,xml --&gt;</span>
      <span class="nt">&lt;dependency&gt;</span>
         <span class="nt">&lt;groupId&gt;</span>org.springframework.boot<span class="nt">&lt;/groupId&gt;</span>
         <span class="nt">&lt;artifactId&gt;</span>spring-boot-starter-web<span class="nt">&lt;/artifactId&gt;</span>
      <span class="nt">&lt;/dependency&gt;</span>
      <span class="c">&lt;!--单元测试--&gt;</span>
      <span class="nt">&lt;dependency&gt;</span>
         <span class="nt">&lt;groupId&gt;</span>org.springframework.boot<span class="nt">&lt;/groupId&gt;</span>
         <span class="nt">&lt;artifactId&gt;</span>spring-boot-starter-test<span class="nt">&lt;/artifactId&gt;</span>
         <span class="nt">&lt;scope&gt;</span>test<span class="nt">&lt;/scope&gt;</span>
         <span class="nt">&lt;exclusions&gt;</span>
            <span class="nt">&lt;exclusion&gt;</span>
               <span class="nt">&lt;groupId&gt;</span>org.junit.vintage<span class="nt">&lt;/groupId&gt;</span>
               <span class="nt">&lt;artifactId&gt;</span>junit-vintage-engine<span class="nt">&lt;/artifactId&gt;</span>
            <span class="nt">&lt;/exclusion&gt;</span>
         <span class="nt">&lt;/exclusions&gt;</span>
      <span class="nt">&lt;/dependency&gt;</span>
   <span class="nt">&lt;/dependencies&gt;</span>
<span class="c">&lt;!--   打jar包的插件--&gt;</span>
   <span class="nt">&lt;build&gt;</span>
      <span class="nt">&lt;plugins&gt;</span>
         <span class="nt">&lt;plugin&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>org.springframework.boot<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>spring-boot-maven-plugin<span class="nt">&lt;/artifactId&gt;</span>
         <span class="nt">&lt;/plugin&gt;</span>
      <span class="nt">&lt;/plugins&gt;</span>
   <span class="nt">&lt;/build&gt;</span>
</code></pre></td></tr></table>
</div>
</div><p><strong>项目结构：</strong></p>
<p>.resources文件夹中目录结构
static :保存所有的静态资源; js Css images ;
templates :保存所有的模板页面; ( Spring Boot默认jar包使用嵌入式的Tomcat，默认不支持]SP页
面) ;可以使用模板引擎( freemarker、thymeleaf) ;
application.properties : Spring Boot应用的配置文件;可以修改-一些默认设置 ;</p>
<h3 id="1快速使用">1快速使用</h3>
<p>springboot的启动类，会自动扫描当前包下的所有文件。</p>
<p><img src="/typoraImg/SpringBoot.assets/image-20200412141820175.png" alt="image-20200412141820175"></p>
<p>修改端口号
application.properties&ndash;&gt;加上server.port=8999
修改图形(了解即可)
application.properties目录下建立一个banner.txt看到有小点
bootSchool网址下找ASCII工具</p>
<p>直接运行SpringbootStratApplication就好。</p>
<blockquote>
<p>导入其他配置文件，在启动类下用@ImportResource(locations = {&ldquo;classpath:bean.xml&rdquo;})</p>
</blockquote>
<h3 id="2热部署">2热部署</h3>
<p>1、加maven依赖</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-xml" data-lang="xml"><span class="nt">&lt;dependency&gt;</span>
    <span class="nt">&lt;groupId&gt;</span>org.springframework.boot<span class="nt">&lt;/groupId&gt;</span>
    <span class="nt">&lt;artifactId&gt;</span>spring-boot-devtools<span class="nt">&lt;/artifactId&gt;</span>
    <span class="nt">&lt;optional&gt;</span>true<span class="nt">&lt;/optional&gt;</span>
<span class="nt">&lt;/dependency&gt;</span>
</code></pre></td></tr></table>
</div>
</div><p>2CTRL + SHIFT + A &ndash;&gt; 查找Registry &ndash;&gt; 找到并勾选compiler.automake.allow.when.app.running  然后点击close</p>
<p><img src="/typoraImg/SpringBoot.assets/image-20200618144242531.png" alt="image-20200618144242531"></p>
<p>3IDEA设置</p>
<p><strong>当前项目</strong></p>
<p><img src="/typoraImg/SpringBoot.assets/image-20200618145442787.png" alt="image-20200618145442787"></p>
<p><strong>全局设置</strong></p>
<p><img src="/typoraImg/SpringBoot.assets/image-20200618144736800.png" alt="image-20200618144736800"></p>
<h3 id="3原理初探">3原理初探</h3>
<p><img src="/typoraImg/SpringBoot.assets/image-20200412163149321.png" alt="image-20200412163149321"></p>
<p><strong>1 ==@SpringBootApplication==</strong>注解，标注在某个类上说明这个类是SpringBoot的主配置类 ， SpringBoot就应该运行这个类的main方法来启动SpringBoot应用。</p>
<p>在这个注解之下还有其他注解，如上图。</p>
<p><strong>2 @SpringBootConfiguration</strong></p>
<p>作用：SpringBoot的配置类 ，标注在某个类上 ， 表示这是一个SpringBoot的配置类；</p>
<p>我们继续进去这个注解查看@Configuration—&gt;@Component</p>
<p>这里的<code> @Configuration</code>，说明这是一个配置类 ，配置类就是对应Spring的xml 配置文件；</p>
<p>里面的 @Component 这就说明，启动类本身也是Spring中的一个组件而已，负责启动应用！</p>
<p>我们回到 SpringBootApplication 注解中继续看。</p>
<p><strong>3 @EnableAutoConfiguration</strong>开启自动配置</p>
<p>其中包含以下几个注解：</p>
<p>1 @AutoConfigurationPackage</p>
<blockquote>
<p>又包含@Import(AutoConfigurationPackages.Registrar.class)Spring底层注解@import ， 给容器中导入一个组件
Registrar.class 作用：将主启动类的所在包及包下面所有子包里面的所有组件扫描到Spring容器 ；</p>
</blockquote>
<p>2@Import(AutoConfigurationImportSelector.class)</p>
<blockquote>
<p>AutoConfigurationImportSelector ：自动配置导入选择器，那么它会导入哪些组件的选择器呢？我们点击去这个类看源码：其中找到getCandidateConfigurations方法，这个方法中有一个SpringFactoriesLoader.loadFactoryNames()方法，再进去查看loadSpringFactories()方法，看到出现了这样一个路径“META-INF/spring.factories”</p>
<p><img src="/typoraImg/SpringBoot.assets/image-20200412171811305.png" alt="image-20200412171811305"></p>
<p>我们根据源头打开spring.factories ， 看到了很多自动配置的文件；这就是自动配置根源所在！</p>
</blockquote>
<p><strong>4@ComponentScan</strong></p>
<blockquote>
<p>这个注解在Spring中很重要 ,它对应XML配置中的元素。</p>
<p>作用：自动扫描并加载符合条件的组件或者bean ， 将这个bean定义加载到IOC容器中</p>
</blockquote>
<p><strong>结论：</strong></p>
<ol>
<li>
<p>SpringBoot在启动的时候从类路径下的META-INF/spring.factories中获取EnableAutoConfiguration指定的值</p>
</li>
<li>
<p>将这些值作为自动配置类导入容器 ， 自动配置类就生效 ， 帮我们进行自动配置工作；</p>
</li>
<li>
<p>整个J2EE的整体解决方案和自动配置都在springboot-autoconfigure的jar包中；</p>
</li>
<li>
<p>它会给容器中导入非常多的自动配置类 （xxxAutoConfiguration）, 就是给容器中导入这个场景需要的所有组件 ， 并配置好这些组件 ；</p>
</li>
<li>
<p>有了自动配置类 ， 免去了我们手动编写配置注入功能组件等的工作；</p>
</li>
</ol>
<h2 id="3配置文件">3配置文件</h2>
<p>SpringBoot使用一个全局的配置文件 ， 配置文件名称是固定的</p>
<ul>
<li>
<p>application.properties</p>
</li>
<li>
<ul>
<li>语法结构 ：key=value</li>
</ul>
</li>
<li>
<p>application.yml</p>
</li>
<li>
<ul>
<li>语法结构 ：key：空格 value</li>
</ul>
</li>
</ul>
<p>**配置文件的作用 ：**修改SpringBoot自动配置的默认值，因为SpringBoot在底层都给我们自动配置好了；</p>
<p>比如我们可以在配置文件中修改Tomcat 默认启动的端口号！测试一下！</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">server.port=8081
server.context-path=/crud

server.tomcat.uri-encoding=UTF-8
</code></pre></td></tr></table>
</div>
</div><h3 id="yaml">YAML</h3>
<p>YAML是 &ldquo;YAML Ain&rsquo;t a Markup Language&rdquo; （YAML不是一种标记语言）的递归缩写。在开发的这种语言时，YAML 的意思其实是：&ldquo;Yet Another Markup Language&rdquo;（仍是一种标记语言）</p>
<p><strong>这种语言以数据作为中心，而不是以标记语言为重点！</strong></p>
<p>以前的配置文件，大多数都是使用xml来配置；比如一个简单的端口配置，我们来对比下yaml和xml</p>
<p>传统xml配置：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">&lt;server&gt; 
	&lt;port&gt;8081&lt;port
&gt;&lt;/server&gt;
</code></pre></td></tr></table>
</div>
</div><p>yaml配置：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">server：
	prot: 8080
</code></pre></td></tr></table>
</div>
</div><p>==<strong>YAML语法</strong>==</p>
<p><strong>基本语法</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">student:
    name: qinjiang
    age: 3
</code></pre></td></tr></table>
</div>
</div><p>说明：语法要求严格！</p>
<p>1、k:空格v  表示一对键值对，空格必须有</p>
<p>2、以缩进来控制层级关系，只要是左边对齐的一列数据都是同一个层级的。</p>
<p>3、属性和值的大小写都是十分敏感的。</p>
<p><strong>值的表示：</strong></p>
<p>“ ” 双引号，会转义特殊字符 ，特殊字符会作为本身想表示的意思；</p>
<p>比如 ：name: &ldquo;kuang \n shen&rdquo;   输出 ：kuang  换行   shen</p>
<p>'&rsquo; 单引号，不会转义字符串里面的特殊字符 ，特殊字符最终会变成和普通字符一样输出</p>
<p>比如 ：name: ‘kuang \n shen’   输出 ：kuang  \n   shen</p>
<p><strong>对象、Map（键值对）</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-yml" data-lang="yml"><span class="k">student</span><span class="p">:</span><span class="w">
</span><span class="w">    </span><span class="k">name</span><span class="p">:</span><span class="w"> </span>qinjiang<span class="w">
</span><span class="w">    </span><span class="k">age</span><span class="p">:</span><span class="w"> </span><span class="m">3</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="c">#行内写法</span><span class="w">
</span><span class="w"></span><span class="k">student</span><span class="p">:</span><span class="w"> </span>{<span class="k">name: qinjiang,age</span><span class="p">:</span><span class="w"> </span><span class="m">3</span>}<span class="w">
</span></code></pre></td></tr></table>
</div>
</div><p><strong>数组（ List、set ）</strong></p>
<p>用 - 值表示数组中的一个元素,比如：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-yml" data-lang="yml"><span class="k">pets</span><span class="p">:</span><span class="w">
</span><span class="w"> </span>- cat<span class="w">
</span><span class="w"> </span>- dog<span class="w">
</span><span class="w"> </span>- pig<span class="w">
</span><span class="w"> 
</span><span class="w"> </span><span class="c">#行内</span><span class="w">
</span><span class="w"> </span><span class="k">pets</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>cat<span class="p">,</span>dog<span class="p">,</span>pig<span class="p">]</span><span class="w">
</span></code></pre></td></tr></table>
</div>
</div><h3 id="yaml进行属性注入">YAML进行属性注入</h3>
<p>person.class</p>
<p>实体类，@ConfigurationProperties(prefix = &ldquo;person&rdquo;)加上prefix等于yml定义的对象</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="kn">package</span> <span class="nn">com.lx.springboot_start.pojo</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">lombok.Data</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.boot.context.properties.ConfigurationProperties</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.stereotype.Component</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.util.Date</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.List</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.Map</span><span class="o">;</span>

<span class="nd">@Component</span> <span class="c1">//注册bean
</span><span class="c1"></span><span class="nd">@Data</span>
<span class="nd">@ConfigurationProperties</span><span class="o">(</span><span class="n">prefix</span> <span class="o">=</span> <span class="s">&#34;person&#34;</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Person</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="n">String</span> <span class="n">name</span><span class="o">;</span>
    <span class="kd">private</span> <span class="n">Integer</span> <span class="n">age</span><span class="o">;</span>
    <span class="kd">private</span> <span class="n">Boolean</span> <span class="n">happy</span><span class="o">;</span>
    <span class="kd">private</span> <span class="n">Date</span> <span class="n">birth</span><span class="o">;</span>
    <span class="kd">private</span> <span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span><span class="n">Object</span><span class="o">&gt;</span> <span class="n">maps</span><span class="o">;</span>
    <span class="kd">private</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">Object</span><span class="o">&gt;</span> <span class="n">lists</span><span class="o">;</span>
    <span class="kd">private</span> <span class="n">Dog</span> <span class="n">dog</span><span class="o">;</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><p>person.yml</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-yml" data-lang="yml"><span class="k">server</span><span class="p">:</span><span class="w">
</span><span class="w">  </span><span class="k">port</span><span class="p">:</span><span class="w"> </span><span class="m">9000</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="k">person</span><span class="p">:</span><span class="w">
</span><span class="w">  </span><span class="k">name</span><span class="p">:</span><span class="w"> </span>李强<span class="w">
</span><span class="w">  </span><span class="k">age</span><span class="p">:</span><span class="w"> </span><span class="m">34</span><span class="w">
</span><span class="w">  </span><span class="k">happy</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
</span><span class="w">  </span><span class="k">birth</span><span class="p">:</span><span class="w"> </span><span class="m">2019</span>/<span class="m">05</span>/<span class="m">04</span><span class="w">
</span><span class="w">  </span><span class="k">maps</span><span class="p">:</span><span class="w">
</span><span class="w">    </span><span class="k">name</span><span class="p">:</span><span class="w"> </span>cat<span class="w">
</span><span class="w">    </span><span class="k">age</span><span class="p">:</span><span class="w"> </span><span class="m">33</span><span class="w">
</span><span class="w">  </span><span class="k">lists</span><span class="p">:</span><span class="w">
</span><span class="w">    </span>- 李明<span class="w">
</span><span class="w">    </span>- 爱好<span class="w">
</span><span class="w">    </span>- 吃喝玩乐<span class="w">
</span><span class="w">    </span>- 学习<span class="w">
</span><span class="w">  </span><span class="k">dog</span><span class="p">:</span><span class="w">
</span><span class="w">    </span><span class="k">nage</span><span class="p">:</span><span class="w"> </span>smallyello<span class="w">
</span><span class="w">    </span><span class="k">age</span><span class="p">:</span><span class="w"> </span><span class="m">22</span><span class="w">
</span><span class="w"></span><span class="c">#yml支持占位符等。</span><span class="w">
</span><span class="w"></span><span class="c">#person:</span><span class="w">
</span><span class="w"></span><span class="c">#    name: qinjiang${random.uuid} # 随机uuid</span><span class="w">
</span><span class="w"></span><span class="c">#    age: ${random.int}  # 随机int</span><span class="w">
</span></code></pre></td></tr></table>
</div>
</div><p>pom.xml</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-xml" data-lang="xml"><span class="c">&lt;!-- 导入配置文件处理器，配置文件进行绑定就会有提示，需要重启 --&gt;</span>
<span class="nt">&lt;dependency&gt;</span>
  <span class="nt">&lt;groupId&gt;</span>org.springframework.boot<span class="nt">&lt;/groupId&gt;</span>
  <span class="nt">&lt;artifactId&gt;</span>spring-boot-configuration-processor<span class="nt">&lt;/artifactId&gt;</span>
  <span class="nt">&lt;optional&gt;</span>true<span class="nt">&lt;/optional&gt;</span>
<span class="nt">&lt;/dependency&gt;</span>
</code></pre></td></tr></table>
</div>
</div><h3 id="properties属性注入">properties属性注入</h3>
<p>另外两个注解</p>
<p><strong>@PropertySource</strong>(value = &ldquo;classpath:person.properties&rdquo;)加载指定的配置文件；</p>
<p><strong>@configurationProperties</strong>：默认从全局配置文件(如application.properties)中获取值；</p>
<p>@ConfigurationProperties(prefix = &ldquo;person&rdquo;)</p>
<p>IDEA需在设置setting中,查找file encoding，勾选ransparent native-to-ascii conversion</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">person1.name=&#34;李强1&#34;
person1.age=11
person1.happy=true
person1.birth=2019/05/04
person1.maps.name=cat
person1.maps.age=33
person1.lists=13,134
person1.dog.name=small
person1.dog.age=11
</code></pre></td></tr></table>
</div>
</div><h3 id="yaml总结jsr303校验">YAML总结/JSR303校验</h3>
<p>可以直接在实体类属性中
@value(&ldquo;李强&rdquo;)
@Value(&quot;#{9*2}&quot;)  <em>// #{SPEL} Spring表达式</em>
@Value(&ldquo;${user.name}&quot;) <em>//从配置文件中取值</em></p>
<p><img src="/typoraImg/SpringBoot.assets/640.png" alt="img"></p>
<p>1、@ConfigurationProperties只需要写一次即可 ， @Value则需要每个字段都添加</p>
<p>2、松散绑定：这个什么意思呢? 比如我的yml中写的last-name，这个和lastName是一样的， - 后面跟着的字母默认是大写的。这就是松散绑定。可以测试一下</p>
<p>3、<strong>JSR303</strong>数据校验 ， 这个就是我们可以在字段是增加一层过滤器验证 ， 可以保证数据的合法性。</p>
<blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="nd">@Validated</span>  <span class="c1">//数据校验public class Person {
</span><span class="c1"></span><span class="nd">@Email</span><span class="o">(</span><span class="n">message</span><span class="o">=</span><span class="s">&#34;邮箱格式错误&#34;</span><span class="o">)</span> <span class="c1">//name必须是邮箱格式   
</span><span class="c1"></span><span class="kd">private</span> <span class="n">String</span> <span class="n">name</span><span class="o">;</span>
<span class="o">}</span>
<span class="c1">//    详情如下
</span></code></pre></td></tr></table>
</div>
</div></blockquote>
<p>4、复杂类型封装，yml中可以封装对象 ， 使用value就不支持</p>
<p><strong>JSR303</strong>数据校验</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="nd">@Validated</span>  <span class="c1">//数据校验
</span><span class="c1"></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Person</span> <span class="o">{</span>
  

<span class="nd">@NotNull</span><span class="o">(</span><span class="n">message</span><span class="o">=</span><span class="s">&#34;名字不能为空&#34;</span><span class="o">)</span>
<span class="kd">private</span> <span class="n">String</span> <span class="n">userName</span><span class="o">;</span>
<span class="nd">@Max</span><span class="o">(</span><span class="n">value</span><span class="o">=</span><span class="n">120</span><span class="o">,</span><span class="n">message</span><span class="o">=</span><span class="s">&#34;年龄最大不能查过120&#34;</span><span class="o">)</span>
<span class="kd">private</span> <span class="kt">int</span> <span class="n">age</span><span class="o">;</span>
<span class="nd">@Email</span><span class="o">(</span><span class="n">message</span><span class="o">=</span><span class="s">&#34;邮箱格式错误&#34;</span><span class="o">)</span>
<span class="kd">private</span> <span class="n">String</span> <span class="n">email</span><span class="o">;</span>

<span class="c1">//空检查
</span><span class="c1"></span><span class="nd">@Null</span>       <span class="n">验证对象是否为null</span>
<span class="nd">@NotNull</span>    <span class="n">验证对象是否不为null</span><span class="o">,</span> <span class="n">无法查检长度为0的字符串</span>
<span class="nd">@NotBlank</span>   <span class="n">检查约束字符串是不是Null还有被Trim的长度是否大于0</span><span class="o">,</span><span class="n">只对字符串</span><span class="o">,</span><span class="n">且会去掉前后空格</span><span class="o">.</span>
<span class="nd">@NotEmpty</span>   <span class="n">检查约束元素是否为NULL或者是EMPTY</span><span class="o">.</span>
    
<span class="c1">//Booelan检查
</span><span class="c1"></span><span class="nd">@AssertTrue</span>     <span class="n">验证</span> <span class="n">Boolean</span> <span class="n">对象是否为</span> <span class="kc">true</span>  
<span class="nd">@AssertFalse</span>    <span class="n">验证</span> <span class="n">Boolean</span> <span class="n">对象是否为</span> <span class="kc">false</span>  
    
<span class="c1">//长度检查
</span><span class="c1"></span><span class="nd">@Size</span><span class="o">(</span><span class="n">min</span><span class="o">=,</span> <span class="n">max</span><span class="o">=)</span> <span class="n">验证对象</span><span class="err">（</span><span class="n">Array</span><span class="o">,</span><span class="n">Collection</span><span class="o">,</span><span class="n">Map</span><span class="o">,</span><span class="n">String</span><span class="err">）</span><span class="n">长度是否在给定的范围之内</span>  
<span class="nd">@Length</span><span class="o">(</span><span class="n">min</span><span class="o">=,</span> <span class="n">max</span><span class="o">=)</span> <span class="n">string</span> <span class="n">is</span> <span class="n">between</span> <span class="n">min</span> <span class="n">and</span> <span class="n">max</span> <span class="n">included</span><span class="o">.</span>

<span class="c1">//日期检查
</span><span class="c1"></span><span class="nd">@Past</span>       <span class="n">验证</span> <span class="n">Date</span> <span class="n">和</span> <span class="n">Calendar</span> <span class="n">对象是否在当前时间之前</span>  
<span class="nd">@Future</span>     <span class="n">验证</span> <span class="n">Date</span> <span class="n">和</span> <span class="n">Calendar</span> <span class="n">对象是否在当前时间之后</span>  
<span class="nd">@Pattern</span>    <span class="n">验证</span> <span class="n">String</span> <span class="n">对象是否符合正则表达式的规则</span>

<span class="c1">//.......等等
</span><span class="c1">//除此以外，我们还可以自定义一些数据校验规则
</span></code></pre></td></tr></table>
</div>
</div><h3 id="多环境切换">多环境切换</h3>
<p>profile是Spring对不同环境提供不同配置功能的支持，可以通过激活不同的环境版本，实现快速切换环境；</p>
<p><strong>多配置文件</strong>
我们在主配置文件编写的时候，文件名可以是 application-{profile}.properties/yml , 用来指定多个环境版本；</p>
<p>例如：</p>
<p>application-test.properties 代表测试环境配置</p>
<p>application-dev.properties 代表开发环境配置</p>
<p>但是Springboot并不会直接启动这些配置文件，它默认使用application.properties主配置文件；</p>
<p>我们需要通过一个配置来选择需要激活的环境：</p>
<blockquote>
<p>比如在配置文件中指定使用dev环境，我们可以通过设置不同的端口号进行测试；**
我们启动SpringBoot，就可以看到已经切换到dev下的配置了；**
spring.profiles.active=dev</p>
</blockquote>
<p><strong>yaml的多文档块</strong></p>
<p>和properties配置文件中一样，但是使用yml去实现不需要创建多个配置文件，更加方便了 !</p>
<blockquote>
<p>yml也可以像properties起名称，可以把通用的放在上面</p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-yml" data-lang="yml"><span class="c">#---用来分割配置环境</span><span class="w">
</span><span class="w"></span><span class="k">server</span><span class="p">:</span><span class="w">
</span><span class="w">  </span><span class="k">port</span><span class="p">:</span><span class="w"> </span><span class="m">8081</span><span class="w">
</span><span class="w">  
</span><span class="w"></span><span class="c">#选择要激活那个环境块</span><span class="w">
</span><span class="w"></span><span class="k">spring</span><span class="p">:</span><span class="w">
</span><span class="w">  </span><span class="k">profiles</span><span class="p">:</span><span class="w">
</span><span class="w">    </span><span class="k">active</span><span class="p">:</span><span class="w"> </span>prod<span class="w">
</span><span class="w">
</span><span class="w"></span>---<span class="w">
</span><span class="w"></span><span class="k">server</span><span class="p">:</span><span class="w">
</span><span class="w">  </span><span class="k">port</span><span class="p">:</span><span class="w"> </span><span class="m">8083</span><span class="w">
</span><span class="w"></span><span class="k">spring</span><span class="p">:</span><span class="w">
</span><span class="w">  </span><span class="k">profiles</span><span class="p">:</span><span class="w"> </span>dev<span class="w"> </span><span class="c">#配置环境的名称</span><span class="w">
</span><span class="w">
</span><span class="w">
</span><span class="w"></span>---<span class="w">
</span><span class="w">
</span><span class="w"></span><span class="k">server</span><span class="p">:</span><span class="w">
</span><span class="w">  </span><span class="k">port</span><span class="p">:</span><span class="w"> </span><span class="m">8084</span><span class="w">
</span><span class="w"></span><span class="k">spring</span><span class="p">:</span><span class="w">
</span><span class="w">  </span><span class="k">profiles</span><span class="p">:</span><span class="w"> </span>prod<span class="w">  </span><span class="c">#配置环境的名称</span><span class="w">
</span></code></pre></td></tr></table>
</div>
</div><p>注意：如果yml和properties同时都配置了端口，并且没有激活其他环境 ， 默认会使用properties配置文件的！</p>
<p>springboot 启动会扫描以下位置的application.properties或者application.yml文件作为Spring boot的默认配置文件：</p>
<blockquote>
<p>优先级1：项目路径下的config文件夹配置文件
优先级2：项目路径下配置文件
优先级3：资源路径下的config文件夹配置文件
优先级4：资源路径下配置文件
优先级由高到底，高优先级的配置会覆盖低优先级的配置；</p>
</blockquote>
<p>SpringBoot会从这四个位置全部加载主配置文件；互补配置；</p>
<p>我们在最低级的配置文件中设置一个项目访问路径的配置来测试互补问题；</p>
<p>#配置项目的访问路径
server.servlet.context-path=/kuang</p>
<h2 id="4自动配置原理">4自动配置原理</h2>
<p>在jar包中找到springboot-autoconfiguration的spring.factories</p>
<p>以**HttpEncodingAutoConfiguration（Http编码自动配置）**为例解释自动配置原理；</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="c1">//表示这是一个配置类，和以前编写的配置文件一样，也可以给容器中添加组件；
</span><span class="c1"></span><span class="nd">@Configuration</span><span class="o">(</span><span class="n">proxyBeanMethods</span> <span class="o">=</span> <span class="kc">false</span><span class="o">)</span>

<span class="c1">//启动指定类的ConfigurationProperties功能；
</span><span class="c1"></span>  <span class="c1">//进入这个HttpProperties查看，将配置文件中对应的值和HttpProperties绑定起来；
</span><span class="c1"></span>  <span class="c1">//并把HttpProperties加入到ioc容器中
</span><span class="c1"></span><span class="nd">@EnableConfigurationProperties</span><span class="o">(</span><span class="n">HttpProperties</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>

<span class="c1">//Spring底层@Conditional注解
</span><span class="c1"></span>  <span class="c1">//根据不同的条件判断，如果满足指定的条件，整个配置类里面的配置就会生效；
</span><span class="c1"></span>  <span class="c1">//这里的意思就是判断当前应用是否是web应用，如果是，当前配置类生效
</span><span class="c1"></span><span class="nd">@ConditionalOnWebApplication</span><span class="o">(</span><span class="n">type</span> <span class="o">=</span> <span class="n">ConditionalOnWebApplication</span><span class="o">.</span><span class="na">Type</span><span class="o">.</span><span class="na">SERVLET</span><span class="o">)</span>

<span class="c1">//判断当前项目有没有这个类CharacterEncodingFilter；SpringMVC中进行乱码解决的过滤器；
</span><span class="c1"></span><span class="nd">@ConditionalOnClass</span><span class="o">(</span><span class="n">CharacterEncodingFilter</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>

<span class="c1">//判断配置文件中是否存在某个配置：spring.http.encoding.enabled；
</span><span class="c1"></span>  <span class="c1">//如果不存在，判断也是成立的
</span><span class="c1"></span>  <span class="c1">//即使我们配置文件中不配置pring.http.encoding.enabled=true，也是默认生效的；
</span><span class="c1"></span><span class="nd">@ConditionalOnProperty</span><span class="o">(</span><span class="n">prefix</span> <span class="o">=</span> <span class="s">&#34;spring.http.encoding&#34;</span><span class="o">,</span>
                       <span class="n">value</span> <span class="o">=</span> <span class="s">&#34;enabled&#34;</span><span class="o">,</span> 
                       <span class="n">matchIfMissing</span> <span class="o">=</span> <span class="kc">true</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">HttpEncodingAutoConfiguration</span> <span class="o">{</span>
    <span class="c1">//他已经和SpringBoot的配置文件映射了
</span><span class="c1"></span>    <span class="kd">private</span> <span class="kd">final</span> <span class="n">Encoding</span> <span class="n">properties</span><span class="o">;</span>
    <span class="c1">//只有一个有参构造器的情况下，参数的值就会从容器中拿
</span><span class="c1"></span>    <span class="kd">public</span> <span class="nf">HttpEncodingAutoConfiguration</span><span class="o">(</span><span class="n">HttpProperties</span> <span class="n">properties</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">properties</span> <span class="o">=</span> <span class="n">properties</span><span class="o">.</span><span class="na">getEncoding</span><span class="o">();</span>
    <span class="o">}</span>
    
    <span class="c1">//给容器中添加一个组件，这个组件的某些值需要从properties中获取
</span><span class="c1"></span>    <span class="nd">@Bean</span>
    <span class="nd">@ConditionalOnMissingBean</span> <span class="c1">//判断容器没有这个组件？
</span><span class="c1"></span>    <span class="kd">public</span> <span class="n">CharacterEncodingFilter</span> <span class="nf">characterEncodingFilter</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">CharacterEncodingFilter</span> <span class="n">filter</span> <span class="o">=</span> <span class="k">new</span> <span class="n">OrderedCharacterEncodingFilter</span><span class="o">();</span>
        <span class="n">filter</span><span class="o">.</span><span class="na">setEncoding</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">properties</span><span class="o">.</span><span class="na">getCharset</span><span class="o">().</span><span class="na">name</span><span class="o">());</span>
        <span class="n">filter</span><span class="o">.</span><span class="na">setForceRequestEncoding</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">properties</span><span class="o">.</span><span class="na">shouldForce</span><span class="o">(</span><span class="n">org</span><span class="o">.</span><span class="na">springframework</span><span class="o">.</span><span class="na">boot</span><span class="o">.</span><span class="na">autoconfigure</span><span class="o">.</span><span class="na">http</span><span class="o">.</span><span class="na">HttpProperties</span><span class="o">.</span><span class="na">Encoding</span><span class="o">.</span><span class="na">Type</span><span class="o">.</span><span class="na">REQUEST</span><span class="o">));</span>
        <span class="n">filter</span><span class="o">.</span><span class="na">setForceResponseEncoding</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">properties</span><span class="o">.</span><span class="na">shouldForce</span><span class="o">(</span><span class="n">org</span><span class="o">.</span><span class="na">springframework</span><span class="o">.</span><span class="na">boot</span><span class="o">.</span><span class="na">autoconfigure</span><span class="o">.</span><span class="na">http</span><span class="o">.</span><span class="na">HttpProperties</span><span class="o">.</span><span class="na">Encoding</span><span class="o">.</span><span class="na">Type</span><span class="o">.</span><span class="na">RESPONSE</span><span class="o">));</span>
        <span class="k">return</span> <span class="n">filter</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="c1">//。。。。。。。
</span></code></pre></td></tr></table>
</div>
</div><blockquote>
<p><strong>精髓</strong></p>
</blockquote>
<p>1、SpringBoot启动会加载大量的自动配置类</p>
<p>2、我们看我们需要的功能有没有在SpringBoot默认写好的自动配置类当中；</p>
<p>3、我们再来看这个自动配置类中到底配置了哪些组件；（只要我们要用的组件存在在其中，我们就不需要再手动配置了）</p>
<p>4、给容器中自动配置类添加组件的时候，会从properties类中获取某些属性。我们只需要在配置文件中指定这些属性的值即可；</p>
<p>**xxxxAutoConfigurartion：自动配置类；**给容器中添加组件</p>
<p><strong>xxxxProperties:封装配置文件中相关属性；</strong></p>
<blockquote>
<p><strong>了解：@Conditional</strong></p>
</blockquote>
<p><strong>自动配置类必须在一定的条件下才能生效；</strong></p>
<p><strong>@Conditional派生注解（Spring注解版原生的@Conditional作用）</strong></p>
<p>作用：必须是@Conditional指定的条件成立，才给容器中添加组件，配置配里面的所有内容才生效；</p>
<p><img src="/typoraImg/SpringBoot.assets/640.jpg" alt="img"></p>
<p><strong>那么多的自动配置类，必须在一定的条件下才能生效；也就是说，我们加载了这么多的配置类，但不是所有的都生效了。</strong></p>
<p>我们怎么知道哪些自动配置类生效？</p>
<p><strong>我们可以通过启用 debug=true属性；来让控制台打印自动配置报告，这样我们就可以很方便的知道哪些自动配置类生效；</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">#开启springboot的调试类debug=true
</code></pre></td></tr></table>
</div>
</div><p><strong>Positive matches:（自动配置类启用的：正匹配）</strong></p>
<p><strong>Negative matches:（没有启动，没有匹配成功的自动配置类：负匹配）</strong></p>
<p><strong>Unconditional classes: （没有条件的类）</strong></p>
<h3 id="mvc原理">MVC原理</h3>
<p>我们找到 WebMvcAutoConfiguration ， 然后搜索ContentNegotiatingViewResolver，然后进入这个类进行查看视图解析器resolveViewName方法，在找到其中的getBestView（）查看如何查找视图的。</p>
<h2 id="5日志">5日志</h2>
<p>加入jar</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-xml" data-lang="xml"><span class="c">&lt;!--日志--&gt;</span>
    <span class="nt">&lt;dependency&gt;</span>
      <span class="nt">&lt;groupId&gt;</span>org.springframework.boot<span class="nt">&lt;/groupId&gt;</span>
      <span class="nt">&lt;artifactId&gt;</span>spring-boot-starter-log4j<span class="nt">&lt;/artifactId&gt;</span>
      <span class="nt">&lt;version&gt;</span>1.3.8.RELEASE<span class="nt">&lt;/version&gt;</span>
    <span class="nt">&lt;/dependency&gt;</span>
</code></pre></td></tr></table>
</div>
</div><p><strong>在java类中使用</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="kn">import</span> <span class="nn">org.slf4j.Logger</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.slf4j.LoggerFactory</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">HelloWorld</span> <span class="o">{</span>
  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">Logger</span> <span class="n">logger</span> <span class="o">=</span> <span class="n">LoggerFactory</span><span class="o">.</span><span class="na">getLogger</span><span class="o">(</span><span class="n">HelloWorld</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
    <span class="n">logger</span><span class="o">.</span><span class="na">trace</span><span class="o">(</span><span class="s">&#34;Hello World&#34;</span><span class="o">);</span>
    <span class="n">logger</span><span class="o">.</span><span class="na">debug</span><span class="o">(</span><span class="s">&#34;Hello World&#34;</span><span class="o">);</span>
    <span class="c1">//springBoot默认info级别，info及以上级别才会生效
</span><span class="c1"></span>    <span class="n">logger</span><span class="o">.</span><span class="na">info</span><span class="o">(</span><span class="s">&#34;Hello World&#34;</span><span class="o">);</span>
    <span class="n">logger</span><span class="o">.</span><span class="na">warn</span><span class="o">(</span><span class="s">&#34;Hello World&#34;</span><span class="o">);</span>
    <span class="n">logger</span><span class="o">.</span><span class="na">error</span><span class="o">(</span><span class="s">&#34;Hello World&#34;</span><span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><p><strong>SpringBoot日志设置</strong></p>
<p>application.properties设置</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">logging.level.限定包中的类com=trace级别

#指定盘符和位置如 F:/springboot.log，指定路径。 注意：path和name只生效一个，默认生效name
logging.file.path=

#在当前项目下生成springboot.log日志，指定名称
logging.file.name=springboot

#指定控制台/文件中生成格式
日志输出格式:
%d表示日期时间，
%thread表示线程名，
%-51eve1 :级别从左显示5个字符宽度
%logger{50}表示1ogger名字最长50个字符，否则按照句点分割。
%msg:日志消息，
%n是换行符
#logging.pattern.console=&#39;%d{yyyy-MMM-dd HH:mm:ss.SSS} %-5level [%thread] %logger{15} - %msg%n&#39; 
#logging.pattern.file=
</code></pre></td></tr></table>
</div>
</div><h1 id="第二章-web开发">第二章-web开发</h1>
<h2 id="1静态资源">1静态资源</h2>
<p>IDEA中按两次shift键查找WebMvcAutoConfiguration类，查看addResourceHandlers方法
我们看到“/webjars/**”。</p>
<blockquote>
<p>Webjars本质就是以jar包的方式引入我们的静态资源 ， 我们以前要导入一个静态资源文件，直接导入即可。</p>
<p>使用SpringBoot需要使用Webjars，我们可以去搜索一下：</p>
<p>网站：https://www.webjars.org</p>
<p>要使用jQuery，我们只要要引入jQuery对应版本的pom依赖即可！</p>
</blockquote>
<p>然后查看其中的this.mvcProperties.getStaticPathPattern();方法，发现返回值为&rdquo;**&rdquo;</p>
<p>进入if (!registry.hasMappingForPattern(staticPathPattern))条件后，发现方法中his.resourceProperties.getStaticLocations())的返回值有4个，这4个地方默认放置静态资源</p>
<blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"> <span class="k">new</span> <span class="n">String</span><span class="o">[]{</span><span class="s">&#34;classpath:/META-INF/resources/&#34;</span><span class="o">,</span>
              <span class="s">&#34;classpath:/resources/&#34;</span><span class="o">,</span> 
              <span class="s">&#34;classpath:/static/&#34;</span><span class="o">,</span> 
              <span class="s">&#34;classpath:/public/&#34;</span>
</code></pre></td></tr></table>
</div>
</div></blockquote>
<p>测试：<img src="/typoraImg/SpringBoot.assets/image-20200414165302181.png" alt="image-20200414165302181">http://localhost:8080/t1.js可以访问到资源</p>
<p>它们的优先级为resources&gt;static&gt;public</p>
<p><strong>自定义路径</strong></p>
<p>我们也可以自己通过配置文件来指定一下，哪些文件夹是需要我们放静态资源文件的，在application.properties中配置；</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">spring.resources.static-locations=classpath:/coding/,classpath:/kuang/
</code></pre></td></tr></table>
</div>
</div><p>一旦自己定义了静态文件夹的路径，原来的自动配置就都会失效了！</p>
<h2 id="2首页定制图标">2首页定制/图标</h2>
<p>IDEA中按两次shift键查找WebMvcAutoConfiguration类，查看welcomePageHandlerMapping方法</p>
<p>其中调用了getWelcomePage()方法</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java">
<span class="kd">private</span> <span class="n">Optional</span><span class="o">&lt;</span><span class="n">Resource</span><span class="o">&gt;</span> <span class="nf">getWelcomePage</span><span class="o">()</span> <span class="o">{</span>
    <span class="n">String</span><span class="o">[]</span> <span class="n">locations</span> <span class="o">=</span> <span class="n">getResourceLocations</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">resourceProperties</span><span class="o">.</span><span class="na">getStaticLocations</span><span class="o">());</span>
    <span class="c1">// ::是java8 中新引入的运算符
</span><span class="c1"></span>    <span class="c1">// Class::function的时候function是属于Class的，应该是静态方法。
</span><span class="c1"></span>    <span class="c1">// this::function的funtion是属于这个对象的。
</span><span class="c1"></span>    <span class="c1">// 简而言之，就是一种语法糖而已，是一种简写
</span><span class="c1"></span>    <span class="k">return</span> <span class="n">Arrays</span><span class="o">.</span><span class="na">stream</span><span class="o">(</span><span class="n">locations</span><span class="o">).</span><span class="na">map</span><span class="o">(</span><span class="k">this</span><span class="o">::</span><span class="n">getIndexHtml</span><span class="o">).</span><span class="na">filter</span><span class="o">(</span><span class="k">this</span><span class="o">::</span><span class="n">isReadable</span><span class="o">).</span><span class="na">findFirst</span><span class="o">();</span>
<span class="o">}</span>
<span class="c1">// 欢迎页就是一个location下的的 index.html 而已
</span><span class="c1"></span><span class="kd">private</span> <span class="n">Resource</span> <span class="nf">getIndexHtml</span><span class="o">(</span><span class="n">String</span> <span class="n">location</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">return</span> <span class="k">this</span><span class="o">.</span><span class="na">resourceLoader</span><span class="o">.</span><span class="na">getResource</span><span class="o">(</span><span class="n">location</span> <span class="o">+</span> <span class="s">&#34;index.html&#34;</span><span class="o">);</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><p>欢迎页，静态资源文件夹下的所有 index.html 页面；被 /** 映射。</p>
<p>比如我访问  http://localhost:8080/ ，就会找静态资源文件夹下的 index.html</p>
<p>新建一个 index.html ，在我们上面的3个目录中任意一个；然后访问测试  http://localhost:8080/  看结果！</p>
<p>图标：把图片放在static在，head标签下引用<code>&lt;link rel=&quot;icon&quot; type=&quot;image/x-icon&quot; href=&quot;favicon1.icon&quot; /&gt;</code></p>
<h2 id="3模版引擎">3模版引擎</h2>
<p>模板引擎，我们其实大家听到很多，其实jsp就是一个模板引擎，还有用的比较多的freemarker，包括SpringBoot给我们推荐的Thymeleaf，模板引擎有非常多，但再多的模板引擎，他们的思想都是一样的，什么样一个思想呢我们来看一下这张图：</p>
<p><img src="/typoraImg/SpringBoot.assets/640-1586859906886.png" alt="img"></p>
<p><strong>导入模版引擎</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-xml" data-lang="xml"><span class="c">&lt;!--thymeleaf--&gt;</span>
<span class="nt">&lt;dependency&gt;</span>
    <span class="nt">&lt;groupId&gt;</span>org.springframework.boot<span class="nt">&lt;/groupId&gt;</span>
    <span class="nt">&lt;artifactId&gt;</span>spring-boot-starter-thymeleaf<span class="nt">&lt;/artifactId&gt;</span>
<span class="nt">&lt;/dependency&gt;</span>
</code></pre></td></tr></table>
</div>
</div><p>前面呢，我们已经引入了Thymeleaf，那这个要怎么使用呢？</p>
<p>按照SpringBoot的自动配置原理看Thymeleaf的自动配置规则，在按照那个规则，进行使用。</p>
<p>找一下Thymeleaf的自动配置类：ThymeleafProperties</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="nd">@ConfigurationProperties</span><span class="o">(</span>
    <span class="n">prefix</span> <span class="o">=</span> <span class="s">&#34;spring.thymeleaf&#34;</span>
<span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ThymeleafProperties</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">Charset</span> <span class="n">DEFAULT_ENCODING</span><span class="o">;</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">DEFAULT_PREFIX</span> <span class="o">=</span> <span class="s">&#34;classpath:/templates/&#34;</span><span class="o">;</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">DEFAULT_SUFFIX</span> <span class="o">=</span> <span class="s">&#34;.html&#34;</span><span class="o">;</span>
    <span class="kd">private</span> <span class="kt">boolean</span> <span class="n">checkTemplate</span> <span class="o">=</span> <span class="kc">true</span><span class="o">;</span>
    <span class="kd">private</span> <span class="kt">boolean</span> <span class="n">checkTemplateLocation</span> <span class="o">=</span> <span class="kc">true</span><span class="o">;</span>
    <span class="kd">private</span> <span class="n">String</span> <span class="n">prefix</span> <span class="o">=</span> <span class="s">&#34;classpath:/templates/&#34;</span><span class="o">;</span>
    <span class="kd">private</span> <span class="n">String</span> <span class="n">suffix</span> <span class="o">=</span> <span class="s">&#34;.html&#34;</span><span class="o">;</span>
    <span class="kd">private</span> <span class="n">String</span> <span class="n">mode</span> <span class="o">=</span> <span class="s">&#34;HTML&#34;</span><span class="o">;</span>
    <span class="kd">private</span> <span class="n">Charset</span> <span class="n">encoding</span><span class="o">;</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><h3 id="快速开始">快速开始</h3>
<p>我们可以在其中看到默认的前缀和后缀！</p>
<p>我们只需要把我们的html页面放在类路径下的templates下，thymeleaf就可以帮我们自动渲染了。</p>
<p>使用thymeleaf什么都不需要配置，只需要将他放在指定的文件夹下即可！</p>
<p>1java类</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="nd">@Controller</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">April</span> <span class="o">{</span>
    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;/April&#34;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">hello</span><span class="o">(){</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;========&#34;</span><span class="o">);</span>
        <span class="k">return</span> <span class="s">&#34;April&#34;</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><p>2、编写一个测试页面  test.html 放在 templates 目录下</p>
<h3 id="thymeleaf">thymeleaf</h3>
<p>官网教程https://www.thymeleaf.org/doc/tutorials/3.0/usingthymeleaf.html#what-is-thymeleaf</p>
<p>导入命名空间<code>&lt;html xmlns:th=&quot;http://www.thymeleaf.org&quot;&gt;</code></p>
<p>1java类</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="nd">@Controller</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">April</span> <span class="o">{</span>
    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;/April&#34;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">hello</span><span class="o">(</span><span class="n">Model</span> <span class="n">model</span><span class="o">){</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;========&#34;</span><span class="o">);</span>
        <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="s">&#34;name&#34;</span><span class="o">,</span><span class="s">&#34;lusenlin&#34;</span><span class="o">);</span>
        <span class="k">return</span> <span class="s">&#34;April&#34;</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><p>2static下的April.html</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-html" data-lang="html"><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="p">&lt;</span><span class="nt">html</span> <span class="na">lang</span><span class="o">=</span><span class="s">&#34;en&#34;</span> <span class="na">xmlns:th</span><span class="o">=</span><span class="s">&#34;http://www.thymeleaf.org&#34;</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">head</span><span class="p">&gt;</span>

    <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">charset</span><span class="o">=</span><span class="s">&#34;UTF-8&#34;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">title</span><span class="p">&gt;</span>Title<span class="p">&lt;/</span><span class="nt">title</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">head</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>
<span class="c">&lt;!--th:text就是将div中的内容设置为它指定的值，和之前学习的Vue一样--&gt;</span>
<span class="p">&lt;</span><span class="nt">div</span> <span class="na">th:text</span><span class="o">=</span><span class="s">&#34;${name}&#34;</span><span class="p">&gt;&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
  
  <span class="p">&lt;</span><span class="nt">div</span> <span class="na">th:text</span><span class="o">=</span><span class="s">&#34;${msg}&#34;</span><span class="p">&gt;&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="c">&lt;!--非text--&gt;</span>
<span class="p">&lt;</span><span class="nt">div</span> <span class="na">th:utext</span><span class="o">=</span><span class="s">&#34;${msg}&#34;</span><span class="p">&gt;&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>

<span class="c">&lt;!--遍历数据--&gt;</span>
<span class="c">&lt;!--th:each每次遍历都会生成当前这个标签：官网#9--&gt;</span>
<span class="p">&lt;</span><span class="nt">h4</span> <span class="na">th:each</span><span class="o">=</span><span class="s">&#34;user :${users}&#34;</span> <span class="na">th:text</span><span class="o">=</span><span class="s">&#34;${user}&#34;</span><span class="p">&gt;&lt;/</span><span class="nt">h4</span><span class="p">&gt;</span>

<span class="p">&lt;</span><span class="nt">h4</span><span class="p">&gt;</span>
    <span class="c">&lt;!--行内写法：官网#12--&gt;</span>
    <span class="p">&lt;</span><span class="nt">span</span> <span class="na">th:each</span><span class="o">=</span><span class="s">&#34;user:${users}&#34;</span><span class="p">&gt;</span>[[${user}]]<span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">h4</span><span class="p">&gt;</span>
  
<span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
</code></pre></td></tr></table>
</div>
</div><p><strong>可以使用任意的 th:attr 来替换Html中原生属性的值！</strong></p>
<p><img src="/typoraImg/SpringBoot.assets/640-1587018289068.jpg" alt="img"></p>
<h2 id="4格式化器扩展springmvc">4格式化器/扩展SpringMVC</h2>
<p>找到 WebMvcAutoConfiguration 查看其中getDateFormat()，查看默认日期格式，为dd/MM/yyyy</p>
<p>表单提交的日期格式必须是<code>yyyy/MM/dd</code>的格式，可以在配置文件中修改格式</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">spring.mvc.date-format=yyyy-MM-dd
</code></pre></td></tr></table>
</div>
</div><p>我们要做的就是编写一个@Configuration注解类，并且类型要为WebMvcConfigurer，还不能标注@EnableWebMvc注解；我们去自己写一个；我们新建一个包叫config，写一个类MyMvcConfig；</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="c1">//应为类型要求为WebMvcConfigurer，所以我们实现其接口
</span><span class="c1">//可以使用自定义类扩展MVC的功能
</span><span class="c1"></span><span class="nd">@Configuration</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">MyMvcConfig</span> <span class="kd">implements</span> <span class="n">WebMvcConfigurer</span> <span class="o">{</span>
<span class="nd">@Override</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">addViewControllers</span><span class="o">(</span><span class="n">ViewControllerRegistry</span> <span class="n">registry</span><span class="o">)</span> <span class="o">{</span>
    <span class="c1">// 浏览器发送/test ， 就会跳转到test页面；
</span><span class="c1"></span>    <span class="n">registry</span><span class="o">.</span><span class="na">addViewController</span><span class="o">(</span><span class="s">&#34;/test&#34;</span><span class="o">).</span><span class="na">setViewName</span><span class="o">(</span><span class="s">&#34;test&#34;</span><span class="o">);</span>
<span class="o">}</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="5crudwebjars">5CRUD/webjars</h2>
<p>基于模版引擎，静态依赖放在static目录下。</p>
<p>也可以通过webjars去查找https://www.webjars.org/，以pom的方式导入</p>
<blockquote>
<p><img src="/typoraImg/SpringBoot.assets/image-20200417121348768.png" alt="image-20200417121348768"></p>
<p>访问地址为http://localhost:8080/webjars/jquery/3.4.1/jquery.js</p>
<p>以pom方式导入，在使用时引用，用thymeleaf语法，可以自动引用当前项目名称，在以后进行修改项目名称时，以达到解耦目的。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-html" data-lang="html"><span class="c">&lt;!--	原来	&lt;link href=&#34;asserts/css/bootstrap.min.css&#34; rel=&#34;stylesheet&#34;&gt;--&gt;</span>
<span class="p">&lt;</span><span class="nt">link</span> <span class="na">th:href</span><span class="o">=</span><span class="s">&#34;@{/webjars/bootstrap/4.1.0/css/bootstrap.min.css}&#34;</span> <span class="na">th:rel</span><span class="o">=</span><span class="s">&#34;stylesheet&#34;</span><span class="p">&gt;</span>
	
<span class="c">&lt;!--引入自己的静态css样式 --&gt;</span>
<span class="p">&lt;</span><span class="nt">link</span> <span class="na">th:href</span><span class="o">=</span><span class="s">&#34;@{/asserts/css/signin.css}&#34;</span> <span class="na">rel</span><span class="o">=</span><span class="s">&#34;stylesheet&#34;</span><span class="p">&gt;</span>
</code></pre></td></tr></table>
</div>
</div><p>此时若在properties或者yml中修改项目访问路径，那么使用上面方法就不需要去修改访问名称了。</p>
<p>server.context-path=/hello</p>
</blockquote>
<h3 id="1国际化">1国际化</h3>
<p>resource下创建i18n文件夹存放配置文件，文件名格式为<code>基础名(login)</code>+<code>语言代码(zh)</code>+<code>国家代码(CN)</code></p>
<p>先创建一个login.properties
再创建文件格式名称的文件 如：login_en_CN.properties
可以添加其他语言的文件，login_en_US.properties</p>
<p><img src="/typoraImg/SpringBoot.assets/image-20200417165525710.png" alt="image-20200417165525710"></p>
<p>点击Resource Bundle可以快速编写配置文件，login.properties指的是，若没有国际化配置，就默认使用login.properties</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">#编写的默认值
login.password=密码
login.remember=记住我
login.tip=请登录
login.username=用户名
</code></pre></td></tr></table>
</div>
</div><p>配置文件如何生效？</p>
<p>查找MessageSourceAutoConfiguration里面有一个方法messageSource，这里发现SpringBoot已经自动配置好了管理我们国际化资源文件的组件 ResourceBundleMessageSource；</p>
<blockquote>
<p>在application.properties配置文件中添加国际化文件的位置和基础名</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">spring.messages.basename=i18n.login
</code></pre></td></tr></table>
</div>
</div><p>如果配置文件中没有配置基础名，就在类路径下找基础名为<code>message</code>的配置文件</p>
</blockquote>
<p>html中使用:用#{} ,[[#{login.xx}]]</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-html" data-lang="html">行内使用
<span class="p">&lt;</span><span class="nt">h1</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;h3 mb-3 font-weight-normal&#34;</span> <span class="na">th:text</span><span class="o">=</span><span class="s">&#34;#{login.tip}&#34;</span><span class="p">&gt;&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>

行外使用
 <span class="p">&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">&#34;checkbox&#34;</span> <span class="na">value</span><span class="o">=</span><span class="s">&#34;remember-me&#34;</span><span class="p">&gt;</span> [[#{login.remember}]]
</code></pre></td></tr></table>
</div>
</div><p><strong>点击链接切换国际化</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-html" data-lang="html"><span class="c">&lt;!-- thymeleaf模版引擎 这里传入参数不需要使用 ？使用 （key=value）--&gt;</span>
<span class="p">&lt;</span><span class="nt">a</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;btn btn-sm&#34;</span> <span class="na">th:href</span><span class="o">=</span><span class="s">&#34;@{/index.html(l=&#39;zh_CN&#39;)}&#34;</span><span class="p">&gt;</span>中文<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">a</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;btn btn-sm&#34;</span> <span class="na">th:href</span><span class="o">=</span><span class="s">&#34;@{/index.html(l=&#39;en_US&#39;)}&#34;</span><span class="p">&gt;</span>English<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
</code></pre></td></tr></table>
</div>
</div><p>1自己实现区域信息解析器</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="kn">package</span> <span class="nn">com.lx.component</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.springframework.util.StringUtils</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.servlet.LocaleResolver</span><span class="o">;</span>


<span class="kn">import</span> <span class="nn">javax.servlet.http.HttpServletRequest</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.servlet.http.HttpServletResponse</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.Locale</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">MyLocaleResolver</span> <span class="kd">implements</span> <span class="n">LocaleResolver</span> <span class="o">{</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="n">Locale</span> <span class="nf">resolveLocale</span><span class="o">(</span><span class="n">HttpServletRequest</span> <span class="n">httpServletRequest</span><span class="o">)</span> <span class="o">{</span>
        <span class="c1">//获取请求参数中的语言
</span><span class="c1"></span>        <span class="n">String</span> <span class="n">language</span> <span class="o">=</span> <span class="n">httpServletRequest</span><span class="o">.</span><span class="na">getParameter</span><span class="o">(</span><span class="s">&#34;l&#34;</span><span class="o">);</span>
        <span class="c1">//没带区域信息参数就用系统默认的
</span><span class="c1"></span>        <span class="n">Locale</span> <span class="n">locale</span> <span class="o">=</span> <span class="n">Locale</span><span class="o">.</span><span class="na">getDefault</span><span class="o">();</span>
        <span class="k">if</span> <span class="o">(!</span><span class="n">StringUtils</span><span class="o">.</span><span class="na">isEmpty</span><span class="o">(</span><span class="n">language</span><span class="o">))</span> <span class="o">{</span>
            <span class="c1">//提交的参数是zh_CN （语言代码_国家代码）
</span><span class="c1"></span>            <span class="n">String</span><span class="o">[]</span> <span class="n">s</span> <span class="o">=</span> <span class="n">language</span><span class="o">.</span><span class="na">split</span><span class="o">(</span><span class="s">&#34;_&#34;</span><span class="o">);</span>

            <span class="n">locale</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Locale</span><span class="o">(</span><span class="n">s</span><span class="o">[</span><span class="n">0</span><span class="o">],</span> <span class="n">s</span><span class="o">[</span><span class="n">1</span><span class="o">]);</span>

        <span class="o">}</span>

        <span class="k">return</span> <span class="n">locale</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setLocale</span><span class="o">(</span><span class="n">HttpServletRequest</span> <span class="n">httpServletRequest</span><span class="o">,</span> <span class="n">HttpServletResponse</span> <span class="n">httpServletResponse</span><span class="o">,</span> <span class="n">Locale</span> <span class="n">locale</span><span class="o">)</span> <span class="o">{</span>

    <span class="o">}</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><p>2在配置类中将其注册到容器中</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="kn">package</span> <span class="nn">com.lx.cofig</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">com.lx.component.MyLocaleResolver</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.context.annotation.Bean</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.context.annotation.Configuration</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.servlet.LocaleResolver</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.servlet.config.annotation.ViewControllerRegistry</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.servlet.config.annotation.WebMvcConfigurer</span><span class="o">;</span>

<span class="nd">@Configuration</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">MyMvcConfig</span> <span class="kd">implements</span> <span class="n">WebMvcConfigurer</span> <span class="o">{</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">addViewControllers</span><span class="o">(</span><span class="n">ViewControllerRegistry</span> <span class="n">registry</span><span class="o">)</span> <span class="o">{</span>
<span class="c1">//        registry.addViewController(&#34;/&#34;).setViewName(&#34;login&#34;);
</span><span class="c1"></span>    <span class="o">}</span>

    <span class="nd">@Bean</span>
  <span class="c1">//import org.springframework.web.servlet.LocaleResolver;
</span><span class="c1"></span>    <span class="kd">public</span> <span class="n">LocaleResolver</span> <span class="nf">localeResolver</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="k">new</span> <span class="n">MyLocaleResolver</span><span class="o">();</span><span class="c1">//区域信息解析器
</span><span class="c1"></span>    <span class="o">}</span>

<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><h3 id="2拦截验证">2拦截/验证</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-html" data-lang="html"><span class="c">&lt;!-- 用来设置提示消息，strings.isEmpty()判断是否为空 --&gt;</span>
<span class="p">&lt;</span><span class="nt">p</span> <span class="na">th:text</span><span class="o">=</span><span class="s">&#34;${msg}&#34;</span> <span class="na">th:if</span><span class="o">=</span><span class="s">&#34;${not #strings.isEmpty(msg)}&#34;</span><span class="p">&gt;&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
</code></pre></td></tr></table>
</div>
</div><p>用户首先发起请求，进入拦截器。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="kn">package</span> <span class="nn">com.lx.cofig</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.servlet.HandlerInterceptor</span><span class="o">;</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">MyIntercepter</span> <span class="kd">implements</span> <span class="n">HandlerInterceptor</span> <span class="o">{</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">preHandle</span><span class="o">(</span><span class="n">HttpServletRequest</span> <span class="n">request</span><span class="o">,</span> <span class="n">HttpServletResponse</span> <span class="n">response</span><span class="o">,</span> <span class="n">Object</span> <span class="n">handler</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
       <span class="n">Object</span> <span class="n">user</span><span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">getSession</span><span class="o">().</span><span class="na">getAttribute</span><span class="o">(</span><span class="s">&#34;loginUser&#34;</span><span class="o">);</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;拦截器啊&#34;</span><span class="o">+</span><span class="n">request</span><span class="o">.</span><span class="na">getRequestURL</span><span class="o">());</span>
       <span class="k">if</span><span class="o">(</span><span class="n">user</span> <span class="o">==</span><span class="kc">null</span><span class="o">){</span>
           <span class="n">response</span><span class="o">.</span><span class="na">sendRedirect</span><span class="o">(</span><span class="s">&#34;index&#34;</span><span class="o">);</span><span class="c1">//页面为/index 需要在webMVC配置中进行设置
</span><span class="c1"></span>           <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
       <span class="o">}</span>
        <span class="k">return</span> <span class="kc">true</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><p>注册拦截器
在使用spring2.0+时，配置拦截器之后，我们要把静态资源的路径加入到不拦截的路径之中。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="kn">package</span> <span class="nn">com.lx.cofig</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.lx.component.MyLocaleResolver</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.context.annotation.Bean</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.context.annotation.Configuration</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.servlet.LocaleResolver</span><span class="o">;</span>
<span class="nd">@Configuration</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">MyMvcConfig</span> <span class="kd">implements</span> <span class="n">WebMvcConfigurer</span> <span class="o">{</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">addViewControllers</span><span class="o">(</span><span class="n">ViewControllerRegistry</span> <span class="n">registry</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">registry</span><span class="o">.</span><span class="na">addViewController</span><span class="o">(</span><span class="s">&#34;/list.html&#34;</span><span class="o">).</span><span class="na">setViewName</span><span class="o">(</span><span class="s">&#34;list&#34;</span><span class="o">);</span>
        <span class="n">registry</span><span class="o">.</span><span class="na">addViewController</span><span class="o">(</span><span class="s">&#34;/index&#34;</span><span class="o">).</span><span class="na">setViewName</span><span class="o">(</span><span class="s">&#34;index&#34;</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">addInterceptors</span><span class="o">(</span><span class="n">InterceptorRegistry</span> <span class="n">registry</span><span class="o">)</span> <span class="o">{</span>
      <span class="c1">//先添加拦截器  
</span><span class="c1"></span>      <span class="c1">//addPathPatterns(&#34;/**&#34;)拦截拦截请求
</span><span class="c1"></span>        <span class="c1">//excludePathPatterns()排除一些请求
</span><span class="c1"></span>        <span class="n">registry</span><span class="o">.</span><span class="na">addInterceptor</span><span class="o">(</span><span class="k">new</span> <span class="n">MyIntercepter</span><span class="o">())</span>
                <span class="o">.</span><span class="na">addPathPatterns</span><span class="o">(</span><span class="s">&#34;/**&#34;</span><span class="o">).</span>
                <span class="n">excludePathPatterns</span><span class="o">(</span><span class="s">&#34;/index.html&#34;</span><span class="o">,</span><span class="s">&#34;/index&#34;</span><span class="o">,</span><span class="s">&#34;/account/login&#34;</span><span class="o">,</span><span class="s">&#34;/asserts/**&#34;</span><span class="o">,</span><span class="s">&#34;/webjars/**&#34;</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><p>在controller进行验证帐号密码，</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;/login&#34;</span><span class="o">)</span>
<span class="kd">public</span> <span class="n">String</span> <span class="nf">login</span><span class="o">(</span><span class="n">Account</span> <span class="n">account</span><span class="o">,</span> <span class="n">Model</span> <span class="n">model</span><span class="o">,</span> <span class="n">HttpServletRequest</span> <span class="n">request</span><span class="o">){</span>
    <span class="k">if</span><span class="o">(</span><span class="n">account</span><span class="o">!=</span><span class="kc">null</span> <span class="o">&amp;&amp;</span> <span class="n">account</span><span class="o">.</span><span class="na">getAccount</span><span class="o">()!=</span><span class="kc">null</span> <span class="o">&amp;&amp;</span> <span class="s">&#34;123&#34;</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">account</span><span class="o">.</span><span class="na">getAccount</span><span class="o">())){</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;成功&#34;</span><span class="o">+</span><span class="n">account</span><span class="o">);</span>
        <span class="n">request</span><span class="o">.</span><span class="na">getSession</span><span class="o">().</span><span class="na">setAttribute</span><span class="o">(</span><span class="s">&#34;loginUser&#34;</span><span class="o">,</span><span class="s">&#34;11&#34;</span><span class="o">);</span>
        <span class="k">return</span> <span class="s">&#34;redirect:/list.html&#34;</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="s">&#34;msg&#34;</span><span class="o">,</span><span class="s">&#34;帐号或密码错误&#34;</span><span class="o">);</span>
    <span class="k">return</span> <span class="s">&#34;index&#34;</span><span class="o">;</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><p><strong>修改页面立刻生效</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">#禁用缓存
spring.thymeleaf.cache=false
</code></pre></td></tr></table>
</div>
</div><p>在页面修改完成以后按快捷键<code>ctrl+f9</code>，重新编译；</p>
<h3 id="3rest风格公告页面抽取">3Rest风格/公告页面抽取</h3>
<p>使用rest风格，在templates下新建一个emp文件夹(staff也可)，controller中返回staff/list</p>
<table>
<thead>
<tr>
<th>实验功能</th>
<th>请求URI</th>
<th>请求方式</th>
</tr>
</thead>
<tbody>
<tr>
<td>查询所有员工</td>
<td>emps</td>
<td>GET</td>
</tr>
<tr>
<td>查询某个员工(来到修改页面)</td>
<td>emp/1</td>
<td>GET</td>
</tr>
<tr>
<td>来到添加页面</td>
<td>emp</td>
<td>GET</td>
</tr>
<tr>
<td>添加员工</td>
<td>emp</td>
<td>POST</td>
</tr>
<tr>
<td>来到修改页面（查出员工进行信息回显）</td>
<td>emp/1</td>
<td>GET</td>
</tr>
<tr>
<td>修改员工</td>
<td>emp</td>
<td>PUT</td>
</tr>
<tr>
<td>删除员工</td>
<td>emp/1</td>
<td>DELETE</td>
</tr>
</tbody>
</table>
<ul>
<li><code>th:insert</code>：将公共片段整个插入到声明引入的元素中</li>
<li><code>th:replace</code>：将声明引入的元素替换为公共片段</li>
<li><code>th:include</code>：将被引入的片段的内容包含进这个标签中</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-html" data-lang="html">/*公共代码片段*/
<span class="p">&lt;</span><span class="nt">footer</span> <span class="na">th:fragment</span><span class="o">=</span><span class="s">&#34;copy&#34;</span><span class="p">&gt;</span>
    <span class="ni">&amp;copy;</span> 2011 The Good Thymes Virtual Grocery
<span class="p">&lt;/</span><span class="nt">footer</span><span class="p">&gt;</span>

/*引用代码片段*/
<span class="p">&lt;</span><span class="nt">div</span> <span class="na">th:insert</span><span class="o">=</span><span class="s">&#34;~{footer :: copy}&#34;</span><span class="p">&gt;</span><span class="err">&lt;</span>/di

/*（〜{...}包围是完全可选的，所以上⾯的代码 将等价于：*/
<span class="p">&lt;</span><span class="nt">div</span> <span class="na">th:insert</span><span class="o">=</span><span class="s">&#34;footer :: copy&#34;</span><span class="p">&gt;</span><span class="err">&lt;</span>/di
</code></pre></td></tr></table>
</div>
</div><p><strong>传递数值</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-html" data-lang="html">/*或者在定义代码片段时，定义参数*/
<span class="p">&lt;</span><span class="nt">nav</span> <span class="na">th:fragment</span><span class="o">=</span><span class="s">&#34;topbar(A,B)&#34;</span>
     
<span class="err">/*</span><span class="na">引入时直接传递参数</span><span class="err">*/</span>
<span class="err">~{</span><span class="na">templatename::fragmentname</span><span class="err">(</span><span class="na">A值</span><span class="err">,</span><span class="na">B值</span><span class="err">)}</span>
<span class="err">&lt;!</span><span class="na">--例子</span><span class="err">：</span><span class="na">引用时传递数值--</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">div</span> <span class="na">th:insert</span><span class="o">=</span><span class="s">&#34;~{component/components :: navLeft(active=&#39;dashboard.html&#39;)}&#34;</span><span class="p">&gt;&lt;/</span><span class="nt">div</span><span class="p">&gt;</span> 

</code></pre></td></tr></table>
</div>
</div><h3 id="4crud页面错误处理">4CRUD/页面错误处理</h3>
<p>特定格式显示日期：<code>&lt;td th:text=&quot;${#dates.format(staff.birth,'yyyy-MM-dd')}&quot;&gt;&lt;/td&gt;</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-html" data-lang="html"><span class="c">&lt;!--@{/staff}加上/斜杠 可以避免转发带来的路径错误 --&gt;</span>
<span class="p">&lt;</span><span class="nt">form</span> <span class="na">th:action</span><span class="o">=</span><span class="s">&#34;@{/staff}&#34;</span> <span class="na">method</span><span class="o">=</span><span class="s">&#34;post&#34;</span><span class="p">&gt;</span>
</code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="c1">//Controller Rest风格
</span><span class="c1"></span><span class="nd">@RequestMapping</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">&#34;/toUpdateStaff/{id}&#34;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">toUpdateStaff</span><span class="o">(</span><span class="nd">@PathVariable</span> <span class="n">Integer</span> <span class="n">id</span><span class="o">,</span> <span class="n">Model</span> <span class="n">model</span><span class="o">){</span>
        <span class="k">return</span> <span class="s">&#34;staff/update&#34;</span><span class="o">;</span>
    <span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><p>错误处理：在template下新建一个error文件夹，然后404错误页面就写一个404.html。</p>
<h2 id="6跨域">6跨域</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-go" data-lang="go"><span class="kn">package</span> <span class="nx">com</span><span class="p">.</span><span class="nx">lx</span><span class="p">.</span><span class="nx">config</span><span class="p">;</span>

<span class="kn">import</span> <span class="nx">org</span><span class="p">.</span><span class="nx">springframework</span><span class="p">.</span><span class="nx">context</span><span class="p">.</span><span class="nx">annotation</span><span class="p">.</span><span class="nx">Bean</span><span class="p">;</span>
<span class="kn">import</span> <span class="nx">org</span><span class="p">.</span><span class="nx">springframework</span><span class="p">.</span><span class="nx">context</span><span class="p">.</span><span class="nx">annotation</span><span class="p">.</span><span class="nx">Configuration</span><span class="p">;</span>
<span class="kn">import</span> <span class="nx">org</span><span class="p">.</span><span class="nx">springframework</span><span class="p">.</span><span class="nx">web</span><span class="p">.</span><span class="nx">cors</span><span class="p">.</span><span class="nx">CorsConfiguration</span><span class="p">;</span>
<span class="kn">import</span> <span class="nx">org</span><span class="p">.</span><span class="nx">springframework</span><span class="p">.</span><span class="nx">web</span><span class="p">.</span><span class="nx">cors</span><span class="p">.</span><span class="nx">UrlBasedCorsConfigurationSource</span><span class="p">;</span>
<span class="kn">import</span> <span class="nx">org</span><span class="p">.</span><span class="nx">springframework</span><span class="p">.</span><span class="nx">web</span><span class="p">.</span><span class="nx">filter</span><span class="p">.</span><span class="nx">CorsFilter</span><span class="p">;</span>


<span class="err">@</span><span class="nx">Configuration</span>
<span class="nx">public</span> <span class="nx">class</span> <span class="nx">MyConfiguration</span> <span class="p">{</span>
    <span class="nx">private</span> <span class="nx">CorsConfiguration</span> <span class="nf">buildConfig</span><span class="p">()</span> <span class="p">{</span>
        <span class="nx">CorsConfiguration</span> <span class="nx">corsConfiguration</span> <span class="p">=</span> <span class="nx">new</span> <span class="nf">CorsConfiguration</span><span class="p">();</span>
        <span class="nx">corsConfiguration</span><span class="p">.</span><span class="nf">addAllowedOrigin</span><span class="p">(</span><span class="s">&#34;*&#34;</span><span class="p">);</span> <span class="c1">//允许任何域名
</span><span class="c1"></span>        <span class="nx">corsConfiguration</span><span class="p">.</span><span class="nf">addAllowedHeader</span><span class="p">(</span><span class="s">&#34;*&#34;</span><span class="p">);</span> <span class="c1">//允许任何头
</span><span class="c1"></span>        <span class="nx">corsConfiguration</span><span class="p">.</span><span class="nf">addAllowedMethod</span><span class="p">(</span><span class="s">&#34;*&#34;</span><span class="p">);</span> <span class="c1">//允许任何方法
</span><span class="c1"></span>        <span class="k">return</span> <span class="nx">corsConfiguration</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="err">@</span><span class="nx">Bean</span>
    <span class="nx">public</span> <span class="nx">CorsFilter</span> <span class="nf">corsFilter</span><span class="p">()</span> <span class="p">{</span>
        <span class="nx">UrlBasedCorsConfigurationSource</span> <span class="nx">source</span> <span class="p">=</span> <span class="nx">new</span> <span class="nf">UrlBasedCorsConfigurationSource</span><span class="p">();</span>
        <span class="nx">source</span><span class="p">.</span><span class="nf">registerCorsConfiguration</span><span class="p">(</span><span class="s">&#34;/**&#34;</span><span class="p">,</span> <span class="nf">buildConfig</span><span class="p">());</span> <span class="c1">//注册
</span><span class="c1"></span>        <span class="k">return</span> <span class="nx">new</span> <span class="nf">CorsFilter</span><span class="p">(</span><span class="nx">source</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><h1 id="第三章-springdata">第三章-SpringData</h1>
<h2 id="1什么是springdata">1什么是SpringData</h2>
<p>对于数据访问层，无论是 SQL(关系型数据库) 还是 NOSQL(非关系型数据库)，Spring Boot 底层都是采用 Spring Data 的方式进行统一处理。</p>
<p>Spring Boot 底层都是采用 Spring Data 的方式进行统一处理各种数据库，Spring Data 也是 Spring 中与 Spring Boot、Spring Cloud 等齐名的知名项目。</p>
<p>Sping Data 官网：https://spring.io/projects/spring-data</p>
<p>数据库相关的启动器 ：可以参考官方文档：</p>
<p><a href="https://docs.spring.io/spring-boot/docs/2.2.5.RELEASE/reference/htmlsingle/#using-boot-starter">https://docs.spring.io/spring-boot/docs/2.2.5.RELEASE/reference/htmlsingle/#using-boot-starter</a></p>
<h3 id="整合jdbc">整合JDBC</h3>
<p>新建一个项目测试：springboot-data-jdbc ; 引入相应的模块！基础模块</p>
<p>Spring Web 、 JDBC API 、MySQL Driver</p>
<p>新建一个application.yml配置文件</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">spring:
  datasource:
    username: root
    password: 123456
    url: jdbc:mysql://localhost:3306/mysql1?serverTimezone=UTC&amp;useUnicode=true&amp;characterEncoding=utf-8
    driver-class-name: com.mysql.jdbc.Driver
</code></pre></td></tr></table>
</div>
</div><p>测试类中测试</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="kn">package</span> <span class="nn">com.lx</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.junit.jupiter.api.Test</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.beans.factory.annotation.Autowired</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.boot.test.context.SpringBootTest</span><span class="o">;</span>

<span class="nd">@SpringBootTest</span>
<span class="kd">class</span> <span class="nc">Springboot2DataApplicationTests</span> <span class="o">{</span>

    <span class="nd">@Autowired</span>
    <span class="n">DataSource</span> <span class="n">datasource</span><span class="o">;</span>

    <span class="nd">@Test</span>
    <span class="kt">void</span> <span class="nf">contextLoads</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">SQLException</span> <span class="o">{</span>
        <span class="c1">//默认数据源为class com.zaxxer.hikari.HikariDataSource
</span><span class="c1"></span>        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">datasource</span><span class="o">.</span><span class="na">getClass</span><span class="o">()+</span><span class="s">&#34;查看默认数据源&#34;</span><span class="o">);</span>

        <span class="c1">//获得连接
</span><span class="c1"></span>        <span class="n">Connection</span> <span class="n">connection</span> <span class="o">=</span> <span class="n">datasource</span><span class="o">.</span><span class="na">getConnection</span><span class="o">();</span>
        <span class="n">PreparedStatement</span> <span class="n">ps</span><span class="o">=</span><span class="n">connection</span><span class="o">.</span><span class="na">prepareStatement</span><span class="o">(</span><span class="s">&#34;select * from staff&#34;</span><span class="o">);</span>
        <span class="n">ResultSet</span> <span class="n">resultSet</span> <span class="o">=</span> <span class="n">ps</span><span class="o">.</span><span class="na">executeQuery</span><span class="o">();</span>
        <span class="k">while</span> <span class="o">(</span><span class="n">resultSet</span><span class="o">.</span><span class="na">next</span><span class="o">()){</span>
            <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">resultSet</span><span class="o">.</span><span class="na">getInt</span><span class="o">(</span><span class="s">&#34;id&#34;</span><span class="o">)+</span><span class="s">&#34; &#34;</span><span class="o">+</span><span class="n">resultSet</span><span class="o">.</span><span class="na">getString</span><span class="o">(</span><span class="s">&#34;name&#34;</span><span class="o">));</span>
        <span class="o">}</span>
        <span class="n">connection</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
    <span class="o">}</span>

<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><h3 id="jdbctemplate">JDBCTemplate</h3>
<p>1、有了数据源(com.zaxxer.hikari.HikariDataSource)，然后可以拿到数据库连接(java.sql.Connection)，有了连接，就可以使用原生的 JDBC 语句来操作数据库；</p>
<p>2、即使不使用第三方第数据库操作框架，如 MyBatis等，Spring 本身也对原生的JDBC 做了轻量级的封装，即JdbcTemplate。</p>
<p>3、数据库操作的所有 CRUD 方法都在 JdbcTemplate 中。</p>
<p>4、Spring Boot 不仅提供了默认的数据源，同时默认已经配置好了 JdbcTemplate 放在了容器中，程序员只需自己注入即可使用</p>
<p>5、JdbcTemplate 的自动配置是依赖 org.springframework.boot.autoconfigure.jdbc 包下的 JdbcTemplateConfiguration 类</p>
<p><strong>JdbcTemplate主要提供以下几类方法：</strong></p>
<ul>
<li>execute方法：可以用于执行任何SQL语句，一般用于执行DDL语句；</li>
<li>update方法及batchUpdate方法：update方法用于执行新增、修改、删除等语句；batchUpdate方法用于执行批处理相关语句；</li>
<li>query方法及queryForXXX方法：用于执行查询相关语句；</li>
<li>call方法：用于执行存储过程、函数相关语句。</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="kn">package</span> <span class="nn">com.lx.controller</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.beans.factory.annotation.Autowired</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.jdbc.core.JdbcTemplate</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.GetMapping</span><span class="o">;</span>

<span class="nd">@RestController</span>
<span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;/jdbc&#34;</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">JdbcController</span> <span class="o">{</span>
    <span class="cm">/**
</span><span class="cm">     * Spring Boot 默认提供了数据源，默认提供了 org.springframework.jdbc.core.JdbcTemplate
</span><span class="cm">     * JdbcTemplate 中会自己注入数据源，用于简化 JDBC操作
</span><span class="cm">     * 还能避免一些常见的错误,使用起来也不用再自己来关闭数据库连接
</span><span class="cm">     */</span>
    <span class="nd">@Autowired</span>
    <span class="n">JdbcTemplate</span> <span class="n">jdbcTemplate</span><span class="o">;</span>
<span class="c1">//查询 List 中的1个 Map 对应数据库的
</span><span class="c1">// 1行数据 Map 中的 key 对应数据库的字段名，value 对应数据库的字段值
</span><span class="c1"></span><span class="nd">@GetMapping</span><span class="o">(</span><span class="s">&#34;/staffs&#34;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span><span class="n">Object</span><span class="o">&gt;&gt;</span> <span class="nf">staffList</span><span class="o">(){</span>
    <span class="n">String</span> <span class="n">sql</span><span class="o">=</span><span class="s">&#34;select * from staff&#34;</span><span class="o">;</span>
    <span class="n">List</span><span class="o">&lt;</span><span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span><span class="n">Object</span><span class="o">&gt;&gt;</span> <span class="n">maps</span><span class="o">=</span><span class="n">jdbcTemplate</span><span class="o">.</span><span class="na">queryForList</span><span class="o">(</span><span class="n">sql</span><span class="o">);</span>
    <span class="k">return</span> <span class="n">maps</span><span class="o">;</span>
<span class="o">}</span>

<span class="c1">//添加
</span><span class="c1"></span>    <span class="nd">@GetMapping</span><span class="o">(</span><span class="s">&#34;/addStaff&#34;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">addStaff</span><span class="o">(){</span>
    <span class="n">String</span> <span class="n">sql</span><span class="o">=</span><span class="s">&#34;insert into staff values(&#39;xxx&#39;,null,&#39;明1明&#39;,13,&#39;2012/1/5&#39;,null,null)&#34;</span><span class="o">;</span>
    <span class="n">jdbcTemplate</span><span class="o">.</span><span class="na">update</span><span class="o">(</span><span class="n">sql</span><span class="o">);</span>
    <span class="k">return</span> <span class="s">&#34;OK&#34;</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="c1">//修改
</span><span class="c1"></span>    <span class="nd">@GetMapping</span><span class="o">(</span><span class="s">&#34;/updateStaff/{id}&#34;</span><span class="o">)</span>

    <span class="kd">public</span> <span class="n">String</span> <span class="nf">updateStaff</span><span class="o">(</span><span class="nd">@PathVariable</span> <span class="n">Integer</span> <span class="n">id</span><span class="o">){</span>
    <span class="n">String</span> <span class="n">sql</span><span class="o">=</span><span class="s">&#34;update staff set name=&#39;周小舟&#39; where id=?&#34;</span><span class="o">;</span>
    <span class="n">jdbcTemplate</span><span class="o">.</span><span class="na">update</span><span class="o">(</span><span class="n">sql</span><span class="o">,</span><span class="n">id</span><span class="o">);</span>
    <span class="k">return</span> <span class="s">&#34;update ok&#34;</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="c1">//删除
</span><span class="c1"></span>    <span class="nd">@GetMapping</span><span class="o">(</span><span class="s">&#34;/deleteStaff/{id}&#34;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">deleteStaff</span><span class="o">(</span><span class="nd">@PathVariable</span> <span class="n">Integer</span> <span class="n">id</span><span class="o">){</span>
        <span class="n">String</span> <span class="n">sql</span><span class="o">=</span><span class="s">&#34;delete from staff where id=?&#34;</span><span class="o">;</span>
        <span class="n">jdbcTemplate</span><span class="o">.</span><span class="na">update</span><span class="o">(</span><span class="n">sql</span><span class="o">,</span><span class="n">id</span><span class="o">);</span>
        <span class="k">return</span> <span class="s">&#34;update ok&#34;</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="2整合druid数据源">2整合Druid数据源</h2>
<blockquote>
<p>选择哪个数据库连接池</p>
<ul>
<li>DBCP2 是 Appache 基金会下的项目，是最早出现的数据库连接池 DBCP 的第二个版本。</li>
<li>C3P0 最早出现时是作为 Hibernate 框架的默认数据库连接池而进入市场。</li>
<li>Druid 是阿里巴巴公司开源的一款数据库连接池，其特点在于有丰富的附加功能。</li>
<li>HikariCP 相较而言比较新，它最近两年才出现，据称是速度最快的数据库连接池。最近更是被 Spring 设置为默认数据库连接池。</li>
</ul>
<p>不选择 C3P0 的原因：</p>
<ul>
<li>C3P0 的 Connection 是异步释放。这个特性会导致释放的在某些情况下 Connection 实际上 <strong>still in use</strong> ，并未真正释放掉，从而导致连接池中的 Connection 耗完，等待状况。</li>
<li>Hibernate 现在对所有数据库连接池一视同仁，官方不再指定『默认』数据库连接池。因此 C3P0 就失去了『官方』光环。</li>
</ul>
<p>不选择 DBCP2 的原因：</p>
<ul>
<li>相较于 Druid 和 HikariCP，DBCP2 没有什么特色功能/卖点。基本上属于 <code>能用，没毛病</code> 的情况，地位显得略有尴尬。</li>
</ul>
</blockquote>
<p>1 在 Spring Boot 项目中加入<code>druid-spring-boot-starter</code>依赖 (<a href="https://mvnrepository.com/artifact/com.alibaba/druid-spring-boot-starter">点击查询最新版本</a>)</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-xml" data-lang="xml"><span class="nt">&lt;dependency&gt;</span>
    <span class="nt">&lt;groupId&gt;</span>com.alibaba<span class="nt">&lt;/groupId&gt;</span>
    <span class="nt">&lt;artifactId&gt;</span>druid-spring-boot-starter<span class="nt">&lt;/artifactId&gt;</span>
    <span class="nt">&lt;version&gt;</span>1.1.21<span class="nt">&lt;/version&gt;</span>
<span class="nt">&lt;/dependency&gt;</span>
</code></pre></td></tr></table>
</div>
</div><p>2在配置文件中指定数据源类型(Spring Boot 2.0 以上默认使用 com.zaxxer.hikari.HikariDataSource 数据源，但可以 通过 spring.datasource.type 指定数据源。)</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-yaml" data-lang="yaml"><span class="k">spring</span><span class="p">:</span><span class="w">
</span><span class="w">  </span><span class="k">datasource</span><span class="p">:</span><span class="w">
</span><span class="w">    </span><span class="k">username</span><span class="p">:</span><span class="w"> </span>root<span class="w">
</span><span class="w">    </span><span class="k">password</span><span class="p">:</span><span class="w"> </span><span class="m">123456</span><span class="w">
</span><span class="w">    </span><span class="k">url</span><span class="p">:</span><span class="w"> </span>jdbc<span class="p">:</span>mysql<span class="p">:</span>//localhost<span class="p">:</span><span class="m">3306</span>/mysql1<span class="p">?</span>serverTimezone=UTC<span class="cp">&amp;useUnicode=true&amp;characterEncoding=utf-8</span><span class="w">
</span><span class="w">    </span><span class="k">driver-class-name</span><span class="p">:</span><span class="w"> </span>com.mysql.jdbc.Driver<span class="w">
</span><span class="w">    </span><span class="k">type</span><span class="p">:</span><span class="w"> </span>com.alibaba.druid.pool.DruidDataSource<span class="w"> </span><span class="c"># 自定义数据源</span><span class="w">
</span><span class="w">    </span><span class="k">druid</span><span class="p">:</span><span class="w">
</span><span class="w">      </span><span class="c"># 连接池配置</span><span class="w">
</span><span class="w">      </span><span class="c"># 配置初始化大小、最小、最大</span><span class="w">
</span><span class="w">      </span><span class="k">initial-size</span><span class="p">:</span><span class="w"> </span><span class="m">1</span><span class="w">
</span><span class="w">      </span><span class="k">min-idle</span><span class="p">:</span><span class="w"> </span><span class="m">1</span><span class="w">
</span><span class="w">      </span><span class="k">max-active</span><span class="p">:</span><span class="w"> </span><span class="m">20</span><span class="w">
</span><span class="w">      </span><span class="c"># 配置获取连接等待超时的时间</span><span class="w">
</span><span class="w">      </span><span class="k">max-wait</span><span class="p">:</span><span class="w"> </span><span class="m">3000</span><span class="w">
</span><span class="w">      </span><span class="k">validation-query</span><span class="p">:</span><span class="w"> </span>SELECT<span class="w"> </span><span class="m">1</span><span class="w"> </span>FROM<span class="w"> </span>DUAL<span class="w">
</span><span class="w">      </span><span class="k">test-on-borrow</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="w">
</span><span class="w">      </span><span class="k">test-on-return</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="w">
</span><span class="w">      </span><span class="k">test-while-idle</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
</span><span class="w">      </span><span class="k">pool-prepared-statements</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
</span><span class="w">      </span><span class="k">time-between-eviction-runs-millis</span><span class="p">:</span><span class="w"> </span><span class="m">60000</span><span class="w">
</span><span class="w">      </span><span class="k">min-evictable-idle-time-millis</span><span class="p">:</span><span class="w"> </span><span class="m">300000</span><span class="w">
</span><span class="w">      </span><span class="c">#配置监控统计拦截的filters，stat:监控统计、log4j：日志记录、wall：防御sql注入</span><span class="w">
</span><span class="w">      </span><span class="k">filters</span><span class="p">:</span><span class="w"> </span>stat<span class="p">,</span>wall<span class="p">,</span>slf4j<span class="w">
</span><span class="w">      </span><span class="c"># 配置web监控,默认配置也和下面相同(除用户名密码，enabled默认false外)，其他可以不配</span><span class="w">
</span><span class="w">      </span><span class="k">web-stat-filter</span><span class="p">:</span><span class="w">
</span><span class="w">        </span><span class="k">enabled</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
</span><span class="w">        </span><span class="k">url-pattern</span><span class="p">:</span><span class="w"> </span>/*<span class="w">
</span><span class="w">        </span><span class="k">exclusions</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;*.js,*.gif,*.jpg,*.png,*.css,*.ico,/druid/*&#34;</span><span class="w">
</span><span class="w">      </span><span class="k">stat-view-servlet</span><span class="p">:</span><span class="w">
</span><span class="w">        </span><span class="k">enabled</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
</span><span class="w">        </span><span class="k">url-pattern</span><span class="p">:</span><span class="w"> </span>/druid/*<span class="w">  </span><span class="c">#路径</span><span class="w">
</span><span class="w">        </span><span class="k">login-username</span><span class="p">:</span><span class="w"> </span>admin<span class="w">  </span><span class="c">#帐号和密码</span><span class="w">
</span><span class="w">        </span><span class="k">login-password</span><span class="p">:</span><span class="w"> </span><span class="m">123456</span><span class="w">
</span><span class="w">        </span><span class="k">allow</span><span class="p">:</span><span class="w"> </span><span class="m">127.0.0.1</span><span class="w">  </span><span class="c">#设置能够访问的地址</span><span class="w">
</span><span class="w">
</span></code></pre></td></tr></table>
</div>
</div><h2 id="3整合mybatis">3整合mybatis</h2>
<p>首先确定数据源</p>
<p>新建项目<img src="/typoraImg/SpringBoot.assets/image-20200419171609634.png" alt="image-20200419171609634">若选择Mybatis，springboot会自懂导入下面的依赖</p>
<p>1、导入 MyBatis 所需要的依赖</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-xml" data-lang="xml"><span class="nt">&lt;dependency&gt;</span>
    <span class="nt">&lt;groupId&gt;</span>org.mybatis.spring.boot<span class="nt">&lt;/groupId&gt;</span>
    <span class="nt">&lt;artifactId&gt;</span>mybatis-spring-boot-starter<span class="nt">&lt;/artifactId&gt;</span>
    <span class="nt">&lt;version&gt;</span>2.1.1<span class="nt">&lt;/version&gt;</span>
<span class="nt">&lt;/dependency&gt;</span>

</code></pre></td></tr></table>
</div>
</div><p>2com.lx.mapper新建StaffMapper 接口</p>
<p>启动类使用@MapperScan(&ldquo;com.lx.mapper&rdquo;)就不用在这里使用@Mapper注解了
意思是为扫描mapper，为接口注入实现类</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="kn">package</span> <span class="nn">com.lx.mapper</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">com.lx.vo.Staff</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.ibatis.annotations.Mapper</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.stereotype.Repository</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.util.List</span><span class="o">;</span>

<span class="c1">//@Mapper  启动类使用@MapperScan(&#34;com.lx.mapper&#34;)就不用在这里使用mapper注解了
</span><span class="c1">//mapper说明这是一个mabatis的mapper类 dao
</span><span class="c1"></span><span class="nd">@Repository</span>
<span class="kd">public</span> <span class="kd">interface</span> <span class="nc">StaffMapper</span> <span class="o">{</span>

<span class="n">List</span><span class="o">&lt;</span><span class="n">Staff</span><span class="o">&gt;</span> <span class="nf">queryStaffList</span><span class="o">();</span>
<span class="n">Staff</span> <span class="nf">queryStaffById</span><span class="o">(</span><span class="n">Integer</span> <span class="n">id</span><span class="o">);</span>
<span class="kt">boolean</span> <span class="nf">updateStaff</span><span class="o">(</span><span class="n">Staff</span> <span class="n">staff</span><span class="o">);</span>
<span class="kt">boolean</span> <span class="nf">deleteStaff</span><span class="o">(</span><span class="n">Integer</span> <span class="n">id</span><span class="o">);</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><p>6、resources下新建mabatis  然后建立对应的Mapper映射文件 DepartmentMapper.xml</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-xml" data-lang="xml"><span class="cp">&lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34; ?&gt;</span>
<span class="cp">&lt;!DOCTYPE mapper
</span><span class="cp">        PUBLIC &#34;-//mybatis.org//DTD Mapper 3.0//EN&#34;
</span><span class="cp">        &#34;http://mybatis.org/dtd/mybatis-3-mapper.dtd&#34;&gt;</span>

<span class="nt">&lt;mapper</span> <span class="na">namespace=</span><span class="s">&#34;com.kuang.mapper.DepartmentMapper&#34;</span><span class="nt">&gt;</span>

    <span class="nt">&lt;select</span> <span class="na">id=</span><span class="s">&#34;getDepartments&#34;</span> <span class="na">resultType=</span><span class="s">&#34;Department&#34;</span><span class="nt">&gt;</span>
       select * from department;
    <span class="nt">&lt;/select&gt;</span>

    <span class="nt">&lt;select</span> <span class="na">id=</span><span class="s">&#34;getDepartment&#34;</span> <span class="na">resultType=</span><span class="s">&#34;Department&#34;</span> <span class="na">parameterType=</span><span class="s">&#34;int&#34;</span><span class="nt">&gt;</span>
       select * from department where id = #{id};
    <span class="nt">&lt;/select&gt;</span>

<span class="nt">&lt;/mapper&gt;</span>
</code></pre></td></tr></table>
</div>
</div><p>application.yml文件进行mybatis配置</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">#整合mybatis
mybatis:
  type-aliases-package: com.lx.vo
  mapper-locations: classpath:mybatis/mapper/*.xml
</code></pre></td></tr></table>
</div>
</div><p>可能出现资源过滤问题 ,pom.xml设置</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-xml" data-lang="xml"><span class="nt">&lt;resources&gt;</span>
    <span class="nt">&lt;resource&gt;</span>
        <span class="nt">&lt;directory&gt;</span>src/main/java<span class="nt">&lt;/directory&gt;</span>
        <span class="nt">&lt;includes&gt;</span>
            <span class="nt">&lt;include&gt;</span>**/*.xml<span class="nt">&lt;/include&gt;</span>
        <span class="nt">&lt;/includes&gt;</span>
        <span class="nt">&lt;filtering&gt;</span>true<span class="nt">&lt;/filtering&gt;</span>
    <span class="nt">&lt;/resource&gt;</span>
<span class="nt">&lt;/resources&gt;</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="4整合jpa">4整合jpa</h2>
<p>一、SpringBootData JPA介绍
  SpringData：其实SpringData就是Spring提供了一个操作数据的框架。而SpringData JPA只是SpringData框架下的一个基于JPA标准操作数据的模块。
  SpringData JPA：基于JPA的标准数据进行操作。简化操作持久层的代码。只需要编写接口就可以。</p>
<p><strong>1加入依赖</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-xml" data-lang="xml"><span class="c">&lt;!--springBoot依赖 tomcat,dispatcherServlet,xml --&gt;</span>
<span class="nt">&lt;dependency&gt;</span>
    <span class="nt">&lt;groupId&gt;</span>org.springframework.boot<span class="nt">&lt;/groupId&gt;</span>
    <span class="nt">&lt;artifactId&gt;</span>spring-boot-starter-web<span class="nt">&lt;/artifactId&gt;</span>
<span class="nt">&lt;/dependency&gt;</span>

<span class="c">&lt;!--开启热部署--&gt;</span>
<span class="nt">&lt;dependency&gt;</span>
    <span class="nt">&lt;groupId&gt;</span>org.springframework.boot<span class="nt">&lt;/groupId&gt;</span>
    <span class="nt">&lt;artifactId&gt;</span>spring-boot-devtools<span class="nt">&lt;/artifactId&gt;</span>
    <span class="nt">&lt;optional&gt;</span>true<span class="nt">&lt;/optional&gt;</span>
<span class="nt">&lt;/dependency&gt;</span>

<span class="nt">&lt;dependency&gt;</span>
    <span class="nt">&lt;groupId&gt;</span>mysql<span class="nt">&lt;/groupId&gt;</span>
    <span class="nt">&lt;artifactId&gt;</span>mysql-connector-java<span class="nt">&lt;/artifactId&gt;</span>
<span class="nt">&lt;/dependency&gt;</span>

<span class="c">&lt;!--springData JPA启动器--&gt;</span>
<span class="nt">&lt;dependency&gt;</span>
    <span class="nt">&lt;groupId&gt;</span>org.springframework.boot<span class="nt">&lt;/groupId&gt;</span>
    <span class="nt">&lt;artifactId&gt;</span>spring-boot-starter-data-jpa<span class="nt">&lt;/artifactId&gt;</span>
<span class="nt">&lt;/dependency&gt;</span>
</code></pre></td></tr></table>
</div>
</div><p>2设置实体类、写dao方法、</p>
<p><code>physical-strategy: org.hibernate.boot.model.naming.PhysicalNamingStrategyStandardImpl</code>  yml中让实体类 映射 表不进行驼峰转换。(默认 表名empNmae会转为emp_name)</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="c1">//注意jpa，使用Table()无法用name处理表名不一致的问题
</span><span class="c1"></span><span class="nd">@Entity</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">&#34;zz_account&#34;</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Account</span> <span class="o">{</span>

    <span class="nd">@Id</span>    <span class="c1">//主键id
</span><span class="c1"></span>    <span class="nd">@GeneratedValue</span><span class="o">(</span><span class="n">strategy</span><span class="o">=</span> <span class="n">GenerationType</span><span class="o">.</span><span class="na">IDENTITY</span><span class="o">)</span><span class="c1">//主键生成策略
</span><span class="c1"></span>    <span class="kd">private</span> <span class="n">Integer</span> <span class="n">aid</span><span class="o">;</span>
<span class="o">}</span>

<span class="c1">//写一个dao方法
</span><span class="c1"></span><span class="kd">public</span> <span class="kd">interface</span> <span class="nc">AccountDao</span> <span class="kd">extends</span> <span class="n">JpaRepository</span><span class="o">&lt;</span><span class="n">Account</span><span class="o">,</span> <span class="n">Serializable</span><span class="o">&gt;</span> <span class="o">{</span>
<span class="c1">//注解查询
</span><span class="c1"></span>    <span class="nd">@Query</span><span class="o">(</span><span class="s">&#34;select a from zz_account a where a.username like %:name%&#34;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">Account</span><span class="o">&gt;</span> <span class="nf">findAccountByUsername</span><span class="o">(</span><span class="nd">@Param</span><span class="o">(</span><span class="s">&#34;name&#34;</span><span class="o">)</span><span class="n">String</span> <span class="n">username</span><span class="o">);</span>
<span class="o">}</span>

<span class="c1">//进行调用
</span><span class="c1"></span><span class="nd">@RestController</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">hello</span> <span class="o">{</span>
 <span class="nd">@Autowired</span>
    <span class="n">AccountDao</span> <span class="n">accountDao</span><span class="o">;</span>

    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;/&#34;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">Account</span><span class="o">&gt;</span> <span class="nf">hello</span><span class="o">(){</span>
        <span class="k">return</span> <span class="n">accountDao</span><span class="o">.</span><span class="na">findAll</span><span class="o">();</span>
    <span class="o">}</span>
<span class="o">}</span>

<span class="c1">//分页
</span><span class="c1"></span> <span class="c1">//分页
</span><span class="c1"></span><span class="kt">int</span> <span class="n">currentPage</span><span class="o">=</span><span class="n">0</span><span class="o">;</span><span class="c1">//当前页从0开始
</span><span class="c1"></span><span class="kt">int</span> <span class="n">pageSize</span><span class="o">=</span><span class="n">3</span><span class="o">;</span><span class="c1">//每页3个
</span><span class="c1"></span><span class="n">PageRequest</span> <span class="n">page</span><span class="o">=</span><span class="n">PageRequest</span><span class="o">.</span><span class="na">of</span><span class="o">(</span><span class="n">currentPage</span><span class="o">,</span><span class="n">pageSize</span><span class="o">);</span>
<span class="n">Page</span><span class="o">&lt;</span><span class="n">Account</span><span class="o">&gt;</span> <span class="n">all</span> <span class="o">=</span> <span class="n">accountDao</span><span class="o">.</span><span class="na">findAll</span><span class="o">(</span><span class="n">page</span><span class="o">);</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="5整合redis">5整合redis</h2>
<p>加入redis.jar</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-xml" data-lang="xml">    <span class="nt">&lt;groupId&gt;</span>org.springframework.boot<span class="nt">&lt;/groupId&gt;</span>
    <span class="nt">&lt;artifactId&gt;</span>spring-boot-starter-data-redis<span class="nt">&lt;/artifactId&gt;</span>
</code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-yml" data-lang="yml"><span class="k">spring</span><span class="p">:</span><span class="w">
</span><span class="w">  </span><span class="k">redis</span><span class="p">:</span><span class="w">
</span><span class="w">    </span><span class="k">host</span><span class="p">:</span><span class="w"> </span><span class="m">127.0.0.1</span><span class="w">
</span><span class="w">    </span><span class="k">port</span><span class="p">:</span><span class="w"> </span><span class="m">6379</span><span class="w">
</span><span class="w">    </span><span class="k">timeout</span><span class="p">:</span><span class="w"> </span><span class="m">5000</span><span class="w">
</span><span class="w">    </span><span class="k">jedis</span><span class="p">:</span><span class="w">
</span><span class="w">      </span><span class="k">pool</span><span class="p">:</span><span class="w">
</span><span class="w">        </span><span class="k">max-active</span><span class="p">:</span><span class="w"> </span><span class="m">100</span><span class="w"> </span><span class="c">#最大连接</span><span class="w">
</span><span class="w">        </span><span class="k">max-idle</span><span class="p">:</span><span class="w"> </span><span class="m">5</span><span class="w"> </span><span class="c">#最大空闲</span><span class="w">
</span><span class="w">        </span><span class="k">time-between-eviction-runs</span><span class="p">:</span><span class="w"> </span><span class="m">60000</span><span class="w"> </span><span class="c">#运行期间的回收时间        </span><span class="w">
</span></code></pre></td></tr></table>
</div>
</div><p>若只使用redisTemplate只需要加入注解@Autowired就好
若使用redis注解，启动类需要开启注解@Enablecaching</p>
<p>==使用注解时注意，key中的引号==</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="nd">@Autowired</span>
    <span class="n">RedisTemplate</span> <span class="n">redisTemplate</span><span class="o">;</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">addName</span><span class="o">(</span><span class="n">Integer</span> <span class="n">id</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">redisTemplate</span><span class="o">.</span><span class="na">opsForValue</span><span class="o">().</span><span class="na">set</span><span class="o">(</span><span class="s">&#34;hello🆔&#34;</span><span class="o">+</span><span class="n">id</span><span class="o">,</span><span class="n">id</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="nd">@Cacheable</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">&#34;helloService&#34;</span><span class="o">,</span><span class="n">key</span><span class="o">=</span><span class="s">&#34;&#39;hello🆔&#39;+#id&#34;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">Integer</span> <span class="nf">findId</span><span class="o">(</span><span class="n">Integer</span> <span class="n">id</span><span class="o">){</span>
        <span class="n">HashMap</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">,</span><span class="n">Integer</span><span class="o">&gt;</span> <span class="n">map</span><span class="o">=</span><span class="k">new</span> <span class="n">HashMap</span><span class="o">();</span>
        <span class="n">map</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">1</span><span class="o">,</span><span class="n">1111</span><span class="o">);</span>
        <span class="n">map</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">2</span><span class="o">,</span><span class="n">2222</span><span class="o">);</span>
        <span class="n">map</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">3</span><span class="o">,</span><span class="n">3333</span><span class="o">);</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;通过数据库查找 key为：&#34;</span><span class="o">+</span><span class="n">id</span><span class="o">);</span>
        <span class="k">return</span> <span class="n">map</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">id</span><span class="o">);</span>
    <span class="o">}</span>
    <span class="nd">@Override</span>
    <span class="nd">@CacheEvict</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">&#34;helloService&#34;</span><span class="o">,</span><span class="n">key</span><span class="o">=</span><span class="s">&#34;&#39;hello🆔&#39;+#id&#34;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">Integer</span> <span class="nf">updateHello</span><span class="o">(</span><span class="n">Integer</span> <span class="n">id</span><span class="o">){</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;删除在redis中key为：&#34;</span><span class="o">+</span><span class="n">id</span><span class="o">);</span>
        <span class="k">return</span> <span class="n">100</span><span class="o">;</span>
    <span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="6整合日志aop">6整合日志/AOP</h2>
<p>利用AOP为所有@service添加日志
加日志，只需要 加入jar、Properties文件、java类中使用。</p>
<blockquote>
<p>加入AOP.jar</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-xml" data-lang="xml"><span class="nt">&lt;groupId&gt;</span>org.springframework.boot<span class="nt">&lt;/groupId&gt;</span>
<span class="nt">&lt;artifactId&gt;</span>spring-boot-starter-aop<span class="nt">&lt;/artifactId&gt;</span>
</code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="kn">package</span> <span class="nn">lsl.loghandler</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.apache.log4j.Logger</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.aspectj.lang.JoinPoint</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.aspectj.lang.annotation.Aspect</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.aspectj.lang.annotation.Before</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.aspectj.lang.reflect.MethodSignature</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.stereotype.Component</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.lang.reflect.Method</span><span class="o">;</span>

<span class="nd">@Aspect</span>
<span class="nd">@Component</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">MyLogHandler</span> <span class="o">{</span>

    <span class="n">Logger</span> <span class="n">logger</span><span class="o">=</span><span class="n">Logger</span><span class="o">.</span><span class="na">getLogger</span><span class="o">(</span><span class="n">MyLogHandler</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
    
    <span class="nd">@Before</span><span class="o">(</span><span class="s">&#34;execution(public * lsl.service..*(..))&#34;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">addLogForService</span><span class="o">(</span><span class="n">JoinPoint</span> <span class="n">point</span><span class="o">){</span>
        <span class="n">MethodSignature</span> <span class="n">signature</span><span class="o">=</span> <span class="o">(</span><span class="n">MethodSignature</span><span class="o">)</span> <span class="n">point</span><span class="o">.</span><span class="na">getSignature</span><span class="o">();</span>
        <span class="n">Method</span> <span class="n">method</span><span class="o">=</span><span class="n">signature</span><span class="o">.</span><span class="na">getMethod</span><span class="o">();</span><span class="c1">//获得当前被拦截方法
</span><span class="c1"></span>        <span class="n">String</span> <span class="n">methodName</span><span class="o">=</span><span class="n">method</span><span class="o">.</span><span class="na">getName</span><span class="o">();</span><span class="c1">//获得被拦截方法名
</span><span class="c1"></span>        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;~~~~~&#34;</span><span class="o">+</span><span class="n">methodName</span><span class="o">);</span>
        <span class="n">Object</span> <span class="n">target</span> <span class="o">=</span> <span class="n">point</span><span class="o">.</span><span class="na">getTarget</span><span class="o">();</span><span class="c1">//获得类名
</span><span class="c1"></span>        <span class="n">logger</span><span class="o">.</span><span class="na">info</span><span class="o">(</span><span class="n">methodName</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div></blockquote>
<h2 id="7整合mybatis-plus">7整合mybatis-plus</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-xml" data-lang="xml"><span class="c">&lt;!--mybatis-plus自动的维护了mybatis以及mybatis-spring的依赖，
</span><span class="c">在springboot中这三者不能同时的出现，避免版本的冲突，表示：跳进过这个坑--&gt;</span>
<span class="nt">&lt;dependency&gt;</span>
<span class="nt">&lt;groupId&gt;</span>com.baomidou<span class="nt">&lt;/groupId&gt;</span>
<span class="nt">&lt;artifactId&gt;</span>mybatis-plus-boot-starter<span class="nt">&lt;/artifactId&gt;</span>
<span class="nt">&lt;version&gt;</span>3.1.1<span class="nt">&lt;/version&gt;</span>
<span class="nt">&lt;/dependency&gt;</span>
</code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="c1">//app启动类
</span><span class="c1"></span><span class="nd">@MapperScan</span><span class="o">(</span><span class="s">&#34;com.lx.mapper&#34;</span><span class="o">)</span><span class="c1">//扫描dao
</span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-yml" data-lang="yml"><span class="k">server</span><span class="p">:</span><span class="w">
</span><span class="w">  </span><span class="k">port</span><span class="p">:</span><span class="w"> </span><span class="m">8080</span><span class="w">
</span><span class="w">  </span><span class="k">servlet</span><span class="p">:</span><span class="w">
</span><span class="w">    </span><span class="k">context-path</span><span class="p">:</span><span class="w"> </span>/<span class="w">
</span><span class="w"></span><span class="k">spring</span><span class="p">:</span><span class="w">
</span><span class="w">  </span><span class="k">datasource</span><span class="p">:</span><span class="w">
</span><span class="w">    </span><span class="k">username</span><span class="p">:</span><span class="w"> </span>root<span class="w">
</span><span class="w">    </span><span class="k">password</span><span class="p">:</span><span class="w"> </span><span class="m">123456</span><span class="w">
</span><span class="w">    </span><span class="k">url</span><span class="p">:</span><span class="w"> </span>jdbc<span class="p">:</span>mysql<span class="p">:</span>//localhost<span class="p">:</span><span class="m">3306</span>/mysql1<span class="p">?</span>useUnicode=<span class="kc">true</span><span class="cp">&amp;characterEncoding=utf-8&amp;useSSL=true&amp;serverTimezone=UTC</span><span class="w">
</span><span class="w">    </span><span class="k">driver-class-name</span><span class="p">:</span><span class="w"> </span>com.mysql.cj.jdbc.Driver<span class="w">
</span><span class="w">
</span><span class="w"></span><span class="k">mybatis-plus</span><span class="p">:</span><span class="w">
</span><span class="w">  </span><span class="k">global-config</span><span class="p">:</span><span class="w">
</span><span class="w">    </span><span class="k">db-config</span><span class="p">:</span><span class="w">
</span><span class="w">      </span><span class="k">id-type</span><span class="p">:</span><span class="w"> </span>auto<span class="w">
</span><span class="w">      </span><span class="k">field-strategy</span><span class="p">:</span><span class="w"> </span>not_empty<span class="w">
</span><span class="w">      </span><span class="k">table-underline</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
</span><span class="w">      </span><span class="k">db-type</span><span class="p">:</span><span class="w"> </span>mysql<span class="w">
</span><span class="w">      </span><span class="k">logic-delete-value</span><span class="p">:</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="c"># 逻辑已删除值(默认为 1)</span><span class="w">
</span><span class="w">      </span><span class="k">logic-not-delete-value</span><span class="p">:</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="c"># 逻辑未删除值(默认为 0)</span><span class="w">
</span><span class="w">  </span><span class="k">mapper-locations</span><span class="p">:</span><span class="w"> </span>classpath<span class="p">:</span>com/lx/mapper/xml/<span class="cp">*Mapper.xml</span><span class="w">
</span><span class="w">  </span><span class="k">config-location</span><span class="p">:</span><span class="w"> </span>classpath<span class="p">:</span>mybatis-config.xml<span class="w">
</span><span class="w">  </span><span class="k">type-aliases-package</span><span class="p">:</span><span class="w"> </span>com.lx.vo<span class="w">
</span><span class="w">  </span><span class="c">#config-location和configuration只能存在一个</span><span class="w">
</span><span class="w">   </span><span class="k">configuration</span><span class="p">:</span><span class="w">
</span><span class="w">   </span><span class="c">#打印sql语句  </span><span class="w">
</span><span class="w">    </span><span class="k">log-impl</span><span class="p">:</span><span class="w"> </span>org.apache.ibatis.logging.stdout.StdOutImpl<span class="w">
</span></code></pre></td></tr></table>
</div>
</div><h2 id="8事务异常">8事务/异常</h2>
<p>事务注意：==Spring的事务是AOP的，也就是说，1开启事务 2执行锁内的代码 3释放锁 4提交事务==</p>
<p>在多线程情况下，线程A在开启线程，执行代码后释放锁，此时还没有提交，那么B线程现在已经读取到了数据。就会照成数据的&rsquo;脏读&rsquo;。
解决方案：
1扩大锁的范围，让锁包含事务。
2给Mysql数据库加乐观锁。(在sql语句后面加for update)</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="c1">//启动类
</span><span class="c1"></span><span class="nd">@EnableTransactionManagement</span> <span class="c1">//开启事务注解
</span><span class="c1"></span>
<span class="c1">//service中使用
</span><span class="c1"></span><span class="nd">@Transactionl</span>
</code></pre></td></tr></table>
</div>
</div><hr>
<blockquote>
<p><strong>全局异常的捕获</strong></p>
<p>问题：我们返回给页面的数据不是统一的，<strong>1定义一个返回的类</strong>。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="kn">package</span> <span class="nn">com.lx.util</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">lombok.AllArgsConstructor</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">lombok.Data</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">lombok.NoArgsConstructor</span><span class="o">;</span>

<span class="nd">@Data</span>
<span class="nd">@AllArgsConstructor</span>
<span class="nd">@NoArgsConstructor</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">CommonResult</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="o">{</span>
     <span class="c1">//404 not_found
</span><span class="c1"></span>     <span class="kd">private</span> <span class="n">Integer</span> <span class="n">code</span><span class="o">;</span>
     <span class="kd">private</span> <span class="n">String</span> <span class="n">message</span><span class="o">;</span>
    <span class="kd">private</span> <span class="n">T</span> <span class="n">data</span><span class="o">;</span>
     
       <span class="kd">public</span> <span class="kd">static</span> <span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="n">CommonResult</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="nf">getSuccess</span><span class="o">(</span><span class="n">T</span> <span class="n">data</span><span class="o">){</span>
         <span class="k">return</span> <span class="k">new</span> <span class="n">CommonResult</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;(</span><span class="n">200</span><span class="o">,</span><span class="s">&#34;成功&#34;</span><span class="o">,</span><span class="n">data</span><span class="o">);</span>
    <span class="o">}</span>
 
       <span class="kd">public</span> <span class="kd">static</span> <span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="n">CommonResult</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="nf">getFail</span><span class="o">(</span><span class="n">Integer</span> <span class="n">code</span><span class="o">,</span><span class="n">String</span> <span class="n">message</span><span class="o">){</span>
         <span class="k">return</span> <span class="k">new</span> <span class="n">CommonResult</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;(</span><span class="n">code</span><span class="o">,</span><span class="n">message</span><span class="o">,</span><span class="kc">null</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>

<span class="c1">////////需要接口定义同意的返回码 最好是枚举类
</span><span class="c1"></span><span class="kd">public</span> <span class="kd">interface</span> <span class="nc">ErrorInfo</span> <span class="o">{</span>
    <span class="n">Integer</span> <span class="n">SuccessCode</span><span class="o">=</span><span class="n">200</span><span class="o">;</span><span class="c1">//成功
</span><span class="c1"></span>    <span class="n">Integer</span> <span class="n">UnauthorizedCode</span><span class="o">=</span><span class="n">401</span><span class="o">;</span><span class="c1">//未经授权的
</span><span class="c1"></span>    <span class="n">Integer</span> <span class="n">ForbiddenCode</span><span class="o">=</span><span class="n">403</span><span class="o">;</span><span class="c1">//禁止
</span><span class="c1"></span>    <span class="n">Integer</span> <span class="n">NotFoundCode</span><span class="o">=</span><span class="n">404</span><span class="o">;</span><span class="c1">//没找到
</span><span class="c1"></span>
    <span class="n">String</span> <span class="n">Success</span><span class="o">=</span><span class="s">&#34;成功&#34;</span><span class="o">;</span><span class="c1">//成功
</span><span class="c1"></span>    <span class="n">String</span> <span class="n">Unauthorized</span> <span class="o">=</span><span class="s">&#34;未经授权的&#34;</span><span class="o">;</span><span class="c1">//未经授权的
</span><span class="c1"></span>    <span class="n">String</span> <span class="n">Forbidden</span> <span class="o">=</span><span class="s">&#34;禁止&#34;</span><span class="o">;</span><span class="c1">//禁止
</span><span class="c1"></span>    <span class="n">String</span> <span class="n">NotFound</span> <span class="o">=</span><span class="s">&#34;没找到&#34;</span><span class="o">;</span><span class="c1">//没找到
</span><span class="c1"></span><span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div></blockquote>
<blockquote>
<p><strong>2进行使用</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="n">ResultObj</span> <span class="n">resultObj</span><span class="o">;</span>

<span class="k">try</span> <span class="o">{</span>
    <span class="n">List</span><span class="o">&lt;</span><span class="n">ZzDepartment</span><span class="o">&gt;</span> <span class="n">zzDepartments</span><span class="o">=</span> <span class="n">deptMapper</span><span class="o">.</span><span class="na">selectList</span><span class="o">(</span><span class="k">new</span> <span class="n">QueryWrapper</span><span class="o">&lt;&gt;());</span>
    <span class="kt">int</span> <span class="n">a</span><span class="o">=</span><span class="n">5</span><span class="o">/</span><span class="n">0</span><span class="o">;</span>
    <span class="k">return</span> <span class="n">ResultObj</span><span class="o">.</span><span class="na">getSuccess</span><span class="o">(</span><span class="n">zzDepartments</span><span class="o">);</span>
<span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
    <span class="k">return</span> <span class="n">ResultObj</span><span class="o">.</span><span class="na">getFail</span><span class="o">(</span><span class="n">ErrorMessageAndCode</span><span class="o">.</span><span class="na">notFoundCode</span><span class="o">,</span><span class="n">ErrorMessageAndCode</span><span class="o">.</span><span class="na">notFoundMsg</span><span class="o">);</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div></blockquote>
<blockquote>
<p><strong><strong>3业务异常/和全局异常拦截</strong></strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="c1">//自定义异常子类
</span><span class="c1"></span>
<span class="nd">@Data</span>
<span class="nd">@AllArgsConstructor</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">CustomException</span> <span class="kd">extends</span> <span class="n">Exception</span> <span class="o">{</span>
<span class="n">Integer</span> <span class="n">code</span><span class="o">;</span>
<span class="n">String</span> <span class="n">msg</span><span class="o">;</span>

<span class="o">}</span>

<span class="c1">//========================
</span><span class="c1"></span>
<span class="c1">//抛出业务异常
</span><span class="c1"></span><span class="k">if</span><span class="o">(((</span><span class="n">ArrayList</span><span class="o">)</span><span class="n">all</span><span class="o">.</span><span class="na">getData</span><span class="o">()).</span><span class="na">size</span><span class="o">()&lt;</span><span class="n">50</span><span class="o">){</span>
<span class="k">throw</span> <span class="k">new</span> <span class="n">CustomException</span><span class="o">(</span><span class="n">ErrorMessageAndCode</span><span class="o">.</span><span class="na">nameErrorCode</span><span class="o">,</span><span class="n">ErrorMessageAndCode</span><span class="o">.</span><span class="na">notFoundMsg</span><span class="o">+</span><span class="s">&#34;sd&#34;</span><span class="o">);</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="c1">//全局异常拦截
</span><span class="c1">//可以自定义异常子类进行异常判断
</span><span class="c1"></span><span class="nd">@ControllerAdvice</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ErrorController</span> <span class="o">{</span>
 
 <span class="nd">@ResponseBody</span> <span class="c1">//以json数据返回
</span><span class="c1"></span> <span class="nd">@ExceptionHandler</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="n">Exception</span><span class="o">.</span><span class="na">class</span><span class="o">)</span><span class="c1">//拦截异常父类
</span><span class="c1"></span> <span class="kd">public</span> <span class="n">ResultObj</span> <span class="nf">globleExceptionHandle</span><span class="o">(</span><span class="n">Exception</span> <span class="n">exception</span><span class="o">){</span>
     <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;拦截异常&#34;</span><span class="o">+</span><span class="k">new</span> <span class="n">Date</span><span class="o">());</span>
     <span class="k">if</span><span class="o">(</span><span class="n">exception</span> <span class="k">instanceof</span> <span class="n">CustomException</span><span class="o">){</span>
         <span class="n">CustomException</span> <span class="n">customException</span><span class="o">=</span> <span class="o">(</span><span class="n">CustomException</span><span class="o">)</span> <span class="n">exception</span><span class="o">;</span>
         <span class="k">return</span> <span class="n">ResultObj</span><span class="o">.</span><span class="na">getFail</span><span class="o">(((</span><span class="n">CustomException</span><span class="o">)</span> <span class="n">exception</span><span class="o">).</span><span class="na">getCode</span><span class="o">(),</span><span class="n">customException</span><span class="o">.</span><span class="na">getMsg</span><span class="o">());</span>
     <span class="o">}</span>

     <span class="k">return</span> <span class="n">ResultObj</span><span class="o">.</span><span class="na">getFail</span><span class="o">(</span><span class="n">ErrorMessageAndCode</span><span class="o">.</span><span class="na">notFoundCode</span><span class="o">,</span><span class="n">ErrorMessageAndCode</span><span class="o">.</span><span class="na">notFound</span><span class="o">);</span>
 <span class="o">}</span>

<span class="o">}</span>

<span class="c1">//=========以下为改良后的 添加了部署环境的设置，dev开发环境会有错误信息=====
</span><span class="c1"></span><span class="kn">package</span> <span class="nn">com.lx.common</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.beans.factory.annotation.Value</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.ControllerAdvice</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.ExceptionHandler</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.ResponseBody</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.Arrays</span><span class="o">;</span>

<span class="c1">//全局异常拦截
</span><span class="c1">//可以自定义异常子类进行异常判断
</span><span class="c1"></span><span class="nd">@ControllerAdvice</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ErrorController</span> <span class="o">{</span>
    <span class="nd">@Value</span><span class="o">(</span><span class="s">&#34;${spring.profiles.active}&#34;</span><span class="o">)</span>
    <span class="n">String</span> <span class="n">environment</span><span class="o">;</span>

    <span class="nd">@ResponseBody</span> <span class="c1">//以json数据返回
</span><span class="c1"></span>    <span class="nd">@ExceptionHandler</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="n">Exception</span><span class="o">.</span><span class="na">class</span><span class="o">)</span><span class="c1">//拦截异常父类  也可以拦截子类，然后下面放父类
</span><span class="c1"></span>    <span class="kd">public</span> <span class="n">ResultObj</span> <span class="nf">globleExceptionHandle</span><span class="o">(</span><span class="n">Exception</span> <span class="n">exception</span><span class="o">){</span>
       <span class="k">if</span><span class="o">(</span><span class="s">&#34;dev&#34;</span><span class="o">.</span><span class="na">equalsIgnoreCase</span><span class="o">(</span><span class="n">environment</span><span class="o">))</span> <span class="o">{</span>
           <span class="c1">//若是开发环境 打印错误消息
</span><span class="c1"></span>           <span class="n">exception</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
       <span class="o">}</span>

        <span class="k">if</span><span class="o">(</span><span class="n">exception</span> <span class="k">instanceof</span> <span class="n">GlobalException</span><span class="o">){</span>
            <span class="n">GlobalException</span> <span class="n">GlobalException</span><span class="o">=</span> <span class="o">(</span><span class="n">GlobalException</span><span class="o">)</span> <span class="n">exception</span><span class="o">;</span>
            <span class="k">return</span> <span class="n">ResultObj</span><span class="o">.</span><span class="na">getFail</span><span class="o">(((</span><span class="n">GlobalException</span><span class="o">)</span> <span class="n">exception</span><span class="o">).</span><span class="na">getCode</span><span class="o">(),</span><span class="n">GlobalException</span><span class="o">.</span><span class="na">getMsg</span><span class="o">());</span>
        <span class="o">}</span>

         <span class="n">ResultObj</span> <span class="n">fail</span> <span class="o">=</span> <span class="n">ResultObj</span><span class="o">.</span><span class="na">getFail</span><span class="o">(</span><span class="n">ErrorInfo</span><span class="o">.</span><span class="na">NotImplementedCode</span><span class="o">,</span>
                 <span class="n">ErrorInfo</span><span class="o">.</span><span class="na">NotImplemented</span><span class="o">);</span>
        <span class="k">return</span> <span class="n">fail</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div></blockquote>
<table>
<thead>
<tr>
<th>异常</th>
<th>方法</th>
<th>返回值</th>
</tr>
</thead>
<tbody>
<tr>
<td>java.lang.NullPointerException</td>
<td>exception.getMessage()</td>
<td>null</td>
</tr>
<tr>
<td></td>
<td>exception.getLocalizedMessage()</td>
<td>null</td>
</tr>
<tr>
<td></td>
<td>toString</td>
<td>java.lang.NullPointerException</td>
</tr>
</tbody>
</table>
<h2 id="9上传下载">9上传下载</h2>
<p>1上传 2下载</p>
<blockquote>
<p><strong>上传</strong></p>
<p>1pom.xml加入Jar</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-xml" data-lang="xml"><span class="c">&lt;!-- 	文件上传 --&gt;</span>
<span class="nt">&lt;dependency&gt;</span>
<span class="nt">&lt;groupId&gt;</span>commons-fileupload<span class="nt">&lt;/groupId&gt;</span>
<span class="nt">&lt;artifactId&gt;</span>commons-fileupload<span class="nt">&lt;/artifactId&gt;</span>
<span class="nt">&lt;version&gt;</span>1.3.3<span class="nt">&lt;/version&gt;</span>
<span class="nt">&lt;/dependency&gt;</span>
</code></pre></td></tr></table>
</div>
</div><p>2修改yml配置文件</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-yml" data-lang="yml"><span class="k">Spring</span><span class="p">:</span><span class="w">
</span><span class="w">	</span><span class="k">servlet</span><span class="p">:</span><span class="w">
</span><span class="w"> </span><span class="k">multipart</span><span class="p">:</span><span class="w">
</span><span class="w">   </span><span class="k">enabled</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
</span><span class="w">   </span><span class="c">#      最大支持文件大小</span><span class="w">
</span><span class="w">   </span><span class="k">max-file-size</span><span class="p">:</span><span class="w"> </span>100MB<span class="w">
</span><span class="w">   </span><span class="c">#      最大支持请求大小</span><span class="w">
</span><span class="w">   </span><span class="k">max-request-size</span><span class="p">:</span><span class="w"> </span>100MB<span class="w">
</span><span class="w"></span>文件存储路径<span class="cp">**</span><span class="w">
</span><span class="w"></span><span class="k">filepath</span><span class="p">:</span><span class="w"> </span>E<span class="p">:</span>/MyCode/IntelliJ_IDEA_project/registration/src/main/resources/static/dockerImgs<span class="w">
</span></code></pre></td></tr></table>
</div>
</div><p>3java类中使用</p>
<p>不管MultipartFile有没有这个参数名称，只要没有上传文件，就会为null</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;/doctor&#34;</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">DoctorController</span> <span class="o">{</span>

  <span class="c1">//获取文件路径
</span><span class="c1"></span> <span class="nd">@Value</span><span class="o">(</span><span class="s">&#34;${filepath}&#34;</span><span class="o">)</span>
 <span class="kd">private</span> <span class="n">String</span> <span class="n">filepath</span><span class="o">;</span>

 <span class="nd">@PostMapping</span><span class="o">(</span><span class="s">&#34;addDocker&#34;</span><span class="o">)</span>
 <span class="kd">public</span> <span class="n">ResultObj</span> <span class="nf">addDocker</span><span class="o">(</span><span class="n">Doctor</span> <span class="n">doctor</span><span class="o">,</span> <span class="n">MultipartFile</span> <span class="n">prctureFile</span><span class="o">){</span>
     <span class="c1">//获得此项目的绝对路径
</span><span class="c1"></span>     <span class="n">String</span> <span class="n">path</span><span class="o">=</span><span class="n">filepath</span><span class="o">;</span><span class="c1">//通过配置文件写的路径   @Value(&#34;${filepath}&#34;) String filepath; 获得此项目的绝对路径
</span><span class="c1"></span>     <span class="n">File</span> <span class="n">file</span><span class="o">=</span><span class="k">new</span> <span class="n">File</span><span class="o">(</span><span class="n">path</span><span class="o">);</span>
     <span class="k">if</span><span class="o">(!</span><span class="n">file</span><span class="o">.</span><span class="na">exists</span><span class="o">()){</span>
         <span class="c1">//若这个文件夹不存在 就进行创建  可以不判断
</span><span class="c1"></span>         <span class="n">file</span><span class="o">.</span><span class="na">mkdirs</span><span class="o">();</span>
     <span class="o">}</span>
     <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;路径:&#34;</span><span class="o">+</span><span class="n">path</span><span class="o">+</span><span class="s">&#34;   对象：&#34;</span><span class="o">+</span><span class="n">doctor</span><span class="o">.</span><span class="na">toString</span><span class="o">());</span>

     <span class="n">String</span> <span class="n">fileName</span><span class="o">=</span><span class="n">prctureFile</span><span class="o">.</span><span class="na">getOriginalFilename</span><span class="o">();</span><span class="c1">//获得文件名称
</span><span class="c1"></span>     <span class="n">String</span> <span class="n">lastName</span><span class="o">=</span><span class="n">fileName</span><span class="o">.</span><span class="na">substring</span><span class="o">(</span><span class="n">fileName</span><span class="o">.</span><span class="na">indexOf</span><span class="o">(</span><span class="s">&#34;.&#34;</span><span class="o">));</span><span class="c1">//获得文件后缀 .img
</span><span class="c1"></span>
     <span class="n">String</span> <span class="n">uuid</span><span class="o">=</span> <span class="n">UUID</span><span class="o">.</span><span class="na">randomUUID</span><span class="o">().</span><span class="na">toString</span><span class="o">().</span><span class="na">replace</span><span class="o">(</span><span class="s">&#34;-&#34;</span><span class="o">,</span> <span class="s">&#34;&#34;</span><span class="o">);</span><span class="c1">//生成uuid
</span><span class="c1"></span>     <span class="n">String</span> <span class="n">newName</span><span class="o">=</span><span class="n">uuid</span><span class="o">+</span><span class="n">lastName</span><span class="o">;</span><span class="c1">//最后路径 可以保存到数据库
</span><span class="c1"></span>
     <span class="c1">//保存图片
</span><span class="c1"></span>     <span class="k">try</span> <span class="o">{</span>
         <span class="n">org</span><span class="o">.</span><span class="na">apache</span><span class="o">.</span><span class="na">commons</span><span class="o">.</span><span class="na">io</span><span class="o">.</span><span class="na">FileUtils</span><span class="o">.</span><span class="na">copyInputStreamToFile</span><span class="o">(</span><span class="n">prctureFile</span><span class="o">.</span><span class="na">getInputStream</span><span class="o">(),</span><span class="k">new</span> <span class="n">File</span><span class="o">(</span><span class="n">path</span><span class="o">+</span><span class="s">&#34;/&#34;</span><span class="o">+</span><span class="n">newName</span><span class="o">));</span>
         <span class="c1">//也可new File(path,newFileName)
</span><span class="c1"></span>     <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">IOException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
         <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
     <span class="o">}</span>

     <span class="n">doctor</span><span class="o">.</span><span class="na">setImages</span><span class="o">(</span><span class="n">newName</span><span class="o">);</span>
     <span class="c1">//productDao.addProduct(product);
</span><span class="c1"></span>     <span class="k">return</span> <span class="kc">null</span><span class="o">;</span>
 <span class="o">}</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div></blockquote>
<h1 id="第四章-springsecurity">第四章-SpringSecurity</h1>
<h2 id="1安全框架">1安全框架</h2>
<p>市面上存在比较有名的：Shiro，Spring Security ！</p>
<p>Spring Security是一个功能强大且高度可定制的身份验证和访问控制框架。它实际上是保护基于spring的应用程序的标准。</p>
<p>Spring Security 是针对Spring项目的安全框架，也是Spring Boot底层安全模块默认的技术选型，他可以实现强大的Web安全控制，对于安全控制，我们仅需要引入 spring-boot-starter-security 模块，进行少量的配置，即可实现强大的安全管理！</p>
<p>记住几个类：</p>
<ul>
<li>WebSecurityConfigurerAdapter：自定义Security策略</li>
<li>AuthenticationManagerBuilder：自定义认证策略</li>
<li>@EnableWebSecurity：开启WebSecurity模式</li>
</ul>
<p>Spring Security的两个主要目标是 “认证” 和 “授权”（访问控制）。</p>
<p><strong>“认证”（Authentication）</strong></p>
<p>身份验证是关于验证您的凭据，如用户名/用户ID和密码，以验证您的身份。</p>
<p>身份验证通常通过用户名和密码完成，有时与身份验证因素结合使用。</p>
<p><strong>“授权” （Authorization）</strong></p>
<p>授权发生在系统成功验证您的身份后，最终会授予您访问资源（如信息，文件，数据库，资金，位置，几乎任何内容）的完全权限。</p>
<p>这个概念是通用的，而不是只在Spring Security 中存在。</p>
<h2 id="2基本登录权限">2基本登录权限</h2>
<p>1导入jar</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-xml" data-lang="xml"><span class="nt">&lt;dependency&gt;</span>
    <span class="nt">&lt;groupId&gt;</span>org.springframework.boot<span class="nt">&lt;/groupId&gt;</span>
    <span class="nt">&lt;artifactId&gt;</span>spring-boot-starter-security<span class="nt">&lt;/artifactId&gt;</span>
<span class="nt">&lt;/dependency&gt;</span>
</code></pre></td></tr></table>
</div>
</div><p>2编写基础配置类</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="kn">package</span> <span class="nn">com.lx.config</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.springframework.security.config.annotation.authentication.builders.AuthenticationManagerBuilder</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.security.config.annotation.web.builders.HttpSecurity</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.security.config.annotation.web.builders.WebSecurity</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.security.config.annotation.web.configuration.EnableWebSecurity</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.security.config.annotation.web.configuration.WebSecurityConfigurerAdapter</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.security.crypto.bcrypt.BCryptPasswordEncoder</span><span class="o">;</span>

<span class="nd">@EnableWebSecurity</span> <span class="c1">// 开启WebSecurity模式
</span><span class="c1"></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">SecurityConfig</span> <span class="kd">extends</span> <span class="n">WebSecurityConfigurerAdapter</span> <span class="o">{</span>


    <span class="nd">@Override</span>
    <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">configure</span><span class="o">(</span><span class="n">HttpSecurity</span> <span class="n">http</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
       <span class="c1">// super.configure(http);
</span><span class="c1"></span>        <span class="c1">// 定制请求的授权规则
</span><span class="c1"></span>        <span class="c1">// 首页所有人可以访问
</span><span class="c1"></span>        <span class="n">http</span><span class="o">.</span><span class="na">authorizeRequests</span><span class="o">()</span>
                <span class="o">.</span><span class="na">antMatchers</span><span class="o">(</span><span class="s">&#34;/&#34;</span><span class="o">).</span><span class="na">permitAll</span><span class="o">()</span>
                <span class="o">.</span><span class="na">antMatchers</span><span class="o">(</span><span class="s">&#34;/level1/**&#34;</span><span class="o">).</span><span class="na">hasRole</span><span class="o">(</span><span class="s">&#34;vip1&#34;</span><span class="o">)</span>
                <span class="o">.</span><span class="na">antMatchers</span><span class="o">(</span><span class="s">&#34;/level2/**&#34;</span><span class="o">).</span><span class="na">hasRole</span><span class="o">(</span><span class="s">&#34;vip2&#34;</span><span class="o">)</span>
                <span class="o">.</span><span class="na">antMatchers</span><span class="o">(</span><span class="s">&#34;/level3/**&#34;</span><span class="o">).</span><span class="na">hasRole</span><span class="o">(</span><span class="s">&#34;vip3&#34;</span><span class="o">);</span>

        <span class="c1">//没有权限默认到登录页面
</span><span class="c1"></span>        <span class="n">http</span><span class="o">.</span><span class="na">formLogin</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">configure</span><span class="o">(</span><span class="n">AuthenticationManagerBuilder</span> <span class="n">auth</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
        <span class="c1">//super.configure(auth);
</span><span class="c1"></span>        <span class="c1">//认证
</span><span class="c1"></span>        <span class="c1">// 数据库 jdbcAuthentication()
</span><span class="c1"></span>        <span class="c1">// 内存inMemoryAuthentication()
</span><span class="c1"></span>        <span class="c1">//要想我们的项目还能够正常登陆，需要修改一下configure中的代码。我们要将前端传过来的密码进行某种方式加密
</span><span class="c1"></span>        <span class="c1">//spring security 官方推荐的是使用bcrypt加密方式。
</span><span class="c1"></span>        <span class="n">auth</span><span class="o">.</span><span class="na">inMemoryAuthentication</span><span class="o">().</span><span class="na">passwordEncoder</span><span class="o">(</span><span class="k">new</span> <span class="n">BCryptPasswordEncoder</span><span class="o">())</span>
                <span class="o">.</span><span class="na">withUser</span><span class="o">(</span><span class="s">&#34;lusenlin1&#34;</span><span class="o">).</span><span class="na">password</span><span class="o">(</span><span class="k">new</span> <span class="n">BCryptPasswordEncoder</span><span class="o">().</span><span class="na">encode</span><span class="o">(</span><span class="s">&#34;123456&#34;</span><span class="o">)).</span><span class="na">roles</span><span class="o">(</span><span class="s">&#34;vip1&#34;</span><span class="o">)</span>
                <span class="o">.</span><span class="na">and</span><span class="o">()</span>
                <span class="o">.</span><span class="na">withUser</span><span class="o">(</span><span class="s">&#34;lusenlin2&#34;</span><span class="o">).</span><span class="na">password</span><span class="o">(</span><span class="k">new</span> <span class="n">BCryptPasswordEncoder</span><span class="o">().</span><span class="na">encode</span><span class="o">(</span><span class="s">&#34;123456&#34;</span><span class="o">)).</span><span class="na">roles</span><span class="o">(</span><span class="s">&#34;vip2&#34;</span><span class="o">)</span>
                <span class="o">.</span><span class="na">and</span><span class="o">()</span>
                <span class="o">.</span><span class="na">withUser</span><span class="o">(</span><span class="s">&#34;lusenlin3&#34;</span><span class="o">).</span><span class="na">password</span><span class="o">(</span><span class="k">new</span> <span class="n">BCryptPasswordEncoder</span><span class="o">().</span><span class="na">encode</span><span class="o">(</span><span class="s">&#34;123456&#34;</span><span class="o">)).</span><span class="na">roles</span><span class="o">(</span><span class="s">&#34;vip1&#34;</span><span class="o">,</span><span class="s">&#34;vip2&#34;</span><span class="o">,</span><span class="s">&#34;vip3&#34;</span><span class="o">);</span>


    <span class="o">}</span>
<span class="o">}</span>

</code></pre></td></tr></table>
</div>
</div><p>3测试，我们可以使用这些账号登录进行测试！发现会报错！，是因为没有加密。</p>
<p>4进行注销，在配置文件中的 configure(HttpSecurity http) 方法进行注销，http.logout();</p>
<p>5、但是，我们想让他注销成功后，依旧可以跳转到首页，该怎么处理呢？</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="c1">// .logoutSuccessUrl(&#34;/&#34;); 注销成功来到首页
</span><span class="c1"></span><span class="n">http</span><span class="o">.</span><span class="na">logout</span><span class="o">().</span><span class="na">logoutSuccessUrl</span><span class="o">(</span><span class="s">&#34;/&#34;</span><span class="o">);</span>
</code></pre></td></tr></table>
</div>
</div><p>6 sec：authorize=&quot;isAuthenticated()&quot;:是否认证登录！来显示不同的页面</p>
<p>Maven依赖：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-xml" data-lang="xml"><span class="c">&lt;!-- https://mvnrepository.com/artifact/org.thymeleaf.extras/thymeleaf-extras-springsecurity4 --&gt;</span>
<span class="nt">&lt;dependency&gt;</span>
   <span class="nt">&lt;groupId&gt;</span>org.thymeleaf.extras<span class="nt">&lt;/groupId&gt;</span>
   <span class="nt">&lt;artifactId&gt;</span>thymeleaf-extras-springsecurity5<span class="nt">&lt;/artifactId&gt;</span>
   <span class="nt">&lt;version&gt;</span>3.0.4.RELEASE<span class="nt">&lt;/version&gt;</span>
<span class="nt">&lt;/dependency&gt;</span>
</code></pre></td></tr></table>
</div>
</div><p>7、修改我们的 前端页面</p>
<ol>
<li>
<p>导入命名空间</p>
</li>
<li>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-html" data-lang="html">xmlns:sec=&#34;http://www.thymeleaf.org/thymeleaf-extras-springsecurity5&#34;
</code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>修改导航栏，增加认证判断</p>
</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-html" data-lang="html">   <span class="c">&lt;!--如果未登录--&gt;</span>
   <span class="p">&lt;</span><span class="nt">div</span> <span class="na">sec:authorize</span><span class="o">=</span><span class="s">&#34;!isAuthenticated()&#34;</span><span class="p">&gt;</span>
       <span class="p">&lt;</span><span class="nt">a</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;item&#34;</span> <span class="na">th:href</span><span class="o">=</span><span class="s">&#34;@{/login}&#34;</span><span class="p">&gt;</span>
           <span class="p">&lt;</span><span class="nt">i</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;address card icon&#34;</span><span class="p">&gt;&lt;/</span><span class="nt">i</span><span class="p">&gt;</span> 登录
       <span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
   <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>

   <span class="c">&lt;!--如果已登录--&gt;</span>
   <span class="p">&lt;</span><span class="nt">div</span> <span class="na">sec:authorize</span><span class="o">=</span><span class="s">&#34;isAuthenticated()&#34;</span><span class="p">&gt;</span>
       <span class="p">&lt;</span><span class="nt">a</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;item&#34;</span><span class="p">&gt;</span>
           <span class="p">&lt;</span><span class="nt">i</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;address card icon&#34;</span><span class="p">&gt;&lt;/</span><span class="nt">i</span><span class="p">&gt;</span>
          用户名：<span class="p">&lt;</span><span class="nt">span</span> <span class="na">sec:authentication</span><span class="o">=</span><span class="s">&#34;principal.username&#34;</span><span class="p">&gt;&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
          角色：<span class="p">&lt;</span><span class="nt">span</span> <span class="na">sec:authentication</span><span class="o">=</span><span class="s">&#34;principal.authorities&#34;</span><span class="p">&gt;&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
       <span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
   <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
</code></pre></td></tr></table>
</div>
</div><p>8如果注销404了，就是因为它默认防止csrf跨站请求伪造，因为会产生安全问题，我们可以将请求改为post表单提交，或者在spring security中关闭csrf功能；我们试试：在 配置中增加 <code>http.csrf().disable();</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="n">http</span><span class="o">.</span><span class="na">csrf</span><span class="o">().</span><span class="na">disable</span><span class="o">();</span><span class="c1">//关闭csrf功能:跨站请求伪造,默认只能通过post方式提交logout请求
</span></code></pre></td></tr></table>
</div>
</div><p>9开启记住我功能<code> //记住我 http.rememberMe().rememberMeParameter(&quot;remember&quot;);</code></p>
<h2 id="3定制登录页">3定制登录页</h2>
<p>1、在刚才的登录页配置后面指定 loginpage</p>
<p>http.formLogin().loginPage(&quot;/toLogin&rdquo;);</p>
<p>2、然后前端也需要指向我们自己定义的 login请求</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-html" data-lang="html"><span class="p">&lt;</span><span class="nt">a</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;item&#34;</span> <span class="na">th:href</span><span class="o">=</span><span class="s">&#34;@{/toLogin}&#34;</span><span class="p">&gt;</span>
   <span class="p">&lt;</span><span class="nt">i</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;address card icon&#34;</span><span class="p">&gt;&lt;/</span><span class="nt">i</span><span class="p">&gt;</span> 登录
<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
</code></pre></td></tr></table>
</div>
</div><p>3、我们登录，需要将这些信息发送到哪里，我们也需要配置，login.html 配置提交请求及方式，方式必须为post:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-html" data-lang="html"><span class="p">&lt;</span><span class="nt">form</span> <span class="na">th:action</span><span class="o">=</span><span class="s">&#34;@{/login}&#34;</span> <span class="na">method</span><span class="o">=</span><span class="s">&#34;post&#34;</span><span class="p">&gt;</span>
</code></pre></td></tr></table>
</div>
</div><p>4、这个请求提交上来，我们还需要验证处理，怎么做呢？我们可以查看formLogin()方法的源码！我们配置接收登录的用户名和密码的参数！</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="c1">//没有权限默认到登录页面  ,若提交来的表单的字段名称不同，可以进行设置。 /toLogin自定义登录页面
</span><span class="c1"></span><span class="n">http</span><span class="o">.</span><span class="na">formLogin</span><span class="o">()</span>
  <span class="o">.</span><span class="na">usernameParameter</span><span class="o">(</span><span class="s">&#34;username&#34;</span><span class="o">)</span>
  <span class="o">.</span><span class="na">passwordParameter</span><span class="o">(</span><span class="s">&#34;password&#34;</span><span class="o">)</span>
  <span class="o">.</span><span class="na">loginPage</span><span class="o">(</span><span class="s">&#34;/toLogin&#34;</span><span class="o">)</span>
  <span class="o">.</span><span class="na">loginProcessingUrl</span><span class="o">(</span><span class="s">&#34;/login&#34;</span><span class="o">);</span> <span class="c1">// 登陆表单提交请求
</span></code></pre></td></tr></table>
</div>
</div><p>5、在登录页增加记住我的多选框</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-html" data-lang="html"><span class="p">&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">&#34;checkbox&#34;</span> <span class="na">name</span><span class="o">=</span><span class="s">&#34;remember&#34;</span><span class="p">&gt;</span> 记住我
</code></pre></td></tr></table>
</div>
</div><p><strong>完整的配置</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="kn">package</span> <span class="nn">com.lx.config</span><span class="o">;</span>
<span class="nd">@EnableWebSecurity</span> <span class="c1">// 开启WebSecurity模式
</span><span class="c1"></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">SecurityConfig</span> <span class="kd">extends</span> <span class="n">WebSecurityConfigurerAdapter</span> <span class="o">{</span>


    <span class="nd">@Override</span>
    <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">configure</span><span class="o">(</span><span class="n">HttpSecurity</span> <span class="n">http</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
       <span class="c1">// super.configure(http);
</span><span class="c1"></span>        <span class="c1">// 定制请求的授权规则
</span><span class="c1"></span>        <span class="c1">// 首页所有人可以访问
</span><span class="c1"></span>        <span class="n">http</span><span class="o">.</span><span class="na">authorizeRequests</span><span class="o">()</span>
                <span class="o">.</span><span class="na">antMatchers</span><span class="o">(</span><span class="s">&#34;/&#34;</span><span class="o">).</span><span class="na">permitAll</span><span class="o">()</span>
                <span class="o">.</span><span class="na">antMatchers</span><span class="o">(</span><span class="s">&#34;/level1/**&#34;</span><span class="o">).</span><span class="na">hasRole</span><span class="o">(</span><span class="s">&#34;vip1&#34;</span><span class="o">)</span>
                <span class="o">.</span><span class="na">antMatchers</span><span class="o">(</span><span class="s">&#34;/level2/**&#34;</span><span class="o">).</span><span class="na">hasRole</span><span class="o">(</span><span class="s">&#34;vip2&#34;</span><span class="o">)</span>
                <span class="o">.</span><span class="na">antMatchers</span><span class="o">(</span><span class="s">&#34;/level3/**&#34;</span><span class="o">).</span><span class="na">hasRole</span><span class="o">(</span><span class="s">&#34;vip3&#34;</span><span class="o">);</span>

        <span class="c1">//没有权限默认到登录页面  ,若提交来的表单的字段名称不同，可以进行设置。 /toLogin自定义登录页面
</span><span class="c1"></span>        <span class="c1">//http.formLogin().loginPage(&#34;toLogin&#34;);
</span><span class="c1"></span>        <span class="n">http</span><span class="o">.</span><span class="na">formLogin</span><span class="o">()</span>
                <span class="o">.</span><span class="na">usernameParameter</span><span class="o">(</span><span class="s">&#34;username&#34;</span><span class="o">)</span>
                <span class="o">.</span><span class="na">passwordParameter</span><span class="o">(</span><span class="s">&#34;password&#34;</span><span class="o">)</span>
                <span class="o">.</span><span class="na">loginPage</span><span class="o">(</span><span class="s">&#34;/toLogin&#34;</span><span class="o">)</span>
                <span class="o">.</span><span class="na">loginProcessingUrl</span><span class="o">(</span><span class="s">&#34;/login&#34;</span><span class="o">);</span> <span class="c1">// 登陆表单提交请求
</span><span class="c1"></span>
        <span class="n">http</span><span class="o">.</span><span class="na">csrf</span><span class="o">().</span><span class="na">disable</span><span class="o">();</span><span class="c1">//关闭csrf功能:跨站请求伪造,默认只能通过post方式提交logout请求
</span><span class="c1"></span>
        <span class="c1">//开启注销功能
</span><span class="c1"></span>        <span class="n">http</span><span class="o">.</span><span class="na">logout</span><span class="o">();</span>

        <span class="n">http</span><span class="o">.</span><span class="na">rememberMe</span><span class="o">().</span><span class="na">rememberMeParameter</span><span class="o">(</span><span class="s">&#34;remember&#34;</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">configure</span><span class="o">(</span><span class="n">AuthenticationManagerBuilder</span> <span class="n">auth</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
        <span class="c1">//super.configure(auth);
</span><span class="c1"></span>        <span class="c1">//认证
</span><span class="c1"></span>        <span class="c1">// 数据库 jdbcAuthentication()
</span><span class="c1"></span>        <span class="c1">// 内存inMemoryAuthentication()
</span><span class="c1"></span>        <span class="c1">//要想我们的项目还能够正常登陆，需要修改一下configure中的代码。我们要将前端传过来的密码进行某种方式加密
</span><span class="c1"></span>        <span class="c1">//spring security 官方推荐的是使用bcrypt加密方式。
</span><span class="c1"></span>        <span class="n">auth</span><span class="o">.</span><span class="na">inMemoryAuthentication</span><span class="o">().</span><span class="na">passwordEncoder</span><span class="o">(</span><span class="k">new</span> <span class="n">BCryptPasswordEncoder</span><span class="o">())</span>
                <span class="o">.</span><span class="na">withUser</span><span class="o">(</span><span class="s">&#34;lusenlin1&#34;</span><span class="o">).</span><span class="na">password</span><span class="o">(</span><span class="k">new</span> <span class="n">BCryptPasswordEncoder</span><span class="o">().</span><span class="na">encode</span><span class="o">(</span><span class="s">&#34;123456&#34;</span><span class="o">)).</span><span class="na">roles</span><span class="o">(</span><span class="s">&#34;vip1&#34;</span><span class="o">)</span>
                <span class="o">.</span><span class="na">and</span><span class="o">()</span>
                <span class="o">.</span><span class="na">withUser</span><span class="o">(</span><span class="s">&#34;lusenlin2&#34;</span><span class="o">).</span><span class="na">password</span><span class="o">(</span><span class="k">new</span> <span class="n">BCryptPasswordEncoder</span><span class="o">().</span><span class="na">encode</span><span class="o">(</span><span class="s">&#34;123456&#34;</span><span class="o">)).</span><span class="na">roles</span><span class="o">(</span><span class="s">&#34;vip2&#34;</span><span class="o">)</span>
                <span class="o">.</span><span class="na">and</span><span class="o">()</span>
                <span class="o">.</span><span class="na">withUser</span><span class="o">(</span><span class="s">&#34;lusenlin3&#34;</span><span class="o">).</span><span class="na">password</span><span class="o">(</span><span class="k">new</span> <span class="n">BCryptPasswordEncoder</span><span class="o">().</span><span class="na">encode</span><span class="o">(</span><span class="s">&#34;123456&#34;</span><span class="o">)).</span><span class="na">roles</span><span class="o">(</span><span class="s">&#34;vip1&#34;</span><span class="o">,</span><span class="s">&#34;vip2&#34;</span><span class="o">,</span><span class="s">&#34;vip3&#34;</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>

</code></pre></td></tr></table>
</div>
</div>
    </div>

    <div class="post-copyright">
  <p class="copyright-item">
    <span class="item-title">文章作者</span>
    <span class="item-content">卢森林</span>
  </p>
  <p class="copyright-item">
    <span class="item-title">上次更新</span>
    <span class="item-content">
        2020-08-13
        
    </span>
  </p>
  
  
</div>
<footer class="post-footer">
      
      <nav class="post-nav">
        <a class="prev" href="/post/spring/">
            <i class="iconfont icon-left"></i>
            <span class="prev-text nav-default">Spring.md</span>
            <span class="prev-text nav-mobile">上一篇</span>
          </a>
        <a class="next" href="/post/springmvc/">
            <span class="next-text nav-default">SpringMVC.md</span>
            <span class="next-text nav-mobile">下一篇</span>
            <i class="iconfont icon-right"></i>
          </a>
      </nav>
    </footer>
  </article>
        </div>
        

  

  

      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="social-links">
      <a href="mailto:1115759748@qq.com" class="iconfont icon-email" title="email"></a>
      <a href="https://gitee.com/lusenlin1997" class="iconfont icon-stack-overflow" title="stack-overflow"></a>
      <a href="http://https://github.com/13277112287" class="iconfont icon-github" title="github"></a>
      <a href="http://localhost:1313" class="iconfont icon-bilibili" title="bilibili"></a>
  <a href="https://13277112287.github.io/index.xml" type="application/rss+xml" class="iconfont icon-rss" title="rss"></a>
</div>

<div class="copyright">
  <span class="power-by">
    由 <a class="hexo-link" href="https://gohugo.io">Hugo</a> 强力驱动
  </span>
  <span class="division">|</span>
  <span class="theme-info">
    主题 - 
    <a class="theme-link" href="https://github.com/olOwOlo/hugo-theme-even">Even</a>
  </span>

  

  <span class="copyright-year">
    &copy; 
    2020
    <span class="heart">
      <i class="iconfont icon-heart"></i>
    </span>
    <span class="author">卢森林</span>
  </span>
</div>
    </footer>

    <div class="back-to-top" id="back-to-top">
      <i class="iconfont icon-up"></i>
    </div>
  </div>
  
  <script src="https://cdn.jsdelivr.net/npm/jquery@3.2.1/dist/jquery.min.js" integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/slideout@1.0.1/dist/slideout.min.js" integrity="sha256-t+zJ/g8/KXIJMjSVQdnibt4dlaDxc9zXr/9oNPeWqdg=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.js" integrity="sha256-XVLffZaxoWfGUEbdzuLi7pwaUJv1cecsQJQqGLe7axY=" crossorigin="anonymous"></script>



<script type="text/javascript" src="/js/main.min.d7b7ada643c9c1a983026e177f141f7363b4640d619caf01d8831a6718cd44ea.js"></script>








</body>
</html>
